<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>
 
 

 ejabberd 2.0.x 
 
 Installation and Operation Guide
 
 




</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<META name="GENERATOR" content="hevea 1.10">
<STYLE type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
TD P{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px;width:auto; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px;width:auto; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.SPAN{width:20%; float:right; text-align:left; margin-left:auto;}
H1.titlemain HR{display:none;}
TABLE.title{border-top:1px solid grey;border-bottom:1px solid grey; background: #efefef}
H1.chapter A, H2.section A, H3.subsection A, H4.subsubsection A, H5.paragraph A{color:#000000; text-decoration:none;}
H1.chapter, H2.section, H3.subsection, H4.subsubsection, H5.paragraph{border-top: 1px solid grey; background: #efefef; padding: 0.5ex}
pre.verbatim{margin:1ex 2ex;border:1px dashed lightgrey;background-color:#f9f9f9;padding:0.5ex;}
.dt-description{margin:0ex 2ex;}
table[border="1"]{border-collapse:collapse;margin-bottom:1em;}
table[border="1"] td{border:1px solid #aaa;padding:2px}
BLOCKQUOTE.table DIV.center DIV.center HR{display:none;}
BLOCKQUOTE.figure DIV.center DIV.center HR{display:none;}
</STYLE>
</HEAD>
<BODY >
<!--HEVEA command line is: /usr/bin/hevea -fix -pedantic guide.tex -->
<!--CUT DEF chapter 1 --><P><A NAME="titlepage"></A>

</P><TABLE CLASS="title"><TR><TD><H1 CLASS="titlemain">
<HR SIZE=2><BR>
<BR>

<TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=right NOWRAP> <FONT SIZE=6><B>ejabberd 2.0.x </B></FONT></TD></TR>
<TR><TD ALIGN=right NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=right NOWRAP> <FONT SIZE=6>Installation and Operation Guide</FONT></TD></TR>
</TABLE><BR>
<BR>

<HR SIZE=2>

</H1></TD></TR>
</TABLE><P><A NAME="toc"></A>
</P><!--TOC chapter Contents-->
<H1 CLASS="chapter"><!--SEC ANCHOR -->Contents</H1><!--SEC END --><UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc1">Chapter&#XA0;1&#XA0;&#XA0;Introduction</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc2">1.1&#XA0;&#XA0;Key Features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc3">1.2&#XA0;&#XA0;Additional Features</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc4">Chapter&#XA0;2&#XA0;&#XA0;Installing <TT>ejabberd</TT></A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc5">2.1&#XA0;&#XA0;Installing <TT>ejabberd</TT> with Binary Installer</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc6">2.2&#XA0;&#XA0;Installing <TT>ejabberd</TT> with Operating System specific packages</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc7">2.3&#XA0;&#XA0;Installing <TT>ejabberd</TT> with CEAN</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc8">2.4&#XA0;&#XA0;Installing <TT>ejabberd</TT> from Source Code</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc9">2.4.1&#XA0;&#XA0;Requirements</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc10">2.4.2&#XA0;&#XA0;Download Source Code</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc11">2.4.3&#XA0;&#XA0;Compile</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc12">2.4.4&#XA0;&#XA0;Install</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc13">2.4.5&#XA0;&#XA0;Start</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc14">2.4.6&#XA0;&#XA0;Specific Notes for BSD</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc15">2.4.7&#XA0;&#XA0;Specific Notes for Sun Solaris</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc16">2.4.8&#XA0;&#XA0;Specific Notes for Microsoft Windows</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc17">2.5&#XA0;&#XA0;Create a Jabber Account for Administration</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc18">2.6&#XA0;&#XA0;Upgrading <TT>ejabberd</TT></A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc19">Chapter&#XA0;3&#XA0;&#XA0;Configuring <TT>ejabberd</TT></A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc20">3.1&#XA0;&#XA0;Basic Configuration</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc21">3.1.1&#XA0;&#XA0;Host Names</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc22">3.1.2&#XA0;&#XA0;Virtual Hosting</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc23">3.1.3&#XA0;&#XA0;Listening Ports</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc24">3.1.4&#XA0;&#XA0;Authentication</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc25">3.1.5&#XA0;&#XA0;Access Rules</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc26">3.1.6&#XA0;&#XA0;Shapers</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc27">3.1.7&#XA0;&#XA0;Default Language</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc28">3.2&#XA0;&#XA0;Database and LDAP Configuration</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc29">3.2.1&#XA0;&#XA0;MySQL</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc30">3.2.2&#XA0;&#XA0;Microsoft SQL Server</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc31">3.2.3&#XA0;&#XA0;PostgreSQL</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc32">3.2.4&#XA0;&#XA0;ODBC Compatible</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc33">3.2.5&#XA0;&#XA0;LDAP</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc34">3.3&#XA0;&#XA0;Modules Configuration</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc35">3.3.1&#XA0;&#XA0;Modules Overview</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc36">3.3.2&#XA0;&#XA0;Common Options</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc37">3.3.3&#XA0;&#XA0;<TT>mod_announce</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc38">3.3.4&#XA0;&#XA0;<TT>mod_disco</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc39">3.3.5&#XA0;&#XA0;<TT>mod_echo</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc40">3.3.6&#XA0;&#XA0;<TT>mod_irc</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc41">3.3.7&#XA0;&#XA0;<TT>mod_last</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc42">3.3.8&#XA0;&#XA0;<TT>mod_muc</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc43">3.3.9&#XA0;&#XA0;<TT>mod_muc_log</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc44">3.3.10&#XA0;&#XA0;<TT>mod_offline</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc45">3.3.11&#XA0;&#XA0;<TT>mod_privacy</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc46">3.3.12&#XA0;&#XA0;<TT>mod_private</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc47">3.3.13&#XA0;&#XA0;<TT>mod_proxy65</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc48">3.3.14&#XA0;&#XA0;<TT>mod_pubsub</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc49">3.3.15&#XA0;&#XA0;<TT>mod_register</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc50">3.3.16&#XA0;&#XA0;<TT>mod_roster</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc51">3.3.17&#XA0;&#XA0;<TT>mod_service_log</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc52">3.3.18&#XA0;&#XA0;<TT>mod_shared_roster</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc53">3.3.19&#XA0;&#XA0;<TT>mod_stats</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc54">3.3.20&#XA0;&#XA0;<TT>mod_time</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc55">3.3.21&#XA0;&#XA0;<TT>mod_vcard</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc56">3.3.22&#XA0;&#XA0;<TT>mod_vcard_ldap</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc57">3.3.23&#XA0;&#XA0;<TT>mod_version</TT></A>
</LI></UL>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc58">Chapter&#XA0;4&#XA0;&#XA0;Managing an <TT>ejabberd</TT> server</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc59">4.1&#XA0;&#XA0;<TT>ejabberdctl</TT></A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc60">4.1.1&#XA0;&#XA0;Commands</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc61">4.1.2&#XA0;&#XA0;Erlang runtime system</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc62">4.2&#XA0;&#XA0;Web Admin</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc63">4.3&#XA0;&#XA0;Ad-hoc Commands</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc64">4.4&#XA0;&#XA0;Change Computer Hostname</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc65">Chapter&#XA0;5&#XA0;&#XA0;Securing <TT>ejabberd</TT></A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc66">5.1&#XA0;&#XA0;Firewall Settings</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc67">5.2&#XA0;&#XA0;epmd</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc68">5.3&#XA0;&#XA0;Erlang Cookie</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc69">5.4&#XA0;&#XA0;Erlang node name</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc70">5.5&#XA0;&#XA0;Securing sensible files</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc71">Chapter&#XA0;6&#XA0;&#XA0;Clustering</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc72">6.1&#XA0;&#XA0;How it Works</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc73">6.1.1&#XA0;&#XA0;Router</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc74">6.1.2&#XA0;&#XA0;Local Router</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc75">6.1.3&#XA0;&#XA0;Session Manager</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc76">6.1.4&#XA0;&#XA0;s2s Manager</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc77">6.2&#XA0;&#XA0;Clustering Setup</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc78">6.3&#XA0;&#XA0;Service Load-Balancing</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc79">6.3.1&#XA0;&#XA0;Components Load-Balancing</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc80">6.3.2&#XA0;&#XA0;Domain Load-Balancing Algorithm</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc81">6.3.3&#XA0;&#XA0;Load-Balancing Buckets</A>
</LI></UL>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc82">Chapter&#XA0;7&#XA0;&#XA0;Debugging</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc83">7.1&#XA0;&#XA0;Watchdog Alerts</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc84">7.2&#XA0;&#XA0;Log Files</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc85">7.3&#XA0;&#XA0;Debug Console</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc86">Appendix&#XA0;A&#XA0;&#XA0;Internationalization and Localization</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc87">Appendix&#XA0;B&#XA0;&#XA0;Release Notes</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc88">Appendix&#XA0;C&#XA0;&#XA0;Acknowledgements</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc89">Appendix&#XA0;D&#XA0;&#XA0;Copyright Information</A>
</LI></UL><!--TOC chapter Introduction-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc1">Chapter&#XA0;1</A>&#XA0;&#XA0;Introduction</H1><!--SEC END --><P>
<A NAME="intro"></A></P><P><TT>ejabberd</TT> is a free and open source instant messaging server written in <A HREF="http://www.erlang.org/">Erlang</A>.</P><P><TT>ejabberd</TT> is cross-platform, distributed, fault-tolerant, and based on open standards to achieve real-time communication.</P><P><TT>ejabberd</TT> is designed to be a rock-solid and feature rich XMPP server.</P><P><TT>ejabberd</TT> is suitable for small deployments, whether they need to be scalable or not, as well as extremely big deployments.</P><!--TOC section Key Features-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc2">1.1</A>&#XA0;&#XA0;Key Features</H2><!--SEC END --><P>
<A NAME="keyfeatures"></A>
</P><P><TT>ejabberd</TT> is:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Cross-platform: <TT>ejabberd</TT> runs under Microsoft Windows and Unix derived systems such as Linux, FreeBSD and NetBSD.</LI><LI CLASS="li-itemize">Distributed: You can run <TT>ejabberd</TT> on a cluster of machines and all of them will serve the same Jabber domain(s). When you need more capacity you can simply add a new cheap node to your cluster. Accordingly, you do not need to buy an expensive high-end machine to support tens of thousands concurrent users.</LI><LI CLASS="li-itemize">Fault-tolerant: You can deploy an <TT>ejabberd</TT> cluster so that all the information required for a properly working service will be replicated permanently on all nodes. This means that if one of the nodes crashes, the others will continue working without disruption. In addition, nodes also can be added or replaced &#X2018;on the fly&#X2019;.</LI><LI CLASS="li-itemize">Administrator Friendly: <TT>ejabberd</TT> is built on top of the Open Source Erlang. As a result you do not need to install an external database, an external web server, amongst others because everything is already included, and ready to run out of the box. Other administrator benefits include:
<UL CLASS="itemize"><LI CLASS="li-itemize">
Comprehensive documentation.
</LI><LI CLASS="li-itemize">Straightforward installers for Linux, Mac OS X, and Windows. </LI><LI CLASS="li-itemize">Web Administration.
</LI><LI CLASS="li-itemize">Shared Roster Groups.
</LI><LI CLASS="li-itemize">Command line administration tool. </LI><LI CLASS="li-itemize">Can integrate with existing authentication mechanisms.
</LI><LI CLASS="li-itemize">Capability to send announce messages.
</LI></UL></LI><LI CLASS="li-itemize">Internationalized: <TT>ejabberd</TT> leads in internationalization. Hence it is very well suited in a globalized world. Related features are:
<UL CLASS="itemize"><LI CLASS="li-itemize">
Translated to 24 languages. </LI><LI CLASS="li-itemize">Support for <A HREF="http://www.ietf.org/rfc/rfc3490.txt">IDNA</A>.
</LI></UL></LI><LI CLASS="li-itemize">Open Standards: <TT>ejabberd</TT> is the first Open Source Jabber server claiming to fully comply to the XMPP standard.
<UL CLASS="itemize"><LI CLASS="li-itemize">
Fully XMPP compliant.
</LI><LI CLASS="li-itemize">XML-based protocol.
</LI><LI CLASS="li-itemize"><A HREF="http://www.ejabberd.im/protocols">Many protocols supported</A>.
</LI></UL></LI></UL><!--TOC section Additional Features-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc3">1.2</A>&#XA0;&#XA0;Additional Features</H2><!--SEC END --><P>
<A NAME="addfeatures"></A>
</P><P>Moreover, <TT>ejabberd</TT> comes with a wide range of other state-of-the-art features:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Modular
<UL CLASS="itemize"><LI CLASS="li-itemize">
Load only the modules you want.
</LI><LI CLASS="li-itemize">Extend <TT>ejabberd</TT> with your own custom modules.
</LI></UL>
</LI><LI CLASS="li-itemize">Security
<UL CLASS="itemize"><LI CLASS="li-itemize">
SASL and STARTTLS for c2s and s2s connections.
</LI><LI CLASS="li-itemize">STARTTLS and Dialback s2s connections.
</LI><LI CLASS="li-itemize">Web Admin accessible via HTTPS secure access.
</LI></UL>
</LI><LI CLASS="li-itemize">Databases
<UL CLASS="itemize"><LI CLASS="li-itemize">
Internal database for fast deployment (Mnesia).
</LI><LI CLASS="li-itemize">Native MySQL support.
</LI><LI CLASS="li-itemize">Native PostgreSQL support.
</LI><LI CLASS="li-itemize">ODBC data storage support.
</LI><LI CLASS="li-itemize">Microsoft SQL Server support. </LI></UL>
</LI><LI CLASS="li-itemize">Authentication
<UL CLASS="itemize"><LI CLASS="li-itemize">
Internal Authentication.
</LI><LI CLASS="li-itemize">PAM, LDAP and ODBC. </LI><LI CLASS="li-itemize">External Authentication script.
</LI></UL>
</LI><LI CLASS="li-itemize">Others
<UL CLASS="itemize"><LI CLASS="li-itemize">
Support for virtual hosting.
</LI><LI CLASS="li-itemize">Compressing XML streams with Stream Compression (<A HREF="http://www.xmpp.org/extensions/xep-0138.html">XEP-0138</A>).
</LI><LI CLASS="li-itemize">Statistics via Statistics Gathering (<A HREF="http://www.xmpp.org/extensions/xep-0039.html">XEP-0039</A>).
</LI><LI CLASS="li-itemize">IPv6 support both for c2s and s2s connections.
</LI><LI CLASS="li-itemize"><A HREF="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</A> module with support for clustering and HTML logging. </LI><LI CLASS="li-itemize">Users Directory based on users vCards.
</LI><LI CLASS="li-itemize"><A HREF="http://www.xmpp.org/extensions/xep-0060.html">Publish-Subscribe</A> component with support for <A HREF="http://www.xmpp.org/extensions/xep-0163.html">Personal Eventing via Pubsub</A>.
</LI><LI CLASS="li-itemize">Support for web clients: <A HREF="http://www.xmpp.org/extensions/xep-0025.html">HTTP Polling</A> and <A HREF="http://www.xmpp.org/extensions/xep-0206.html">HTTP Binding (BOSH)</A> services.
</LI><LI CLASS="li-itemize">IRC transport.
</LI><LI CLASS="li-itemize">Component support: interface with networks such as AIM, ICQ and MSN installing special tranports.
</LI></UL>
</LI></UL><P> <A NAME="installing"></A> </P><!--TOC chapter Installing <TT>ejabberd</TT>-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc4">Chapter&#XA0;2</A>&#XA0;&#XA0;<A HREF="#installing">Installing <TT>ejabberd</TT></A></H1><!--SEC END --><P> <A NAME="installing"></A> </P><P> <A NAME="install.binary"></A> </P><!--TOC section Installing <TT>ejabberd</TT> with Binary Installer-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc5">2.1</A>&#XA0;&#XA0;<A HREF="#install.binary">Installing <TT>ejabberd</TT> with Binary Installer</A></H2><!--SEC END --><P> <A NAME="install.binary"></A> </P><P>Probably the easiest way to install an <TT>ejabberd</TT> instant messaging server
is using the binary installer published by ProcessOne.
The binary installers of released <TT>ejabberd</TT> versions
are available in the ProcessOne <TT>ejabberd</TT> downloads page:
<A HREF="http://www.process-one.net/en/ejabberd/downloads"><TT>http://www.process-one.net/en/ejabberd/downloads</TT></A></P><P>The installer will deploy and configure a full featured <TT>ejabberd</TT>
server and does not require any extra dependencies.</P><P>In *nix systems, remember to set executable the binary installer before starting it. For example:
</P><PRE CLASS="verbatim">chmod +x ejabberd-2.0.0_1-linux-x86-installer.bin
./ejabberd-2.0.0_1-linux-x86-installer.bin
</PRE><P><TT>ejabberd</TT> can be started manually at any time,
or automatically by the operating system at system boot time.</P><P>To start and stop <TT>ejabberd</TT> manually,
use the desktop shortcuts created by the installer.
If the machine doesn&#X2019;t have a graphical system, use the scripts &#X2019;start&#X2019;
and &#X2019;stop&#X2019; in the &#X2019;bin&#X2019; directory where <TT>ejabberd</TT> is installed.</P><P>The Windows installer also adds ejabberd as a system service,
and a shortcut to a debug console for experienced administrators.
If you want ejabberd to be started automatically at boot time,
go to the Windows service settings and set ejabberd to be automatically started.
Note that the Windows service is a feature still in development,
and for example it doesn&#X2019;t read the file ejabberdctl.cfg.</P><P>On a *nix system, if you want ejabberd to be started as daemon at boot time,
copy <TT>ejabberd.init</TT> from the &#X2019;bin&#X2019; directory to something like <TT>/etc/init.d/ejabberd</TT>
(depending on your distribution) and call <TT>/etc/inid.d/ejabberd start</TT> to start it.</P><P>If <TT>ejabberd</TT> doesn&#X2019;t start correctly in Windows,
try to start it using the shortcut in desktop or start menu.
If the window shows error 14001, the solution is to install:
"Microsoft Visual C++ 2005 SP1 Redistributable Package".
You can download it from
<A HREF="http://www.microsoft.com/">www.microsoft.com</A>.
Then uninstall <TT>ejabberd</TT> and install it again.</P><P>If <TT>ejabberd</TT> doesn&#X2019;t start correctly and a crash dump is generated,
there was a severe problem.
You can try starting <TT>ejabberd</TT> with
the script <TT>bin/live.bat</TT> in Windows,
or with the command <TT>bin/ejabberdctl live</TT> in other Operating Systems.
This way you see the error message provided by Erlang
and can identify what is exactly the problem.</P><P>The <TT>ejabberdctl</TT> administration script is included in the <TT>bin</TT> directory.
Please refer to the section&#XA0;<A HREF="#ejabberdctl">4.1</A> for details about <TT>ejabberdctl</TT>,
and configurable options to fine tune the Erlang runtime system.</P><P> <A NAME="install.os"></A> </P><!--TOC section Installing <TT>ejabberd</TT> with Operating System specific packages-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc6">2.2</A>&#XA0;&#XA0;<A HREF="#install.os">Installing <TT>ejabberd</TT> with Operating System specific packages</A></H2><!--SEC END --><P> <A NAME="install.os"></A> </P><P>Some Operating Systems provide a specific <TT>ejabberd</TT> package adapted to
the system architecture and libraries.
It usually also checks dependencies
and performs basic configuration tasks like creating the initial
administrator account. Some examples are Debian and Gentoo. Consult the
resources provided by your Operating System for more information.</P><P>Usually those packages create a script like <TT>/etc/init.d/ejabberd</TT>
to start and stop <TT>ejabberd</TT> as a service at boot time.</P><P> <A NAME="install.cean"></A> </P><!--TOC section Installing <TT>ejabberd</TT> with CEAN-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc7">2.3</A>&#XA0;&#XA0;<A HREF="#install.cean">Installing <TT>ejabberd</TT> with CEAN</A></H2><!--SEC END --><P> <A NAME="install.cean"></A> </P><P><A HREF="http://cean.process-one.net/">CEAN</A>
(Comprehensive Erlang Archive Network) is a repository that hosts binary
packages from many Erlang programs, including <TT>ejabberd</TT> and all its dependencies.
The binaries are available for many different system architectures, so this is an
alternative to the binary installer and Operating System&#X2019;s <TT>ejabberd</TT> packages.</P><P>You will have to create your own <TT>ejabberd</TT> start
script depending of how you handle your CEAN installation.
The default <TT>ejabberdctl</TT> script is located
into <TT>ejabberd</TT>&#X2019;s priv directory and can be used as an example.</P><P> <A NAME="installation"></A> </P><!--TOC section Installing <TT>ejabberd</TT> from Source Code-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc8">2.4</A>&#XA0;&#XA0;<A HREF="#installation">Installing <TT>ejabberd</TT> from Source Code</A></H2><!--SEC END --><P> <A NAME="installation"></A> 
</P><P>The canonical form for distribution of <TT>ejabberd</TT> stable releases is the source code package.
Compiling <TT>ejabberd</TT> from source code is quite easy in *nix systems,
as long as your system have all the dependencies.</P><P> <A NAME="installreq"></A> </P><!--TOC subsection Requirements-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc9">2.4.1</A>&#XA0;&#XA0;<A HREF="#installreq">Requirements</A></H3><!--SEC END --><P> <A NAME="installreq"></A> 
</P><P>To compile <TT>ejabberd</TT> on a &#X2018;Unix-like&#X2019; operating system, you need:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
GNU Make
</LI><LI CLASS="li-itemize">GCC
</LI><LI CLASS="li-itemize">Libexpat 1.95 or higher
</LI><LI CLASS="li-itemize">Erlang/OTP R10B-9 or newer.
</LI><LI CLASS="li-itemize">OpenSSL 0.9.6 or higher, for STARTTLS, SASL and SSL encryption. Optional, highly recommended.
</LI><LI CLASS="li-itemize">Zlib 1.2.3 or higher, for Stream Compression support (<A HREF="http://www.xmpp.org/extensions/xep-0138.html">XEP-0138</A>). Optional.
</LI><LI CLASS="li-itemize">GNU Iconv 1.8 or higher, for the IRC Transport (mod_irc). Optional. Not needed on systems with GNU Libc.
</LI></UL><P> <A NAME="download"></A> </P><!--TOC subsection Download Source Code-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc10">2.4.2</A>&#XA0;&#XA0;<A HREF="#download">Download Source Code</A></H3><!--SEC END --><P> <A NAME="download"></A> 
</P><P>Released versions of <TT>ejabberd</TT> are available in the ProcessOne <TT>ejabberd</TT> downloads page:
<A HREF="http://www.process-one.net/en/ejabberd/downloads"><TT>http://www.process-one.net/en/ejabberd/downloads</TT></A></P><P>
Alternatively, the latest development version can be retrieved from the Subversion repository using this command:
</P><PRE CLASS="verbatim">svn co http://svn.process-one.net/ejabberd/trunk ejabberd
</PRE><P> <A NAME="compile"></A> </P><!--TOC subsection Compile-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc11">2.4.3</A>&#XA0;&#XA0;<A HREF="#compile">Compile</A></H3><!--SEC END --><P> <A NAME="compile"></A> 
</P><P>To compile <TT>ejabberd</TT> execute the commands:
</P><PRE CLASS="verbatim">./configure
make
</PRE><P>The build configuration script allows several options.
To get the full list run the command:
</P><PRE CLASS="verbatim">./configure --help
</PRE><P>Some options that you may be interested in modifying:
</P><DL CLASS="description"><DT CLASS="dt-description">
	<B><TT>--prefix=/</TT></B></DT><DD CLASS="dd-description">
	Specify the path prefix where the files will be copied when running the make install command.<P>	</P></DD><DT CLASS="dt-description"><B><TT>--enable-pam</TT></B></DT><DD CLASS="dd-description">
	Enable the PAM authentication method (see section <A HREF="#pam">3.1.4</A>).<P>	</P></DD><DT CLASS="dt-description"><B><TT>--enable-odbc or --enable-mssql</TT></B></DT><DD CLASS="dd-description">
	Required if you want to use an external database.
	See section&#XA0;<A HREF="#database">3.2</A> for more information.<P>	</P></DD><DT CLASS="dt-description"><B><TT>--enable-full-xml</TT></B></DT><DD CLASS="dd-description">
	Enable the use of XML based optimisations.
	It will for example use CDATA to escape characters in the XMPP stream.
	Use this option only if you are sure your Jabber clients include a fully compliant XML parser.<P>	</P></DD><DT CLASS="dt-description"><B><TT>--disable-transient-supervisors</TT></B></DT><DD CLASS="dd-description">
	Disable the use of Erlang/OTP supervision for transient processes.
</DD></DL><P> <A NAME="install"></A> </P><!--TOC subsection Install-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc12">2.4.4</A>&#XA0;&#XA0;<A HREF="#install">Install</A></H3><!--SEC END --><P> <A NAME="install"></A> 
</P><P>To install <TT>ejabberd</TT> in the destination directories, run the command:
</P><PRE CLASS="verbatim">make install
</PRE><P>Note that you probably need administrative privileges in the system
to install <TT>ejabberd</TT>.</P><P>The files and directories created are, by default:
</P><DL CLASS="description"><DT CLASS="dt-description">
	<B><TT>/etc/ejabberd/</TT></B></DT><DD CLASS="dd-description"> Configuration files:
		<DL CLASS="description"><DT CLASS="dt-description">
			<B><TT>ejabberd.cfg</TT></B></DT><DD CLASS="dd-description"> ejabberd configuration file
			</DD><DT CLASS="dt-description"><B><TT>ejabberdctl.cfg</TT></B></DT><DD CLASS="dd-description"> Configuration file of the administration script
			</DD><DT CLASS="dt-description"><B><TT>inetrc</TT></B></DT><DD CLASS="dd-description"> Network DNS configuration
		</DD></DL>
	</DD><DT CLASS="dt-description"><B><TT>/sbin/ejabberdctl</TT></B></DT><DD CLASS="dd-description"> Administration script (see section&#XA0;<A HREF="#ejabberdctl">4.1</A>)
	</DD><DT CLASS="dt-description"><B><TT>/var/lib/ejabberd/</TT></B></DT><DD CLASS="dd-description">
		<DL CLASS="description"><DT CLASS="dt-description">
			<B><TT>.erlang.cookie</TT></B></DT><DD CLASS="dd-description"> Erlang cookie file (see section <A HREF="#cookie">5.3</A>)
			</DD><DT CLASS="dt-description"><B><TT>db</TT></B></DT><DD CLASS="dd-description"> Mnesia database spool files
			</DD><DT CLASS="dt-description"><B><TT>ebin</TT></B></DT><DD CLASS="dd-description"> Binary Erlang files (*.beam)
			</DD><DT CLASS="dt-description"><B><TT>priv</TT></B></DT><DD CLASS="dd-description">
				<DL CLASS="description"><DT CLASS="dt-description">
					<B><TT>bin</TT></B></DT><DD CLASS="dd-description"> Binary C programs
					</DD><DT CLASS="dt-description"><B><TT>lib</TT></B></DT><DD CLASS="dd-description"> Binary system libraries (*.so)
					</DD><DT CLASS="dt-description"><B><TT>msgs</TT></B></DT><DD CLASS="dd-description"> Translated strings (*.msgs)
				</DD></DL>
		</DD></DL>
	</DD><DT CLASS="dt-description"><B><TT>/var/log/ejabberd/</TT></B></DT><DD CLASS="dd-description"> Log files (see section&#XA0;<A HREF="#logfiles">7.2</A>):
		<DL CLASS="description"><DT CLASS="dt-description">
			<B><TT>ejabberd.log</TT></B></DT><DD CLASS="dd-description"> ejabberd service log
			</DD><DT CLASS="dt-description"><B><TT>sasl.log</TT></B></DT><DD CLASS="dd-description"> Erlang/OTP system log
		</DD></DL>
</DD></DL><P> <A NAME="start"></A> </P><!--TOC subsection Start-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc13">2.4.5</A>&#XA0;&#XA0;<A HREF="#start">Start</A></H3><!--SEC END --><P> <A NAME="start"></A> 
</P><P>You can use the <TT>ejabberdctl</TT> command line administration script to start and stop <TT>ejabberd</TT>.</P><P>Usage example:
</P><PRE CLASS="verbatim">ejabberdctl start

ejabberdctl status
Node ejabberd@localhost is started. Status: started
ejabberd is running

ejabberdctl stop
</PRE><P>If <TT>ejabberd</TT> doesn&#X2019;t start correctly and a crash dump is generated,
there was a severe problem.
You can try starting <TT>ejabberd</TT> with
the command <TT>ejabberdctl live</TT>
to see the error message provided by Erlang
and can identify what is exactly the problem.</P><P>Please refer to the section&#XA0;<A HREF="#ejabberdctl">4.1</A> for details about <TT>ejabberdctl</TT>,
and configurable options to fine tune the Erlang runtime system.</P><P> <A NAME="bsd"></A> </P><!--TOC subsection Specific Notes for BSD-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc14">2.4.6</A>&#XA0;&#XA0;<A HREF="#bsd">Specific Notes for BSD</A></H3><!--SEC END --><P> <A NAME="bsd"></A> 
</P><P>The command to compile <TT>ejabberd</TT> in BSD systems is:
</P><PRE CLASS="verbatim">gmake
</PRE><P> <A NAME="solaris"></A> </P><!--TOC subsection Specific Notes for Sun Solaris-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc15">2.4.7</A>&#XA0;&#XA0;<A HREF="#solaris">Specific Notes for Sun Solaris</A></H3><!--SEC END --><P> <A NAME="solaris"></A> 
</P><P>You need to have <TT>GNU install</TT>,
but it isn&#X2019;t included in Solaris.
It can be easily installed if your Solaris system
is set up for <A HREF="http://www.blastwave.org/">blastwave.org</A>
package repository.
Make sure <TT>/opt/csw/bin</TT> is in your <TT>PATH</TT> and run:
</P><PRE CLASS="verbatim">pkg-get -i fileutils
</PRE><P>If that program is called <TT>ginstall</TT>,
modify the <TT>ejabberd</TT> <TT>Makefile</TT> script to suit your system,
for example:
</P><PRE CLASS="verbatim">cat Makefile | sed s/install/ginstall/ &gt; Makefile.gi
</PRE><P>And finally install <TT>ejabberd</TT> with:
</P><PRE CLASS="verbatim">gmake -f Makefile.gi ginstall
</PRE><P> <A NAME="windows"></A> </P><!--TOC subsection Specific Notes for Microsoft Windows-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc16">2.4.8</A>&#XA0;&#XA0;<A HREF="#windows">Specific Notes for Microsoft Windows</A></H3><!--SEC END --><P> <A NAME="windows"></A> 
</P><P> <A NAME="windowsreq"></A> </P><!--TOC subsubsection Requirements-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#windowsreq">Requirements</A></H4><!--SEC END --><P> <A NAME="windowsreq"></A> </P><P>To compile <TT>ejabberd</TT> on a Microsoft Windows system, you need:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
MS Visual C++ 6.0 Compiler
</LI><LI CLASS="li-itemize"><A HREF="http://www.erlang.org/download.html">Erlang/OTP R11B-5</A>
</LI><LI CLASS="li-itemize"><A HREF="http://sourceforge.net/project/showfiles.php?group_id=10127&package_id=11277">Expat 2.0.0 or higher</A>
</LI><LI CLASS="li-itemize"><A HREF="http://www.gnu.org/software/libiconv/">GNU Iconv 1.9.2</A>
(optional)
</LI><LI CLASS="li-itemize"><A HREF="http://www.slproweb.com/products/Win32OpenSSL.html">Shining Light OpenSSL 0.9.8d or higher</A>
(to enable SSL connections)
</LI><LI CLASS="li-itemize"><A HREF="http://www.zlib.net/">Zlib 1.2.3 or higher</A>
</LI></UL><P> <A NAME="windowscom"></A> </P><!--TOC subsubsection Compilation-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#windowscom">Compilation</A></H4><!--SEC END --><P> <A NAME="windowscom"></A> </P><P>We assume that we will try to put as much library as possible into <CODE>C:\sdk\</CODE> to make it easier to track what is install for <TT>ejabberd</TT>.</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Install Erlang emulator (for example, into <CODE>C:\sdk\erl5.5.5</CODE>).
</LI><LI CLASS="li-enumerate">Install Expat library into <CODE>C:\sdk\Expat-2.0.0</CODE>
directory.<P>Copy file <CODE>C:\sdk\Expat-2.0.0\Libs\libexpat.dll</CODE>
to your Windows system directory (for example, <CODE>C:\WINNT</CODE> or
<CODE>C:\WINNT\System32</CODE>)
</P></LI><LI CLASS="li-enumerate">Build and install the Iconv library into the directory
<CODE>C:\sdk\GnuWin32</CODE>.<P>Copy file <CODE>C:\sdk\GnuWin32\bin\lib*.dll</CODE> to your
Windows system directory (more installation instructions can be found in the
file README.woe32 in the iconv distribution).</P><P>Note: instead of copying libexpat.dll and iconv.dll to the Windows
directory, you can add the directories
<CODE>C:\sdk\Expat-2.0.0\Libs</CODE> and
<CODE>C:\sdk\GnuWin32\bin</CODE> to the <CODE>PATH</CODE> environment
variable.
</P></LI><LI CLASS="li-enumerate">Install OpenSSL in <CODE>C:\sdk\OpenSSL</CODE> and add <CODE>C:\sdk\OpenSSL\lib\VC</CODE> to your path or copy the binaries to your system directory.
</LI><LI CLASS="li-enumerate">Install ZLib in <CODE>C:\sdk\gnuWin32</CODE>. Copy
<CODE>C:\sdk\GnuWin32\bin\zlib1.dll</CODE> to your system directory. If you change your path it should already be set after libiconv install.
</LI><LI CLASS="li-enumerate">Make sure the you can access Erlang binaries from your path. For example: <CODE>set PATH=%PATH%;"C:\sdk\erl5.5.5\bin"</CODE>
</LI><LI CLASS="li-enumerate">Depending on how you end up actually installing the library you might need to check and tweak the paths in the file configure.erl.
</LI><LI CLASS="li-enumerate">While in the directory <CODE>ejabberd\src</CODE> run:
<PRE CLASS="verbatim">configure.bat
nmake -f Makefile.win32
</PRE></LI><LI CLASS="li-enumerate">Edit the file <CODE>ejabberd\src\ejabberd.cfg</CODE> and run
<PRE CLASS="verbatim">werl -s ejabberd -name ejabberd
</PRE></LI></OL><P> <A NAME="initialadmin"></A> </P><!--TOC section Create a Jabber Account for Administration-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc17">2.5</A>&#XA0;&#XA0;<A HREF="#initialadmin">Create a Jabber Account for Administration</A></H2><!--SEC END --><P> <A NAME="initialadmin"></A> </P><P>You need a Jabber account and grant him administrative privileges
to enter the <TT>ejabberd</TT> Web Admin:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Register a Jabber account on your <TT>ejabberd</TT> server, for example <TT>admin1@example.org</TT>.
There are two ways to register a Jabber account:
<OL CLASS="enumerate" type=a><LI CLASS="li-enumerate">
Using <TT>ejabberdctl</TT> (see section&#XA0;<A HREF="#ejabberdctl">4.1</A>):
<PRE CLASS="verbatim">ejabberdctl register admin1 example.org FgT5bk3
</PRE></LI><LI CLASS="li-enumerate">Using a Jabber client and In-Band Registration (see section&#XA0;<A HREF="#modregister">3.3.15</A>).
</LI></OL>
</LI><LI CLASS="li-enumerate">Edit the <TT>ejabberd</TT> configuration file to give administration rights to the Jabber account you created:
<PRE CLASS="verbatim">{acl, admins, {user, "admin1", "example.org"}}.
{access, configure, [{allow, admins}]}.
</PRE>You can grant administrative privileges to many Jabber accounts,
and also to accounts in other Jabber servers.
</LI><LI CLASS="li-enumerate">Restart <TT>ejabberd</TT> to load the new configuration.
</LI><LI CLASS="li-enumerate">Open the Web Admin (<CODE>http://server:port/admin/</CODE>) in your
favourite browser. Make sure to enter the <EM>full</EM> JID as username (in this
example: <TT>admin1@example.org</TT>. The reason that you also need to enter the
suffix, is because <TT>ejabberd</TT>&#X2019;s virtual hosting support.
</LI></OL><P> <A NAME="upgrade"></A> </P><!--TOC section Upgrading <TT>ejabberd</TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc18">2.6</A>&#XA0;&#XA0;<A HREF="#upgrade">Upgrading <TT>ejabberd</TT></A></H2><!--SEC END --><P> <A NAME="upgrade"></A> </P><P>To upgrade an ejabberd installation to a new version,
simply uninstall the old version, and then install the new one.
Of course, it is important that the configuration file
and Mnesia database spool directory are not removed.</P><P><TT>ejabberd</TT> automatically updates the Mnesia table definitions at startup when needed.
If you also use an external database for storage of some modules,
check if the release notes of the new ejabberd version
indicates you need to also update those tables.</P><P> <A NAME="configure"></A> </P><!--TOC chapter Configuring <TT>ejabberd</TT>-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc19">Chapter&#XA0;3</A>&#XA0;&#XA0;<A HREF="#configure">Configuring <TT>ejabberd</TT></A></H1><!--SEC END --><P> <A NAME="configure"></A> 
</P><P> <A NAME="basicconfig"></A> </P><!--TOC section Basic Configuration-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc20">3.1</A>&#XA0;&#XA0;<A HREF="#basicconfig">Basic Configuration</A></H2><!--SEC END --><P> <A NAME="basicconfig"></A> </P><P>The configuration file will be loaded the first time you start <TT>ejabberd</TT>. The
content from this file will be parsed and stored in the internal <TT>ejabberd</TT> database. Subsequently the
configuration will be loaded from the database and any commands in the
configuration file are appended to the entries in the database.</P><P>Note that <TT>ejabberd</TT> never edits the configuration file.
So, the configuration changes done using the Web Admin
are stored in the database, but are not reflected in the configuration file.
If you want those changes to be use after <TT>ejabberd</TT> restart, you can either
edit the configuration file, or remove all its content.</P><P>The configuration file contains a sequence of Erlang terms. Lines beginning with a
<TT>&#X2018;%&#X2019;</TT> sign are ignored. Each term is a tuple of which the first element is
the name of an option, and any further elements are that option&#X2019;s values. If the
configuration file do not contain for instance the &#X2018;hosts&#X2019; option, the old
host name(s) stored in the database will be used.</P><P>You can override the old values stored in the database by adding next lines to
the configuration file:
</P><PRE CLASS="verbatim">override_global.
override_local.
override_acls.
</PRE><P>With these lines the old global options (shared between all <TT>ejabberd</TT> nodes in a
cluster), local options (which are specific for this particular <TT>ejabberd</TT> node)
and ACLs will be removed before new ones are added.</P><P> <A NAME="hostnames"></A> </P><!--TOC subsection Host Names-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc21">3.1.1</A>&#XA0;&#XA0;<A HREF="#hostnames">Host Names</A></H3><!--SEC END --><P> <A NAME="hostnames"></A> 
</P><P>The option <TT>hosts</TT> defines a list containing one or more domains that
<TT>ejabberd</TT> will serve.</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Serving one domain:
<PRE CLASS="verbatim">{hosts, ["example.org"]}.
</PRE></LI><LI CLASS="li-itemize">Serving one domain, and backwards compatible with older <TT>ejabberd</TT>
versions:
<PRE CLASS="verbatim">{host, "example.org"}.
</PRE></LI><LI CLASS="li-itemize">Serving two domains:
<PRE CLASS="verbatim">{hosts, ["example.net", "example.com"]}.
</PRE></LI></UL><P> <A NAME="virtualhost"></A> </P><!--TOC subsection Virtual Hosting-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc22">3.1.2</A>&#XA0;&#XA0;<A HREF="#virtualhost">Virtual Hosting</A></H3><!--SEC END --><P> <A NAME="virtualhost"></A> 
</P><P>Options can be defined separately for every virtual host using the
<TT>host_config</TT> option. It has the following
syntax:
</P><PRE CLASS="verbatim">{host_config, &lt;hostname&gt;, [&lt;option&gt;, &lt;option&gt;, ...]}.
</PRE><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Domain <TT>example.net</TT> is using the internal authentication method while
domain <TT>example.com</TT> is using the LDAP server running on the
domain <TT>localhost</TT> to perform authentication:
<PRE CLASS="verbatim">{host_config, "example.net", [{auth_method,   internal}]}.

{host_config, "example.com", [{auth_method,   ldap},
                              {ldap_servers,  ["localhost"]},
                              {ldap_uids,     [{"uid"}]},
                              {ldap_rootdn,   "dc=localdomain"},
                              {ldap_rootdn,   "dc=example,dc=com"},
                              {ldap_password, ""}]}.
</PRE></LI><LI CLASS="li-itemize">Domain <TT>example.net</TT> is using ODBC to perform authentication
while domain <TT>example.com</TT> is using the LDAP servers running on the domains
<TT>localhost</TT> and <TT>otherhost</TT>:
<PRE CLASS="verbatim">{host_config, "example.net", [{auth_method, odbc},
                              {odbc_server, "DSN=ejabberd;UID=ejabberd;PWD=ejabberd"}]}.

{host_config, "example.com", [{auth_method,   ldap},
                              {ldap_servers,  ["localhost", "otherhost"]},
                              {ldap_uids,     [{"uid"}]},
                              {ldap_rootdn,   "dc=localdomain"},
                              {ldap_rootdn,   "dc=example,dc=com"},
                              {ldap_password, ""}]}.
</PRE></LI></UL><P>To define specific ejabberd modules in a virtual host,
you can define the global <TT>modules</TT> option with the common modules,
and later add specific modules to certain virtual hosts.
To accomplish that, instead of defining each option in <TT>host_config</TT> with the syntax
</P><PRE CLASS="verbatim">{&lt;option-name&gt;, &lt;option-value&gt;}
</PRE><P>use this syntax:
</P><PRE CLASS="verbatim">{{add, &lt;option-name&gt;}, &lt;option-value&gt;}
</PRE><P>In this example three virtual hosts have some similar modules, but there are also
other different modules for some specific virtual hosts:
</P><PRE CLASS="verbatim">%% This ejabberd server has three vhosts:
{hosts, ["one.example.org", "two.example.org", "three.example.org"]}.

%% Configuration of modules that are common to all vhosts
{modules,
 [
  {mod_roster,     []},
  {mod_configure,  []},
  {mod_disco,      []},
  {mod_private,    []},
  {mod_time,       []},
  {mod_last,       []},
  {mod_version,    []}
 ]}.

%% Add some modules to vhost one:
{host_config, "one.example.org",
 [{{add, modules}, [
                    {mod_echo,       [{host, "echo-service.one.example.org"}]}
                    {mod_http_bind,  []},
                    {mod_logxml,     []}
                   ]
  }
 ]}.

%% Add a module just to vhost two:
{host_config, "two.example.org",
 [{{add, modules}, [
                    {mod_echo,       [{host, "mirror.two.example.org"}]}
                   ]
  }
 ]}.
</PRE><P> <A NAME="listened"></A> </P><!--TOC subsection Listening Ports-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc23">3.1.3</A>&#XA0;&#XA0;<A HREF="#listened">Listening Ports</A></H3><!--SEC END --><P> <A NAME="listened"></A> 
</P><P>The option <TT>listen</TT> defines for which addresses and ports <TT>ejabberd</TT>
will listen and what services will be run on them. Each element of the list is a
tuple with the following elements:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Port number.
</LI><LI CLASS="li-itemize">Module that serves this port.
</LI><LI CLASS="li-itemize">Options to this module.
</LI></UL><P>
The available modules, their purpose and the options allowed by each one are:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>ejabberd_c2s</TT></B></DT><DD CLASS="dd-description">
Handles c2s connections.<BR>
 Options: <TT>access</TT>, <TT>certfile</TT>, <TT>inet6</TT>,
<TT>ip</TT>, <TT>max_stanza_size</TT>, <TT>shaper</TT>,
<TT>starttls</TT>, <TT>starttls_required</TT>, <TT>tls</TT>,
<TT>zlib</TT>
</DD><DT CLASS="dt-description"><B><TT>ejabberd_s2s_in</TT></B></DT><DD CLASS="dd-description">
Handles incoming s2s connections.<BR>
 Options: <TT>inet6</TT>, <TT>ip</TT>, <TT>max_stanza_size</TT>
</DD><DT CLASS="dt-description"><B><TT>ejabberd_service</TT></B></DT><DD CLASS="dd-description">
Interacts with an <A HREF="http://www.ejabberd.im/tutorials-transports">external component</A>
(as defined in the Jabber Component Protocol (<A HREF="http://www.xmpp.org/extensions/xep-0114.html">XEP-0114</A>).<BR>
 Options: <TT>access</TT>, <TT>hosts</TT>, <TT>inet6</TT>,
<TT>ip</TT>, <TT>shaper</TT>, <TT>service_check_from</TT>
</DD><DT CLASS="dt-description"><B><TT>ejabberd_http</TT></B></DT><DD CLASS="dd-description">
Handles incoming HTTP connections.<BR>
 Options: <TT>certfile</TT>, <TT>http_bind</TT>, <TT>http_poll</TT>,
<TT>inet6</TT>, <TT>ip</TT>, <TT>request_handlers</TT>, <TT>tls</TT>, <TT>web_admin</TT><BR>
</DD></DL><P>This is a detailed description of each option allowed by the listening modules:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>{access, &lt;access rule&gt;}</TT></B></DT><DD CLASS="dd-description"> This option defines
access to the port. The default value is <TT>all</TT>.
</DD><DT CLASS="dt-description"><B><TT>{certfile, Path}</TT></B></DT><DD CLASS="dd-description"> Full path to a file containing the default SSL certificate.
To define a certificate file specific for a given domain, use the global option <TT>domain_certfile</TT>.
</DD><DT CLASS="dt-description"><B><TT>service_check_from</TT></B></DT><DD CLASS="dd-description"> 
This option can be used with <TT>ejabberd_service</TT> only. It is
used to disable control on the from field on packets send by an
external components. The option can be either <TT>true</TT> or
<TT>false</TT>. The default value is <TT>true</TT> which conforms to <A HREF="http://www.xmpp.org/extensions/xep-0114.html">XEP-0114</A>.
</DD><DT CLASS="dt-description"><B><TT>{hosts, [Hostnames], [HostOptions]}</TT></B></DT><DD CLASS="dd-description"> 
The external Jabber component that connects to this <TT>ejabberd_service</TT>
can serve one or more hostnames.
In <TT>HostOptions</TT> you can define options for the component;
currently the only allowed option is the password required to the component
when attempt to connect to ejabberd: <TT>{password, Secret}</TT>.
Note that you cannot define in a single <TT>ejabberd_service</TT> components of
different services: add an <TT>ejabberd_service</TT> for each service,
as seen in an example below.
</DD><DT CLASS="dt-description"><B><TT>http_bind</TT></B></DT><DD CLASS="dd-description"> 
This option enables HTTP Binding (<A HREF="http://www.xmpp.org/extensions/xep-0124.html">XEP-0124</A> and <A HREF="http://www.xmpp.org/extensions/xep-0206.html">XEP-0206</A>) support. HTTP Bind
enables access via HTTP requests to <TT>ejabberd</TT> from behind firewalls which
do not allow outgoing sockets on port 5222.<P>Remember that you must also install and enable the module mod_http_bind.</P><P>If HTTP Bind is enabled, it will be available at
<CODE>http://server:port/http-bind/</CODE>. Be aware that support for HTTP Bind
is also needed in the Jabber client. Remark also that HTTP Bind can be
interesting to host a web-based Jabber client such as
<A HREF="http://jwchat.sourceforge.net/">JWChat</A>
(check the tutorials to install JWChat with ejabberd and an
<A HREF="http://www.ejabberd.im/jwchat-localserver">embedded local web server</A>
or <A HREF="http://www.ejabberd.im/jwchat-apache">Apache</A>).
</P></DD><DT CLASS="dt-description"><B><TT>http_poll</TT></B></DT><DD CLASS="dd-description"> 
This option enables HTTP Polling (<A HREF="http://www.xmpp.org/extensions/xep-0025.html">XEP-0025</A>) support. HTTP Polling
enables access via HTTP requests to <TT>ejabberd</TT> from behind firewalls which
do not allow outgoing sockets on port 5222.<P>If HTTP Polling is enabled, it will be available at
<CODE>http://server:port/http-poll/</CODE>. Be aware that support for HTTP Polling
is also needed in the Jabber client. Remark also that HTTP Polling can be
interesting to host a web-based Jabber client such as
<A HREF="http://jwchat.sourceforge.net/">JWChat</A>.
</P></DD><DT CLASS="dt-description"><B><TT>inet6</TT></B></DT><DD CLASS="dd-description"> Set up the socket for IPv6 instead of IPv4.
Note: this option is not required for S2S outgoing connections,
because when ejabberd attempts to establish a S2S outgoing connection
it first tries IPv4, and if that fails it attempts with IPv6.
</DD><DT CLASS="dt-description"><B><TT>{ip, IPAddress}</TT></B></DT><DD CLASS="dd-description"> This option specifies which network
interface to listen for. For example <CODE>{ip, {192, 168, 1, 1}}</CODE>.
</DD><DT CLASS="dt-description"><B><TT>{max_stanza_size, Size}</TT></B></DT><DD CLASS="dd-description">
This option specifies an
approximate maximum size in bytes of XML stanzas. Approximate,
because it is calculated with the precision of one block of readed
data. For example <CODE>{max_stanza_size, 65536}</CODE>. The default
value is <TT>infinity</TT>. Recommended values are 65536 for c2s
connections and 131072 for s2s connections. s2s max stanza size
must always much higher than c2s limit. Change this value with
extreme care as it can cause unwanted disconnect if set too low.
</DD><DT CLASS="dt-description"><B><TT>{request_handlers, [{Path, Module}]}</TT></B></DT><DD CLASS="dd-description"> To define one or several handlers that will serve HTTP requests.
The Path is a list of strings; so the URIs that start with that Path will be served by Module.
For example, if you want <TT>mod_foo</TT> to serve the URIs that start with <TT>/a/b/</TT>,
and you also want <TT>mod_http_bind</TT> to serve the URIs <TT>/http-bind/</TT>,
use this option: <TT>{request_handlers, [{["a", "b"], mod_foo}, {["http-bind"], mod_http_bind}]}</TT>
</DD><DT CLASS="dt-description"><B><TT>{service_check_from, true|false}</TT></B></DT><DD CLASS="dd-description">
By enabling this option, <TT>ejabberd</TT> allows the component to send packets with any arbitrary domain in the &#X2019;from&#X2019; attribute.
Note that <A HREF="http://www.xmpp.org/extensions/xep-0114.html">XEP-0114</A> requires that the domain must match the hostname of the component.
Only enable this option if you are completely sure you need to enable it.
Default value: false.
</DD><DT CLASS="dt-description"><B><TT>{shaper, &lt;access rule&gt;}</TT></B></DT><DD CLASS="dd-description"> This option defines a
shaper for the port (see section&#XA0;<A HREF="#shapers">3.1.6</A>). The default value
is <TT>none</TT>.
</DD><DT CLASS="dt-description"><B><TT>starttls</TT></B></DT><DD CLASS="dd-description"> This option
specifies that STARTTLS encryption is available on connections to the port.
You should also set the <TT>certfile</TT> option.
You can define a certificate file for a specific domain using the global option <TT>domain_certfile</TT>.
</DD><DT CLASS="dt-description"><B><TT>starttls_required</TT></B></DT><DD CLASS="dd-description"> This option
specifies that STARTTLS encryption is required on connections to the port.
No unencrypted connections will be allowed.
You should also set the <TT>certfile</TT> option.
You can define a certificate file for a specific domain using the global option <TT>domain_certfile</TT>.
</DD><DT CLASS="dt-description"><B><TT>tls</TT></B></DT><DD CLASS="dd-description"> This option specifies that traffic on
the port will be encrypted using SSL immediately after connecting. You
should also set the <TT>certfile</TT> option.
</DD><DT CLASS="dt-description"><B><TT>web_admin</TT></B></DT><DD CLASS="dd-description"> This option
enables the Web Admin for <TT>ejabberd</TT> administration which is available
at <CODE>http://server:port/admin/</CODE>. Login and password are the username and
password of one of the registered users who are granted access by the
&#X2018;configure&#X2019; access rule.
</DD><DT CLASS="dt-description"><B><TT>zlib</TT></B></DT><DD CLASS="dd-description"> This
option specifies that Zlib stream compression (as defined in <A HREF="http://www.xmpp.org/extensions/xep-0138.html">XEP-0138</A>)
is available on connections to the port. Client connections cannot use
stream compression and stream encryption simultaneously. Hence, if you
specify both <TT>tls</TT> (or <TT>ssl</TT>) and <TT>zlib</TT>, the latter
option will not affect connections (there will be no stream compression).
</DD></DL><P>There are some additional global options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>{s2s_use_starttls, true|false}</TT></B></DT><DD CLASS="dd-description">
This option defines whether to
use STARTTLS for s2s connections.
</DD><DT CLASS="dt-description"><B><TT>{s2s_certfile, Path}</TT></B></DT><DD CLASS="dd-description"> Full path to a
file containing a SSL certificate.
</DD><DT CLASS="dt-description"><B><TT>{domain_certfile, Domain, Path}</TT></B></DT><DD CLASS="dd-description"> 
Full path to the file containing the SSL certificate for a specific domain.
</DD><DT CLASS="dt-description"><B><TT>{s2s_default_policy, allow|deny}</TT></B></DT><DD CLASS="dd-description">
The default policy for incoming and outgoing s2s connections to other Jabber servers.
The default value is <TT>allow</TT>.
</DD><DT CLASS="dt-description"><B><TT>{{s2s_host, Host}, allow|deny}</TT></B></DT><DD CLASS="dd-description">
Defines if incoming and outgoing s2s connections with a specific remote host are allowed or denied.
This allows to restrict ejabberd to only establish s2s connections
with a small list of trusted servers, or to block some specific servers.
</DD><DT CLASS="dt-description"><B><TT>{s2s_max_retry_delay, Seconds}</TT></B></DT><DD CLASS="dd-description"> 
The maximum allowed delay for retry to connect after a failed connection attempt.
Specified in seconds. The default value is 300 seconds (5 minutes).
</DD></DL><P>For example, the following simple configuration defines:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
There are three domains. The default certificate file is <TT>server.pem</TT>.
However, the c2s and s2s connections to the domain <TT>example.com</TT> use the file <TT>example_com.pem</TT>.
</LI><LI CLASS="li-itemize">Port 5222 listens for c2s connections with STARTTLS,
and also allows plain connections for old clients.
</LI><LI CLASS="li-itemize">Port 5223 listens for c2s connections with the old SSL.
</LI><LI CLASS="li-itemize">Port 5269 listens for s2s connections with STARTTLS.
</LI><LI CLASS="li-itemize">Port 5280 listens for HTTP requests, and serves the HTTP Poll service.
</LI><LI CLASS="li-itemize">Port 5281 listens for HTTP requests, and serves the Web Admin using HTTPS as explained in
section&#XA0;<A HREF="#webadmin">4.2</A>.
</LI></UL><PRE CLASS="verbatim">{hosts, ["example.com", "example.org", "example.net"]}.
{listen,
 [
  {5222, ejabberd_c2s, [
                        {access, c2s},
                        {shaper, c2s_shaper},
                        starttls, {certfile, "/etc/ejabberd/server.pem"},
                        {max_stanza_size, 65536}
                       ]},
  {5223, ejabberd_c2s, [
                        {access, c2s},
                        {shaper, c2s_shaper},
                        tls, {certfile, "/etc/ejabberd/server.pem"},
                        {max_stanza_size, 65536}
                       ]},
  {5269, ejabberd_s2s_in, [
                           {shaper, s2s_shaper},
                           {max_stanza_size, 131072}
                          ]},
  {5280, ejabberd_http, [
                         http_poll
                        ]},
  {5281, ejabberd_http, [
                         web_admin,
                         tls, {certfile, "/etc/ejabberd/server.pem"},
                        ]}
 ]
}.
{s2s_use_starttls, true}.
{s2s_certfile, "/etc/ejabberd/server.pem"}.
{domain_certfile, "example.com", "/etc/ejabberd/example_com.pem"}.
</PRE><P>In this example, the following configuration defines that:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
c2s connections are listened for on port 5222 and 5223 (SSL) and denied
for the user called &#X2018;<TT>bad</TT>&#X2019;.
</LI><LI CLASS="li-itemize">s2s connections are listened for on port 5269 with STARTTLS for secured
traffic enabled.
Incoming and outgoing connections of remote Jabber servers are denied,
only two servers can connect: "jabber.example.org" and "example.com".
</LI><LI CLASS="li-itemize">Port 5280 is serving the Web Admin and the HTTP Polling service. Note
that it is also possible to serve them on different ports. The second
example in section&#XA0;<A HREF="#webadmin">4.2</A> shows how exactly this can be done.
</LI><LI CLASS="li-itemize">All users except for the administrators have a traffic of limit
1,000&#XA0;Bytes/second
</LI><LI CLASS="li-itemize">The
<A HREF="http://www.ejabberd.im/pyaimt">AIM transport</A>
<TT>aim.example.org</TT> is connected to port 5233 with password
&#X2018;<TT>aimsecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The ICQ transport JIT (<TT>icq.example.org</TT> and
<TT>sms.example.org</TT>) is connected to port 5234 with password
&#X2018;<TT>jitsecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The
<A HREF="http://www.ejabberd.im/pymsnt">MSN transport</A>
<TT>msn.example.org</TT> is connected to port 5235 with password
&#X2018;<TT>msnsecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The
<A HREF="http://www.ejabberd.im/yahoo-transport-2">Yahoo! transport</A>
<TT>yahoo.example.org</TT> is connected to port 5236 with password
&#X2018;<TT>yahoosecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The <A HREF="http://www.ejabberd.im/jabber-gg-transport">Gadu-Gadu transport</A> <TT>gg.example.org</TT> is
connected to port 5237 with password &#X2018;<TT>ggsecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The
<A HREF="http://www.ejabberd.im/jmc">Jabber Mail Component</A>
<TT>jmc.example.org</TT> is connected to port 5238 with password
&#X2018;<TT>jmcsecret</TT>&#X2019;.
</LI><LI CLASS="li-itemize">The service custom has enabled the special option to avoiding checking the <TT>from</TT> attribute in the packets send by this component. The component can send packets in behalf of any users from the server, or even on behalf of any server.
</LI></UL><PRE CLASS="verbatim">{acl, blocked, {user, "bad"}}.
{access, c2s, [{deny, blocked},
               {allow, all}]}.
{shaper, normal, {maxrate, 1000}}.
{access, c2s_shaper, [{none, admin},
                      {normal, all}]}.
{listen,
 [{5222, ejabberd_c2s,     [{access, c2s}, {shaper, c2s_shaper}]},
  {5223, ejabberd_c2s,     [{access, c2s},
                            ssl, {certfile, "/path/to/ssl.pem"}]},
  {5269, ejabberd_s2s_in,  []},
  {5280, ejabberd_http,    [http_poll, web_admin]},
  {5233, ejabberd_service, [{hosts, ["aim.example.org"],
                             [{password, "aimsecret"}]}]},
  {5234, ejabberd_service, [{hosts, ["icq.example.org", "sms.example.org"],
                             [{password, "jitsecret"}]}]},
  {5235, ejabberd_service, [{hosts, ["msn.example.org"],
                             [{password, "msnsecret"}]}]},
  {5236, ejabberd_service, [{hosts, ["yahoo.example.org"],
                             [{password, "yahoosecret"}]}]},
  {5237, ejabberd_service, [{hosts, ["gg.example.org"],
                             [{password, "ggsecret"}]}]},
  {5238, ejabberd_service, [{hosts, ["jmc.example.org"],
                             [{password, "jmcsecret"}]}]},
  {5239, ejabberd_service, [{hosts, ["custom.example.org"],
                             [{password, "customsecret"}]},
                            {service_check_from, false}]}
 ]
}.
{s2s_use_starttls, true}.
{s2s_certfile, "/path/to/ssl.pem"}.
{s2s_default_policy, deny}.
{{s2s_host,"jabber.example.org"}, allow}.
{{s2s_host,"example.com"}, allow}.
</PRE><P>Note, that for jabberd 1.4- or WPJabber-based
services you have to make the transports log and do XDB by themselves:
</P><PRE CLASS="verbatim">  &lt;!--
     You have to add elogger and rlogger entries here when using ejabberd.
     In this case the transport will do the logging.
  --&gt;

  &lt;log id='logger'&gt;
    &lt;host/&gt;
    &lt;logtype/&gt;
    &lt;format&gt;%d: [%t] (%h): %s&lt;/format&gt;
    &lt;file&gt;/var/log/jabber/service.log&lt;/file&gt;
  &lt;/log&gt;

  &lt;!--
     Some Jabber server implementations do not provide
     XDB services (for example, jabberd2 and ejabberd).
     xdb_file.so is loaded in to handle all XDB requests.
  --&gt;

  &lt;xdb id="xdb"&gt;
    &lt;host/&gt;
    &lt;load&gt;
      &lt;!-- this is a lib of wpjabber or jabberd --&gt;
      &lt;xdb_file&gt;/usr/lib/jabber/xdb_file.so&lt;/xdb_file&gt;
      &lt;/load&gt;
    &lt;xdb_file xmlns="jabber:config:xdb_file"&gt;
      &lt;spool&gt;&lt;jabberd:cmdline flag='s'&gt;/var/spool/jabber&lt;/jabberd:cmdline&gt;&lt;/spool&gt;
    &lt;/xdb_file&gt;
  &lt;/xdb&gt;
</PRE><P> <A NAME="auth"></A> </P><!--TOC subsection Authentication-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc24">3.1.4</A>&#XA0;&#XA0;<A HREF="#auth">Authentication</A></H3><!--SEC END --><P> <A NAME="auth"></A> 
</P><P>The option <TT>auth_method</TT> defines the authentication method that is used
for user authentication:
</P><PRE CLASS="verbatim">{auth_method, [&lt;method&gt;]}.
</PRE><P>The following authentication methods are supported by <TT>ejabberd</TT>:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
internal (default) &#X2014; See section&#XA0;<A HREF="#internalauth">3.1.4</A>.
</LI><LI CLASS="li-itemize">external &#X2014; There are <A HREF="http://www.ejabberd.im/extauth">some
example authentication scripts</A>.
</LI><LI CLASS="li-itemize">ldap &#X2014; See section&#XA0;<A HREF="#ldap">3.2.5</A>.
</LI><LI CLASS="li-itemize">odbc &#X2014; See section&#XA0;<A HREF="#mysql">3.2.1</A>, <A HREF="#pgsql">3.2.3</A>,
<A HREF="#mssql">3.2.2</A> and <A HREF="#odbc">3.2.4</A>.
</LI><LI CLASS="li-itemize">anonymous &#X2014; See section&#XA0;<A HREF="#saslanonymous">3.1.4</A>.
</LI><LI CLASS="li-itemize">pam &#X2014; See section&#XA0;<A HREF="#pam">3.1.4</A>.
</LI></UL><P> <A NAME="internalauth"></A> </P><!--TOC subsubsection Internal-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#internalauth">Internal</A></H4><!--SEC END --><P> <A NAME="internalauth"></A> 
</P><P><TT>ejabberd</TT> uses its internal Mnesia database as the default authentication method.</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>auth_method</TT>: The value <TT>internal</TT> will enable the internal
authentication method.
</LI></UL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To use internal authentication on <TT>example.org</TT> and LDAP
authentication on <TT>example.net</TT>:
<PRE CLASS="verbatim">{host_config, "example.org", [{auth_method, [internal]}]}.
{host_config, "example.net", [{auth_method, [ldap]}]}.
</PRE></LI><LI CLASS="li-itemize">To use internal authentication on all virtual hosts:
<PRE CLASS="verbatim">{auth_method, internal}.
</PRE></LI></UL><P> <A NAME="saslanonymous"></A> </P><!--TOC subsubsection SASL Anonymous and Anonymous Login-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#saslanonymous">SASL Anonymous and Anonymous Login</A></H4><!--SEC END --><P> <A NAME="saslanonymous"></A> 
</P><P>The anonymous authentication method can be configured with the following
options. Remember that you can use the <TT>host_config</TT> option to set virtual
host specific options (see section&#XA0;<A HREF="#virtualhost">3.1.2</A>). Note that there also
is a detailed tutorial regarding <A HREF="http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support">SASL
Anonymous and anonymous login configuration</A>.</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>auth_method</TT>: The value <TT>anonymous</TT> will enable the anonymous
authentication method.
</LI><LI CLASS="li-itemize"><TT>allow_multiple_connections</TT>: This value for this option can be
either <TT>true</TT> or <TT>false</TT> and is only used when the anonymous mode is
enabled. Setting it to <TT>true</TT> means that the same username can be taken
multiple times in anonymous login mode if different resource are used to
connect. This option is only useful in very special occasions. The default
value is <TT>false</TT>.
</LI><LI CLASS="li-itemize"><TT>anonymous_protocol</TT>: This option can take three values:
<TT>sasl_anon</TT>, <TT>login_anon</TT> or <TT>both</TT>. <TT>sasl_anon</TT> means
that the SASL Anonymous method will be used. <TT>login_anon</TT> means that the
anonymous login method will be used. <TT>both</TT> means that SASL Anonymous and
login anonymous are both enabled.
</LI></UL><P>Those options are defined for each virtual host with the <TT>host_config</TT>
parameter (see section&#XA0;<A HREF="#virtualhost">3.1.2</A>).</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To enable anonymous login on all virtual hosts:
<PRE CLASS="verbatim">{auth_method, [anonymous]}.
{anonymous_protocol, login_anon}.
</PRE></LI><LI CLASS="li-itemize">Similar as previous example, but limited to <TT>public.example.org</TT>:
<PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [anonymous]},
                                     {anonymous_protocol, login_anon}]}.
</PRE></LI><LI CLASS="li-itemize">To enable anonymous login and internal authentication on a virtual host:
<PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [internal,anonymous]},
                                     {anonymous_protocol, login_anon}]}.
</PRE></LI><LI CLASS="li-itemize">To enable SASL Anonymous on a virtual host:
<PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [anonymous]},
                                     {anonymous_protocol, sasl_anon}]}.
</PRE></LI><LI CLASS="li-itemize">To enable SASL Anonymous and anonymous login on a virtual host:
<PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [anonymous]},
                                     {anonymous_protocol, both}]}.
</PRE></LI><LI CLASS="li-itemize">To enable SASL Anonymous, anonymous login, and internal authentication on
a virtual host:
<PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [internal,anonymous]},
                                     {anonymous_protocol, both}]}.
</PRE></LI></UL><P> <A NAME="pam"></A> </P><!--TOC subsubsection PAM Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#pam">PAM Authentication</A></H4><!--SEC END --><P> <A NAME="pam"></A> 
</P><P><TT>ejabberd</TT> supports authentication via Pluggable Authentication Modules (PAM).
PAM is currently supported in AIX, FreeBSD, HP-UX, Linux, Mac OS X, NetBSD and Solaris.
PAM authentication is disabled by default, so you have to configure and compile
<TT>ejabberd</TT> with PAM support enabled:
</P><PRE CLASS="verbatim">./configure --enable-pam &amp;&amp; make install
</PRE><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>pam_service</TT></B></DT><DD CLASS="dd-description">This option defines the PAM service name.
Default is <TT>"ejabberd"</TT>. Refer to the PAM documentation of your operation system
for more information.
</DD></DL><P>Example:
</P><PRE CLASS="verbatim">{auth_method, [pam]}.
{pam_service, "ejabberd"}.
</PRE><P>Though it is quite easy to set up PAM support in <TT>ejabberd</TT>, PAM itself introduces some
security issues:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To perform PAM authentication <TT>ejabberd</TT> uses external C-program called
<TT>epam</TT>. By default, it is located in <CODE>/var/lib/ejabberd/priv/bin/</CODE>
directory. You have to set it root on execution in the case when your PAM module
requires root privileges (<TT>pam_unix.so</TT> for example). Also you have to grant access
for <TT>ejabberd</TT> to this file and remove all other permissions from it.
Execute with root privileges:
<PRE CLASS="verbatim">chown root:ejabberd /var/lib/ejabberd/priv/bin/epam
chmod 4750 /var/lib/ejabberd/priv/bin/epam
</PRE></LI><LI CLASS="li-itemize">Make sure you have the latest version of PAM installed on your system.
Some old versions of PAM modules cause memory leaks. If you are not able to use the latest
version, you can <TT>kill(1)</TT> <TT>epam</TT> process periodically to reduce its memory
consumption: <TT>ejabberd</TT> will restart this process immediately.
</LI><LI CLASS="li-itemize"><TT>epam</TT> program tries to turn off delays on authentication failures.
However, some PAM modules ignore this behavior and rely on their own configuration options.
You can create a configuration file <TT>ejabberd.pam</TT>.
This example shows how to turn off delays in <TT>pam_unix.so</TT> module:
<PRE CLASS="verbatim">#%PAM-1.0
auth        sufficient  pam_unix.so likeauth nullok nodelay
account     sufficient  pam_unix.so
</PRE>That is not a ready to use configuration file: you must use it
as a hint when building your own PAM configuration instead. Note that if you want to disable
delays on authentication failures in the PAM configuration file, you have to restrict access
to this file, so a malicious user can&#X2019;t use your configuration to perform brute-force
attacks.
</LI><LI CLASS="li-itemize">You may want to allow login access only for certain users. <TT>pam_listfile.so</TT>
module provides such functionality.
</LI></UL><P> <A NAME="accessrules"></A> </P><!--TOC subsection Access Rules-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc25">3.1.5</A>&#XA0;&#XA0;<A HREF="#accessrules">Access Rules</A></H3><!--SEC END --><P> <A NAME="accessrules"></A> 
</P><P> <A NAME="ACLDefinition"></A> </P><!--TOC subsubsection ACL Definition-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#ACLDefinition">ACL Definition</A></H4><!--SEC END --><P> <A NAME="ACLDefinition"></A> 
</P><P>Access control in <TT>ejabberd</TT> is performed via Access Control Lists (ACLs). The
declarations of ACLs in the configuration file have the following syntax:
</P><PRE CLASS="verbatim">{acl, &lt;aclname&gt;, {&lt;acltype&gt;, ...}}.
</PRE><P><TT>&lt;acltype&gt;</TT> can be one of the following:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>all</TT></B></DT><DD CLASS="dd-description"> Matches all JIDs. Example:
<PRE CLASS="verbatim">{acl, all, all}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{user, &lt;username&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches the user with the name
<TT>&lt;username&gt;</TT> at the first virtual host. Example:
<PRE CLASS="verbatim">{acl, admin, {user, "yozhik"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{user, &lt;username&gt;, &lt;server&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches the user with the JID
<TT>&lt;username&gt;@&lt;server&gt;</TT> and any resource. Example:
<PRE CLASS="verbatim">{acl, admin, {user, "yozhik", "example.org"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{server, &lt;server&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches any JID from server
<TT>&lt;server&gt;</TT>. Example:
<PRE CLASS="verbatim">{acl, exampleorg, {server, "example.org"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{user_regexp, &lt;regexp&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches any local user with a name that
matches <TT>&lt;regexp&gt;</TT> on local virtual hosts. Example:
<PRE CLASS="verbatim">{acl, tests, {user_regexp, "^test[0-9]*$"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{user_regexp, &lt;regexp&gt;, &lt;server&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches any user with a name
that matches <TT>&lt;regexp&gt;</TT> at server <TT>&lt;server&gt;</TT>. Example:
<PRE CLASS="verbatim">{acl, tests, {user_regexp, "^test", "example.org"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{server_regexp, &lt;regexp&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches any JID from the server that
matches <TT>&lt;regexp&gt;</TT>. Example:
<PRE CLASS="verbatim">{acl, icq, {server_regexp, "^icq\\."}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{node_regexp, &lt;user_regexp&gt;, &lt;server_regexp&gt;}</TT></B></DT><DD CLASS="dd-description"> Matches any user
with a name that matches <TT>&lt;user_regexp&gt;</TT> at any server that matches
<TT>&lt;server_regexp&gt;</TT>. Example:
<PRE CLASS="verbatim">{acl, yohzik, {node_regexp, "^yohzik$", "^example.(com|org)$"}}.
</PRE></DD><DT CLASS="dt-description"><B><TT>{user_glob, &lt;glob&gt;}</TT></B></DT><DD CLASS="dd-description">
</DD><DT CLASS="dt-description"><B><TT>{user_glob, &lt;glob&gt;, &lt;server&gt;}</TT></B></DT><DD CLASS="dd-description">
</DD><DT CLASS="dt-description"><B><TT>{server_glob, &lt;glob&gt;}</TT></B></DT><DD CLASS="dd-description">
</DD><DT CLASS="dt-description"><B><TT>{node_glob, &lt;user_glob&gt;, &lt;server_glob&gt;}</TT></B></DT><DD CLASS="dd-description"> This is the same as
above. However, it uses shell glob patterns instead of regexp. These patterns
can have the following special characters:
<DL CLASS="description"><DT CLASS="dt-description">
<B><TT>*</TT></B></DT><DD CLASS="dd-description"> matches any string including the null string.
</DD><DT CLASS="dt-description"><B><TT>?</TT></B></DT><DD CLASS="dd-description"> matches any single character.
</DD><DT CLASS="dt-description"><B><TT>[...]</TT></B></DT><DD CLASS="dd-description"> matches any of the enclosed characters. Character
ranges are specified by a pair of characters separated by a <TT>&#X2018;-&#X2019;</TT>.
If the first character after <TT>&#X2018;[&#X2019;</TT> is a <TT>&#X2018;!&#X2019;</TT>, any
character not enclosed is matched.
</DD></DL>
</DD></DL><P>The following ACLs are pre-defined:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>all</TT></B></DT><DD CLASS="dd-description"> Matches any JID.
</DD><DT CLASS="dt-description"><B><TT>none</TT></B></DT><DD CLASS="dd-description"> Matches no JID.
</DD></DL><P> <A NAME="AccessRights"></A> </P><!--TOC subsubsection Access Rights-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#AccessRights">Access Rights</A></H4><!--SEC END --><P> <A NAME="AccessRights"></A> 
</P><P>An entry allowing or denying access to different services looks similar to
this:
</P><PRE CLASS="verbatim">{access, &lt;accessname&gt;, [{allow, &lt;aclname&gt;},
                        {deny, &lt;aclname&gt;},
                        ...
                       ]}.
</PRE><P>When a JID is checked to have access to <TT>&lt;accessname&gt;</TT>, the server
sequentially checks if that JID matches any of the ACLs that are named in the
second elements of the tuples in the list. If it matches, the first element of
the first matched tuple is returned, otherwise the value &#X2018;<TT>deny</TT>&#X2019; is
returned.</P><P>Example:
</P><PRE CLASS="verbatim">{access, configure, [{allow, admin}]}.
{access, something, [{deny, badmans},
                     {allow, all}]}.
</PRE><P>The following access rules are pre-defined:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>all</TT></B></DT><DD CLASS="dd-description"> Always returns the value &#X2018;<TT>allow</TT>&#X2019;.
</DD><DT CLASS="dt-description"><B><TT>none</TT></B></DT><DD CLASS="dd-description"> Always returns the value &#X2018;<TT>deny</TT>&#X2019;.
</DD></DL><P> <A NAME="configmaxsessions"></A> </P><!--TOC subsubsection Limiting Opened Sessions with ACL-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#configmaxsessions">Limiting Opened Sessions with ACL</A></H4><!--SEC END --><P> <A NAME="configmaxsessions"></A> 
</P><P>The special access <TT>max_user_sessions</TT> specifies the maximum
number of sessions (authenticated connections) per user. If a user
tries to open more sessions by using different resources, the first
opened session will be disconnected. The error <TT>session replaced</TT>
will be sent to the disconnected session. The value for this option
can be either a number, or <TT>infinity</TT>. The default value is
<TT>infinity</TT>.</P><P>The syntax is:
</P><PRE CLASS="verbatim">{access, max_user_sessions, [{&lt;maxnumber&gt;, &lt;aclname&gt;},
                             ...
                            ]}.
</PRE><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To limit the number of sessions per user to 10 for all users:
<PRE CLASS="verbatim">{access, max_user_sessions, [{10, all}]}.
</PRE></LI></UL><P> <A NAME="configmaxs2sconns"></A> </P><!--TOC subsubsection Several connections to a remote Jabber server with ACL-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#configmaxs2sconns">Several connections to a remote Jabber server with ACL</A></H4><!--SEC END --><P> <A NAME="configmaxs2sconns"></A> 
</P><P>The special access <TT>max_s2s_connections</TT> specifies how many
simultaneus S2S connections can be established to a specific remote Jabber server.
The default value is <TT>1</TT>.
There&#X2019;s also available the access <TT>max_s2s_connections_per_node</TT>.</P><P>The syntax is:
</P><PRE CLASS="verbatim">{access, max_s2s_connections, [{&lt;maxnumber&gt;, &lt;aclname&gt;},
                               ...
                              ]}.
</PRE><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Allow up to 3 connections with each remote server:
<PRE CLASS="verbatim">{access, max_s2s_connections, [{3, all}]}.
</PRE></LI></UL><P> <A NAME="shapers"></A> </P><!--TOC subsection Shapers-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc26">3.1.6</A>&#XA0;&#XA0;<A HREF="#shapers">Shapers</A></H3><!--SEC END --><P> <A NAME="shapers"></A> 
</P><P>Shapers enable you to limit connection traffic. The syntax of
shapers is like this:
</P><PRE CLASS="verbatim">{shaper, &lt;shapername&gt;, &lt;kind&gt;}.
</PRE><P>Currently only one kind of shaper called <TT>maxrate</TT> is available. It has the
following syntax:
</P><PRE CLASS="verbatim">{maxrate, &lt;rate&gt;}
</PRE><P>where <TT>&lt;rate&gt;</TT> stands for the maximum allowed incoming rate in bytes per
second.
When a connection exceeds this limit, <TT>ejabberd</TT> stops reading from the socket
until the average rate is again below the allowed maximum.</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To define a shaper named &#X2018;<TT>normal</TT>&#X2019; with traffic speed limited to
1,000&#XA0;bytes/second:
<PRE CLASS="verbatim">{shaper, normal, {maxrate, 1000}}.
</PRE></LI><LI CLASS="li-itemize">To define a shaper named &#X2018;<TT>fast</TT>&#X2019; with traffic speed limited to
50,000&#XA0;bytes/second:
<PRE CLASS="verbatim">{shaper, fast, {maxrate, 50000}}.
</PRE></LI></UL><P> <A NAME="language"></A> </P><!--TOC subsection Default Language-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc27">3.1.7</A>&#XA0;&#XA0;<A HREF="#language">Default Language</A></H3><!--SEC END --><P> <A NAME="language"></A> 
</P><P>The option <TT>language</TT> defines the default language of server strings that
can be seen by Jabber clients. If a Jabber client do not support
<TT>xml:lang</TT>, the specified language is used. The default value is
<TT>en</TT>. In order to take effect there must be a translation file
<TT>&lt;language&gt;.msg</TT> in <TT>ejabberd</TT>&#X2019;s <TT>msgs</TT> directory.</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To set Russian as default language:
<PRE CLASS="verbatim">{language, "ru"}.
</PRE></LI><LI CLASS="li-itemize">To set Spanish as default language:
<PRE CLASS="verbatim">{language, "es"}.
</PRE></LI></UL><P> <A NAME="database"></A> </P><!--TOC section Database and LDAP Configuration-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc28">3.2</A>&#XA0;&#XA0;<A HREF="#database">Database and LDAP Configuration</A></H2><!--SEC END --><P> <A NAME="database"></A> 

</P><P><TT>ejabberd</TT> uses its internal Mnesia database by default. However, it is
possible to use a relational database or an LDAP server to store persistent,
long-living data. <TT>ejabberd</TT> is very flexible: you can configure different
authentication methods for different virtual hosts, you can configure different
authentication mechanisms for the same virtual host (fallback), you can set
different storage systems for modules, and so forth.</P><P>The following databases are supported by <TT>ejabberd</TT>:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<A HREF="http://www.microsoft.com/sql/">Microsoft SQL Server</A>
</LI><LI CLASS="li-itemize"><A HREF="http://www.erlang.org/doc/apps/mnesia/index.html">Mnesia</A>
</LI><LI CLASS="li-itemize"><A HREF="http://www.mysql.com/">MySQL</A>
</LI><LI CLASS="li-itemize"><A HREF="http://en.wikipedia.org/wiki/Open_Database_Connectivity">Any ODBC compatible database</A>
</LI><LI CLASS="li-itemize"><A HREF="http://www.postgresql.org/">PostgreSQL</A>
</LI></UL><P>The following LDAP servers are tested with <TT>ejabberd</TT>:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<A HREF="http://www.microsoft.com/activedirectory/">Active Directory</A>
(see section&#XA0;<A HREF="#ad">3.2.5</A>)
</LI><LI CLASS="li-itemize"><A HREF="http://www.openldap.org/">OpenLDAP</A>
</LI><LI CLASS="li-itemize">Normally any LDAP compatible server should work; inform us about your
success with a not-listed server so that we can list it here.
</LI></UL><P> <A NAME="mysql"></A> </P><!--TOC subsection MySQL-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc29">3.2.1</A>&#XA0;&#XA0;<A HREF="#mysql">MySQL</A></H3><!--SEC END --><P> <A NAME="mysql"></A> 
</P><P>Although this section will describe <TT>ejabberd</TT>&#X2019;s configuration when you want to
use the native MySQL driver, it does not describe MySQL&#X2019;s installation and
database creation. Check the MySQL documentation and the tutorial <A HREF="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">Using ejabberd with MySQL native driver</A> for information regarding these topics.
Note that the tutorial contains information about <TT>ejabberd</TT>&#X2019;s configuration
which is duplicate to this section.</P><P>Moreover, the file mysql.sql in the directory src/odbc might be interesting for
you. This file contains the <TT>ejabberd</TT> schema for MySQL. At the end of the file
you can find information to update your database schema.</P><P>By default <TT>ejabberd</TT> opens 10 connections to the database for each virtual host.
Use this option to modify the value:
</P><PRE CLASS="verbatim">{odbc_pool_size, 10}.
</PRE><P>You can configure an interval to make a dummy SQL request
to keep alive the connections to the database.
The default value is &#X2019;undefined&#X2019;, so no keepalive requests are made.
Specify in seconds: for example 28800 means 8 hours.
</P><PRE CLASS="verbatim">{odbc_keepalive_interval, undefined}.
</PRE><P>If the connection to the database fails, <TT>ejabberd</TT> waits 30 seconds before retrying.
You can modify this interval with this option:
</P><PRE CLASS="verbatim">{odbc_start_interval, 30}.
</PRE><P> <A NAME="compilemysql"></A> </P><!--TOC subsubsection Driver Compilation-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#compilemysql">Driver Compilation</A></H4><!--SEC END --><P> <A NAME="compilemysql"></A> 
</P><P>You can skip this step if you installed <TT>ejabberd</TT> using a binary installer or
if the binary packages of <TT>ejabberd</TT> you are using include support for MySQL.</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
First, install the <A HREF="http://support.process-one.net/doc/display/CONTRIBS/Yxa">Erlang
MySQL library</A>. Make sure the compiled files are in your Erlang path; you can
put them for example in the same directory as your <TT>ejabberd</TT> .beam files.
</LI><LI CLASS="li-enumerate">Then, configure and install <TT>ejabberd</TT> with ODBC support enabled (this is
also needed for native MySQL support!). This can be done, by using next
commands:
<PRE CLASS="verbatim">./configure --enable-odbc &amp;&amp; make install
</PRE></LI></OL><P> <A NAME="mysqlauth"></A> </P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#mysqlauth">Authentication</A></H4><!--SEC END --><P> <A NAME="mysqlauth"></A> 
</P><P>The option value name may be misleading, as the <TT>auth_method</TT> name is used
for access to a relational database through ODBC, as well as through the native
MySQL interface. Anyway, the first configuration step is to define the odbc
<TT>auth_method</TT>. For example:
</P><PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [odbc]}]}.
</PRE><P>The actual database access is defined in the option <TT>odbc_server</TT>. Its
value is used to define if we want to use ODBC, or one of the two native
interface available, PostgreSQL or MySQL.</P><P>To use the native MySQL interface, you can pass a tuple of the following form as
parameter:
</P><PRE CLASS="verbatim">{mysql, "Server", "Database", "Username", "Password"}
</PRE><P><TT>mysql</TT> is a keyword that should be kept as is. For example:
</P><PRE CLASS="verbatim">{odbc_server, {mysql, "localhost", "test", "root", "password"}}.
</PRE><P>Optionally, it is possible to define the MySQL port to use. This
option is only useful, in very rare cases, when you are not running
MySQL with the default port setting. The <TT>mysql</TT> parameter
can thus take the following form:
</P><PRE CLASS="verbatim">{mysql, "Server", Port, "Database", "Username", "Password"}
</PRE><P>The <TT>Port</TT> value should be an integer, without quotes. For example:
</P><PRE CLASS="verbatim">{odbc_server, {mysql, "localhost", Port, "test", "root", "password"}}.
</PRE><P> <A NAME="mysqlstorage"></A> </P><!--TOC subsubsection Storage-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#mysqlstorage">Storage</A></H4><!--SEC END --><P> <A NAME="mysqlstorage"></A> 
</P><P>MySQL also can be used to store information into from several <TT>ejabberd</TT>
modules. See section&#XA0;<A HREF="#modoverview">3.3.1</A> to see which modules have a version
with the &#X2018;_odbc&#X2019;. This suffix indicates that the module can be used with
relational databases like MySQL. To enable storage to your database, just make
sure that your database is running well (see previous sections), and replace the
suffix-less or ldap module variant with the odbc module variant. Keep in mind
that you cannot have several variants of the same module loaded!</P><P> <A NAME="mssql"></A> </P><!--TOC subsection Microsoft SQL Server-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc30">3.2.2</A>&#XA0;&#XA0;<A HREF="#mssql">Microsoft SQL Server</A></H3><!--SEC END --><P> <A NAME="mssql"></A> 
</P><P>Although this section will describe <TT>ejabberd</TT>&#X2019;s configuration when you want to
use Microsoft SQL Server, it does not describe Microsoft SQL Server&#X2019;s
installation and database creation. Check the MySQL documentation and the
tutorial <A HREF="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">Using ejabberd with MySQL native driver</A> for information regarding these topics.
Note that the tutorial contains information about <TT>ejabberd</TT>&#X2019;s configuration
which is duplicate to this section.</P><P>Moreover, the file mssql.sql in the directory src/odbc might be interesting for
you. This file contains the <TT>ejabberd</TT> schema for Microsoft SQL Server. At the end
of the file you can find information to update your database schema.</P><P>By default <TT>ejabberd</TT> opens 10 connections to the database for each virtual host.
Use this option to modify the value:
</P><PRE CLASS="verbatim">{odbc_pool_size, 10}.
</PRE><P>You can configure an interval to make a dummy SQL request
to keep alive the connections to the database.
The default value is &#X2019;undefined&#X2019;, so no keepalive requests are made.
Specify in seconds: for example 28800 means 8 hours.
</P><PRE CLASS="verbatim">{odbc_keepalive_interval, undefined}.
</PRE><P> <A NAME="compilemssql"></A> </P><!--TOC subsubsection Driver Compilation-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#compilemssql">Driver Compilation</A></H4><!--SEC END --><P> <A NAME="compilemssql"></A> 
</P><P>You can skip this step if you installed <TT>ejabberd</TT> using a binary installer or
if the binary packages of <TT>ejabberd</TT> you are using include support for ODBC.</P><P>If you want to use Microsoft SQL Server with ODBC, you need to configure,
compile and install <TT>ejabberd</TT> with support for ODBC and Microsoft SQL Server
enabled. This can be done, by using next commands:
</P><PRE CLASS="verbatim">./configure --enable-odbc --enable-mssql &amp;&amp; make install
</PRE><P> <A NAME="mssqlauth"></A> </P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#mssqlauth">Authentication</A></H4><!--SEC END --><P> <A NAME="mssqlauth"></A> 
</P><P>The configuration of Microsoft SQL Server is the same as the configuration of
ODBC compatible servers (see section&#XA0;<A HREF="#odbcauth">3.2.4</A>).</P><P> <A NAME="mssqlstorage"></A> </P><!--TOC subsubsection Storage-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#mssqlstorage">Storage</A></H4><!--SEC END --><P> <A NAME="mssqlstorage"></A> 
</P><P>Microsoft SQL Server also can be used to store information into from several
<TT>ejabberd</TT> modules. See section&#XA0;<A HREF="#modoverview">3.3.1</A> to see which modules have
a version with the &#X2018;_odbc&#X2019;. This suffix indicates that the module can be used
with relational databases like Microsoft SQL Server. To enable storage to your
database, just make sure that your database is running well (see previous
sections), and replace the suffix-less or ldap module variant with the odbc
module variant. Keep in mind that you cannot have several variants of the same
module loaded!</P><P> <A NAME="pgsql"></A> </P><!--TOC subsection PostgreSQL-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc31">3.2.3</A>&#XA0;&#XA0;<A HREF="#pgsql">PostgreSQL</A></H3><!--SEC END --><P> <A NAME="pgsql"></A> 
</P><P>Although this section will describe <TT>ejabberd</TT>&#X2019;s configuration when you want to
use the native PostgreSQL driver, it does not describe PostgreSQL&#X2019;s installation
and database creation. Check the PostgreSQL documentation and the tutorial <A HREF="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">Using ejabberd with MySQL native driver</A> for information regarding these topics.
Note that the tutorial contains information about <TT>ejabberd</TT>&#X2019;s configuration
which is duplicate to this section.</P><P>Also the file pg.sql in the directory src/odbc might be interesting for you.
This file contains the <TT>ejabberd</TT> schema for PostgreSQL. At the end of the file
you can find information to update your database schema.</P><P>By default <TT>ejabberd</TT> opens 10 connections to the database for each virtual host.
Use this option to modify the value:
</P><PRE CLASS="verbatim">{odbc_pool_size, 10}.
</PRE><P>You can configure an interval to make a dummy SQL request
to keep alive the connections to the database.
The default value is &#X2019;undefined&#X2019;, so no keepalive requests are made.
Specify in seconds: for example 28800 means 8 hours.
</P><PRE CLASS="verbatim">{odbc_keepalive_interval, undefined}.
</PRE><P> <A NAME="compilepgsql"></A> </P><!--TOC subsubsection Driver Compilation-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#compilepgsql">Driver Compilation</A></H4><!--SEC END --><P> <A NAME="compilepgsql"></A> 
</P><P>You can skip this step if you installed <TT>ejabberd</TT> using a binary installer or
if the binary packages of <TT>ejabberd</TT> you are using include support for
PostgreSQL.</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
First, install the Erlang pgsql library from
<A HREF="http://www.ejabberd.im/ejabberd-modules/">ejabberd-modules SVN repository</A>.
Make sure the compiled
files are in your Erlang path; you can put them for example in the same
directory as your <TT>ejabberd</TT> .beam files.
</LI><LI CLASS="li-enumerate">Then, configure, compile and install <TT>ejabberd</TT> with ODBC support enabled
(this is also needed for native PostgreSQL support!). This can be done, by
using next commands:
<PRE CLASS="verbatim">./configure --enable-odbc &amp;&amp; make install
</PRE></LI></OL><P> <A NAME="pgsqlauth"></A> </P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#pgsqlauth">Authentication</A></H4><!--SEC END --><P> <A NAME="pgsqlauth"></A> 
</P><P>The option value name may be misleading, as the <TT>auth_method</TT> name is used
for access to a relational database through ODBC, as well as through the native
PostgreSQL interface. Anyway, the first configuration step is to define the odbc
<TT>auth_method</TT>. For example:
</P><PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [odbc]}]}.
</PRE><P>The actual database access is defined in the option <TT>odbc_server</TT>. Its
value is used to define if we want to use ODBC, or one of the two native
interface available, PostgreSQL or MySQL.</P><P>To use the native PostgreSQL interface, you can pass a tuple of the following
form as parameter:
</P><PRE CLASS="verbatim">{pgsql, "Server", "Database", "Username", "Password"}
</PRE><P><TT>pgsql</TT> is a keyword that should be kept as is. For example:
</P><PRE CLASS="verbatim">{odbc_server, {pgsql, "localhost", "database", "ejabberd", "password"}}.
</PRE><P>Optionally, it is possible to define the PostgreSQL port to use. This
option is only useful, in very rare cases, when you are not running
PostgreSQL with the default port setting. The <TT>pgsql</TT> parameter
can thus take the following form:
</P><PRE CLASS="verbatim">{pgsql, "Server", Port, "Database", "Username", "Password"}
</PRE><P>The <TT>Port</TT> value should be an integer, without quotes. For example:
</P><PRE CLASS="verbatim">{odbc_server, {pgsql, "localhost", 5432, "database", "ejabberd", "password"}}.
</PRE><P> <A NAME="pgsqlstorage"></A> </P><!--TOC subsubsection Storage-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#pgsqlstorage">Storage</A></H4><!--SEC END --><P> <A NAME="pgsqlstorage"></A> 
</P><P>PostgreSQL also can be used to store information into from several <TT>ejabberd</TT>
modules. See section&#XA0;<A HREF="#modoverview">3.3.1</A> to see which modules have a version
with the &#X2018;_odbc&#X2019;. This suffix indicates that the module can be used with
relational databases like PostgreSQL. To enable storage to your database, just
make sure that your database is running well (see previous sections), and
replace the suffix-less or ldap module variant with the odbc module variant.
Keep in mind that you cannot have several variants of the same module loaded!</P><P> <A NAME="odbc"></A> </P><!--TOC subsection ODBC Compatible-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc32">3.2.4</A>&#XA0;&#XA0;<A HREF="#odbc">ODBC Compatible</A></H3><!--SEC END --><P> <A NAME="odbc"></A> 
</P><P>Although this section will describe <TT>ejabberd</TT>&#X2019;s configuration when you want to
use the ODBC driver, it does not describe the installation and database creation
of your database. Check the documentation of your database. The tutorial <A HREF="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">Using ejabberd with MySQL native driver</A> also can help you. Note that the tutorial
contains information about <TT>ejabberd</TT>&#X2019;s configuration which is duplicate to
this section.</P><P>By default <TT>ejabberd</TT> opens 10 connections to the database for each virtual host.
Use this option to modify the value:
</P><PRE CLASS="verbatim">{odbc_pool_size, 10}.
</PRE><P>You can configure an interval to make a dummy SQL request
to keep alive the connections to the database.
The default value is &#X2019;undefined&#X2019;, so no keepalive requests are made.
Specify in seconds: for example 28800 means 8 hours.
</P><PRE CLASS="verbatim">{odbc_keepalive_interval, undefined}.
</PRE><P> <A NAME="compileodbc"></A> </P><!--TOC subsubsection Driver Compilation-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#compileodbc">Driver Compilation</A></H4><!--SEC END --><P> <A NAME="compileodbc"></A> </P><P>You can skip this step if you installed <TT>ejabberd</TT> using a binary installer or
if the binary packages of <TT>ejabberd</TT> you are using include support for
ODBC.</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
First, install the <A HREF="http://support.process-one.net/doc/display/CONTRIBS/Yxa">Erlang
MySQL library</A>. Make sure the compiled files are in your Erlang path; you can
put them for example in the same directory as your <TT>ejabberd</TT> .beam files.
</LI><LI CLASS="li-enumerate">Then, configure, compile and install <TT>ejabberd</TT> with ODBC support
enabled. This can be done, by using next commands:
<PRE CLASS="verbatim">./configure --enable-odbc &amp;&amp; make install
</PRE></LI></OL><P> <A NAME="odbcauth"></A> </P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#odbcauth">Authentication</A></H4><!--SEC END --><P> <A NAME="odbcauth"></A> 
</P><P>The first configuration step is to define the odbc <TT>auth_method</TT>. For
example:
</P><PRE CLASS="verbatim">{host_config, "public.example.org", [{auth_method, [odbc]}]}.
</PRE><P>The actual database access is defined in the option <TT>odbc_server</TT>. Its
value is used to defined if we want to use ODBC, or one of the two native
interface available, PostgreSQL or MySQL.</P><P>To use a relational database through ODBC, you can pass the ODBC connection
string as <TT>odbc_server</TT> parameter. For example:
</P><PRE CLASS="verbatim">{odbc_server, "DSN=database;UID=ejabberd;PWD=password"}.
</PRE><P> <A NAME="odbcstorage"></A> </P><!--TOC subsubsection Storage-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#odbcstorage">Storage</A></H4><!--SEC END --><P> <A NAME="odbcstorage"></A> 
</P><P>An ODBC compatible database also can be used to store information into from
several <TT>ejabberd</TT> modules. See section&#XA0;<A HREF="#modoverview">3.3.1</A> to see which
modules have a version with the &#X2018;_odbc&#X2019;. This suffix indicates that the module
can be used with ODBC compatible relational databases. To enable storage to your
database, just make sure that your database is running well (see previous
sections), and replace the suffix-less or ldap module variant with the odbc
module variant. Keep in mind that you cannot have several variants of the same
module loaded!</P><P> <A NAME="ldap"></A> </P><!--TOC subsection LDAP-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc33">3.2.5</A>&#XA0;&#XA0;<A HREF="#ldap">LDAP</A></H3><!--SEC END --><P> <A NAME="ldap"></A> 
</P><P><TT>ejabberd</TT> has built-in LDAP support. You can authenticate users against LDAP
server and use LDAP directory as vCard storage. Shared rosters are not supported
yet.</P><P>Note that <TT>ejabberd</TT> treats LDAP as a read-only storage:
it is possible to consult data, but not possible to
create accounts, change password or edit vCard that is stored in LDAP.</P><P> <A NAME="ldapconnection"></A> </P><!--TOC subsubsection Connection-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#ldapconnection">Connection</A></H4><!--SEC END --><P> <A NAME="ldapconnection"></A> </P><P>Parameters:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>ldap_servers</TT></B></DT><DD CLASS="dd-description"> List of IP addresses or DNS names of your
LDAP servers. This option is required.
</DD><DT CLASS="dt-description"><B><TT>ldap_port</TT></B></DT><DD CLASS="dd-description"> Port to connect to your LDAP server.
The initial default value is&#XA0;389, so it is used when nothing is set into the
configuration file.
If you configure a value, it is stored in <TT>ejabberd</TT>&#X2019;s database.
Then, if you remove that value from the configuration file,
the value previously stored in the database will be used instead of the default 389.
</DD><DT CLASS="dt-description"><B><TT>ldap_rootdn</TT></B></DT><DD CLASS="dd-description"> Bind DN. The default value
is&#XA0;<TT>""</TT> which means &#X2018;anonymous connection&#X2019;.
</DD><DT CLASS="dt-description"><B><TT>ldap_password</TT></B></DT><DD CLASS="dd-description"> Bind password. The default
value is <TT>""</TT>.
</DD></DL><P>Example:
</P><PRE CLASS="verbatim">{auth_method, ldap}.
{ldap_servers, ["ldap.example.org"]}.
{ldap_port, 389}.
{ldap_rootdn, "cn=Manager,dc=domain,dc=org"}.
{ldap_password, "secret"}.
</PRE><P>Note that current LDAP implementation does not support SSL secured communication
and SASL authentication.</P><P> <A NAME="ldapauth"></A> </P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#ldapauth">Authentication</A></H4><!--SEC END --><P> <A NAME="ldapauth"></A> </P><P>You can authenticate users against an LDAP directory. Available options are:</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>ldap_base</TT></B></DT><DD CLASS="dd-description">LDAP base directory which stores
users accounts. This option is required.
</DD><DT CLASS="dt-description"><B><TT>ldap_uids</TT></B></DT><DD CLASS="dd-description">LDAP attribute which holds a list
of attributes to use as alternatives for getting the JID. The value is of
the form: <TT>[{ldap_uidattr}]</TT> or <TT>[{ldap_uidattr,
ldap_uidattr_format}]</TT>. You can use as many comma separated tuples
<TT>{ldap_uidattr, ldap_uidattr_format}</TT> that is needed. The default
value is <TT>[{"uid", "%u"}]</TT>. The defaut <TT>ldap_uidattr_format</TT>
is <TT>"%u"</TT>. The values for <TT>ldap_uidattr</TT> and
<TT>ldap_uidattr_format</TT> are described as follow:
<DL CLASS="description"><DT CLASS="dt-description">
<B><TT>ldap_uidattr</TT></B></DT><DD CLASS="dd-description">LDAP attribute which holds
the user&#X2019;s part of a JID. The default value is <TT>"uid"</TT>.
</DD><DT CLASS="dt-description"><B><TT>ldap_uidattr_format</TT></B></DT><DD CLASS="dd-description">Format of
the <TT>ldap_uidattr</TT> variable. The format <EM>must</EM> contain one and
only one pattern variable <TT>"%u"</TT> which will be replaced by the
user&#X2019;s part of a JID. For example, <TT>"%u@example.org"</TT>. The default
value is <TT>"%u"</TT>.
</DD></DL>
</DD><DT CLASS="dt-description"><B><TT>ldap_filter</TT></B></DT><DD CLASS="dd-description">
<A HREF="http://www.faqs.org/rfcs/rfc2254.html">RFC 2254</A> LDAP filter. The
default is <TT>none</TT>. Example:
<TT>"(&amp;(objectClass=shadowAccount)(memberOf=Jabber Users))"</TT>. Please, do
not forget to close brackets and do not use superfluous whitespaces. Also you
<EM>must not</EM> use <TT>ldap_uidattr</TT> attribute in filter because this
attribute will be substituted in LDAP filter automatically.</DD><DT CLASS="dt-description"><B><TT>ldap_local_filter</TT></B></DT><DD CLASS="dd-description">
If you can&#X2019;t use <TT>ldap_filter</TT> due to performance reasons
(the LDAP server has many users registered),
you can use this local filter.
The local filter checks an attribute in ejabberd,
not in LDAP, so this limits the load on the LDAP directory.
The default filter is: <TT>undefined</TT>.
Example values:
<PRE CLASS="verbatim">{ldap_local_filter, {notequal, {"accountStatus",["disabled"]}}}.
{ldap_local_filter, {equal, {"accountStatus",["enabled"]}}}.
{ldap_local_filter, undefined}.
</PRE></DD></DL><P> <A NAME="ldapexamples"></A> </P><!--TOC subsubsection Examples-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#ldapexamples">Examples</A></H4><!--SEC END --><P> <A NAME="ldapexamples"></A> </P><P> <A NAME="ldapcommonexample"></A> </P><!--TOC paragraph Common example-->
<H5 CLASS="paragraph"><!--SEC ANCHOR --><A HREF="#ldapcommonexample">Common example</A></H5><!--SEC END --><P> <A NAME="ldapcommonexample"></A> </P><P>Let&#X2019;s say <TT>ldap.example.org</TT> is the name of our LDAP server. We have
users with their passwords in <TT>"ou=Users,dc=example,dc=org"</TT> directory.
Also we have addressbook, which contains users emails and their additional
infos in <TT>"ou=AddressBook,dc=example,dc=org"</TT> directory. Corresponding
authentication section should looks like this:</P><PRE CLASS="verbatim">%% Authentication method
{auth_method, ldap}.
%% DNS name of our LDAP server
{ldap_servers, ["ldap.example.org"]}.
%% Bind to LDAP server as "cn=Manager,dc=example,dc=org" with password "secret"
{ldap_rootdn, "cn=Manager,dc=example,dc=org"}.
{ldap_password, "secret"}.
%% Define the user's base
{ldap_base, "ou=Users,dc=example,dc=org"}.
%% We want to authorize users from 'shadowAccount' object class only
{ldap_filter, "(objectClass=shadowAccount)"}.
</PRE><P>Now we want to use users LDAP-info as their vCards. We have four attributes
defined in our LDAP schema: <TT>"mail"</TT> &#X2014; email address, <TT>"givenName"</TT>
&#X2014; first name, <TT>"sn"</TT> &#X2014; second name, <TT>"birthDay"</TT> &#X2014; birthday.
Also we want users to search each other. Let&#X2019;s see how we can set it up:</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_vcard_ldap,
   [
    %% We use the same server and port, but want to bind anonymously because
    %% our LDAP server accepts anonymous requests to
    %% "ou=AddressBook,dc=example,dc=org" subtree.
    {ldap_rootdn, ""},
    {ldap_password, ""},
    %% define the addressbook's base
    {ldap_base, "ou=AddressBook,dc=example,dc=org"},
    %% uidattr: user's part of JID is located in the "mail" attribute
    %% uidattr_format: common format for our emails
    {ldap_uids, [{"mail", "%u@mail.example.org"}]},
    %% We have to define empty filter here, because entries in addressbook does not
    %% belong to shadowAccount object class
    {ldap_filter, ""},
    %% Now we want to define vCard pattern
    {ldap_vcard_map,
     [{"NICKNAME", "%u", []}, % just use user's part of JID as his nickname
      {"GIVEN", "%s", ["givenName"]},
      {"FAMILY", "%s", ["sn"]},
      {"FN", "%s, %s", ["sn", "givenName"]}, % example: "Smith, John"
      {"EMAIL", "%s", ["mail"]},
      {"BDAY", "%s", ["birthDay"]}]},
    %% Search form
    {ldap_search_fields,
     [{"User", "%u"},
      {"Name", "givenName"},
      {"Family Name", "sn"},
      {"Email", "mail"},
      {"Birthday", "birthDay"}]},
    %% vCard fields to be reported
    %% Note that JID is always returned with search results
    {ldap_search_reported,
     [{"Full Name", "FN"},
      {"Nickname", "NICKNAME"},
      {"Birthday", "BDAY"}]}
  ]},
  ...
 ]}.
</PRE><P>Note that <TT>mod_vcard_ldap</TT> module checks for the existence of the user before
searching in his information in LDAP.</P><P> <A NAME="ad"></A> </P><!--TOC paragraph Active Directory-->
<H5 CLASS="paragraph"><!--SEC ANCHOR --><A HREF="#ad">Active Directory</A></H5><!--SEC END --><P> <A NAME="ad"></A> 
</P><P>Active Directory is just an LDAP-server with predefined attributes. A sample
configuration is shown below:</P><PRE CLASS="verbatim">{auth_method, ldap}.
{ldap_servers, ["office.org"]}.    % List of LDAP servers
{ldap_base, "DC=office,DC=org"}. % Search base of LDAP directory
{ldap_rootdn, "CN=Administrator,CN=Users,DC=office,DC=org"}. % LDAP manager
{ldap_password, "*******"}. % Password to LDAP manager
{ldap_uids, [{"sAMAccountName"}]}.
{ldap_filter, "(memberOf=*)"}.

{modules,
 [
  ...
  {mod_vcard_ldap,
   [{ldap_vcard_map,
     [{"NICKNAME", "%u", []},
      {"GIVEN", "%s", ["givenName"]},
      {"MIDDLE", "%s", ["initials"]},
      {"FAMILY", "%s", ["sn"]},
      {"FN", "%s", ["displayName"]},
      {"EMAIL", "%s", ["mail"]},
      {"ORGNAME", "%s", ["company"]},
      {"ORGUNIT", "%s", ["department"]},
      {"CTRY", "%s", ["c"]},
      {"LOCALITY", "%s", ["l"]},
      {"STREET", "%s", ["streetAddress"]},
      {"REGION", "%s", ["st"]},
      {"PCODE", "%s", ["postalCode"]},
      {"TITLE", "%s", ["title"]},
      {"URL", "%s", ["wWWHomePage"]},
      {"DESC", "%s", ["description"]},
      {"TEL", "%s", ["telephoneNumber"]}]},
    {ldap_search_fields,
     [{"User", "%u"},
      {"Name", "givenName"},
      {"Family Name", "sn"},
      {"Email", "mail"},
      {"Company", "company"},
      {"Department", "department"},
      {"Role", "title"},
      {"Description", "description"},
      {"Phone", "telephoneNumber"}]},
    {ldap_search_reported,
     [{"Full Name", "FN"},
      {"Nickname", "NICKNAME"},
      {"Email", "EMAIL"}]}
  ]},
  ...
 ]}.
</PRE><P> <A NAME="modules"></A> </P><!--TOC section Modules Configuration-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc34">3.3</A>&#XA0;&#XA0;<A HREF="#modules">Modules Configuration</A></H2><!--SEC END --><P> <A NAME="modules"></A> 
</P><P>The option <TT>modules</TT> defines the list of modules that will be loaded after
<TT>ejabberd</TT>&#X2019;s startup. Each entry in the list is a tuple in which the first
element is the name of a module and the second is a list of options for that
module.</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
In this example only the module <TT>mod_echo</TT> is loaded and no module
options are specified between the square brackets:
<PRE CLASS="verbatim">{modules,
 [
  {mod_echo,      []}
 ]}.
</PRE></LI><LI CLASS="li-itemize">In the second example the modules <TT>mod_echo</TT>, <TT>mod_time</TT>, and
<TT>mod_version</TT> are loaded without options. Remark that, besides the last entry,
all entries end with a comma:
<PRE CLASS="verbatim">{modules,
 [
  {mod_echo,      []},
  {mod_time,      []},
  {mod_version,   []}
 ]}.
</PRE></LI></UL><P> <A NAME="modoverview"></A> </P><!--TOC subsection Modules Overview-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc35">3.3.1</A>&#XA0;&#XA0;<A HREF="#modoverview">Modules Overview</A></H3><!--SEC END --><P> <A NAME="modoverview"></A> 
</P><P>The following table lists all modules included in <TT>ejabberd</TT>.</P><BLOCKQUOTE CLASS="table"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=left NOWRAP><B>Module</B></TD><TD ALIGN=left NOWRAP><B>Feature</B></TD><TD ALIGN=left NOWRAP><B>Dependencies</B></TD></TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_adhoc</TT></TD><TD ALIGN=left NOWRAP>Ad-Hoc Commands (<A HREF="http://www.xmpp.org/extensions/xep-0050.html">XEP-0050</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modannounce"><TT>mod_announce</TT></A></TD><TD ALIGN=left NOWRAP>Manage announcements</TD><TD ALIGN=left NOWRAP>recommends <TT>mod_adhoc</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_caps</TT></TD><TD ALIGN=left NOWRAP>Entity Capabilities (<A HREF="http://www.xmpp.org/extensions/xep-0115.html">XEP-0115</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_configure</TT></TD><TD ALIGN=left NOWRAP>Server configuration using Ad-Hoc</TD><TD ALIGN=left NOWRAP><TT>mod_adhoc</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#moddisco"><TT>mod_disco</TT></A></TD><TD ALIGN=left NOWRAP>Service Discovery (<A HREF="http://www.xmpp.org/extensions/xep-0030.html">XEP-0030</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modecho"><TT>mod_echo</TT></A></TD><TD ALIGN=left NOWRAP>Echoes Jabber packets</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modirc"><TT>mod_irc</TT></A></TD><TD ALIGN=left NOWRAP>IRC transport</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modlast"><TT>mod_last</TT></A></TD><TD ALIGN=left NOWRAP>Last Activity (<A HREF="http://www.xmpp.org/extensions/xep-0012.html">XEP-0012</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modlast"><TT>mod_last_odbc</TT></A></TD><TD ALIGN=left NOWRAP>Last Activity (<A HREF="http://www.xmpp.org/extensions/xep-0012.html">XEP-0012</A>)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modmuc"><TT>mod_muc</TT></A></TD><TD ALIGN=left NOWRAP>Multi-User Chat (<A HREF="http://www.xmpp.org/extensions/xep-0045.html">XEP-0045</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modmuclog"><TT>mod_muc_log</TT></A></TD><TD ALIGN=left NOWRAP>Multi-User Chat room logging</TD><TD ALIGN=left NOWRAP><TT>mod_muc</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modoffline"><TT>mod_offline</TT></A></TD><TD ALIGN=left NOWRAP>Offline message storage (<A HREF="http://www.xmpp.org/extensions/xep-0160.html">XEP-0160</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modoffline"><TT>mod_offline_odbc</TT></A></TD><TD ALIGN=left NOWRAP>Offline message storage (<A HREF="http://www.xmpp.org/extensions/xep-0160.html">XEP-0160</A>)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modprivacy"><TT>mod_privacy</TT></A></TD><TD ALIGN=left NOWRAP>Blocking Communication (XMPP IM)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modprivacy"><TT>mod_privacy_odbc</TT></A></TD><TD ALIGN=left NOWRAP>Blocking Communication (XMPP IM)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modprivate"><TT>mod_private</TT></A></TD><TD ALIGN=left NOWRAP>Private XML Storage (<A HREF="http://www.xmpp.org/extensions/xep-0049.html">XEP-0049</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modprivate"><TT>mod_private_odbc</TT></A></TD><TD ALIGN=left NOWRAP>Private XML Storage (<A HREF="http://www.xmpp.org/extensions/xep-0049.html">XEP-0049</A>)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modproxy"><TT>mod_proxy65</TT></A></TD><TD ALIGN=left NOWRAP>SOCKS5 Bytestreams (<A HREF="http://www.xmpp.org/extensions/xep-0065.html">XEP-0065</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modpubsub"><TT>mod_pubsub</TT></A></TD><TD ALIGN=left NOWRAP>Pub-Sub (<A HREF="http://www.xmpp.org/extensions/xep-0060.html">XEP-0060</A>), PEP (<A HREF="http://www.xmpp.org/extensions/xep-0163.html">XEP-0163</A>)</TD><TD ALIGN=left NOWRAP><TT>mod_caps</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modregister"><TT>mod_register</TT></A></TD><TD ALIGN=left NOWRAP>In-Band Registration (<A HREF="http://www.xmpp.org/extensions/xep-0077.html">XEP-0077</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modroster"><TT>mod_roster</TT></A></TD><TD ALIGN=left NOWRAP>Roster management (XMPP IM)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modroster"><TT>mod_roster_odbc</TT></A></TD><TD ALIGN=left NOWRAP>Roster management (XMPP IM)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modservicelog"><TT>mod_service_log</TT></A></TD><TD ALIGN=left NOWRAP>Copy user messages to logger service</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modsharedroster"><TT>mod_shared_roster</TT></A></TD><TD ALIGN=left NOWRAP>Shared roster management</TD><TD ALIGN=left NOWRAP><TT>mod_roster</TT> or</TD></TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD><TD ALIGN=left NOWRAP>&nbsp;</TD><TD ALIGN=left NOWRAP><TT>mod_roster_odbc</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modstats"><TT>mod_stats</TT></A></TD><TD ALIGN=left NOWRAP>Statistics Gathering (<A HREF="http://www.xmpp.org/extensions/xep-0039.html">XEP-0039</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modtime"><TT>mod_time</TT></A></TD><TD ALIGN=left NOWRAP>Entity Time (<A HREF="http://www.xmpp.org/extensions/xep-0090.html">XEP-0090</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modvcard"><TT>mod_vcard</TT></A></TD><TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.xmpp.org/extensions/xep-0054.html">XEP-0054</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modvcardldap"><TT>mod_vcard_ldap</TT></A></TD><TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.xmpp.org/extensions/xep-0054.html">XEP-0054</A>)</TD><TD ALIGN=left NOWRAP>LDAP server</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modvcard"><TT>mod_vcard_odbc</TT></A></TD><TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.xmpp.org/extensions/xep-0054.html">XEP-0054</A>)</TD><TD ALIGN=left NOWRAP>supported DB (*)</TD></TR>
<TR><TD ALIGN=left NOWRAP><A HREF="#modversion"><TT>mod_version</TT></A></TD><TD ALIGN=left NOWRAP>Software Version (<A HREF="http://www.xmpp.org/extensions/xep-0092.html">XEP-0092</A>)</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
</TABLE>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE><UL CLASS="itemize"><LI CLASS="li-itemize">
(*) This module requires a supported database. For a list of supported databases, see section&#XA0;<A HREF="#database">3.2</A>.
</LI></UL><P>You can see which database backend each module needs by looking at the suffix:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
No suffix, this means that the modules uses Erlang&#X2019;s built-in database
Mnesia as backend.
</LI><LI CLASS="li-itemize">&#X2018;_odbc&#X2019;, this means that the module needs a supported database
(see&#XA0;<A HREF="#database">3.2</A>) as backend.
</LI><LI CLASS="li-itemize">&#X2018;_ldap&#X2019;, this means that the module needs an LDAP server as backend.
</LI></UL><P>If you want to,
it is possible to use a relational database to store pieces of
information. You can do this by changing the module name to a name with an
<TT>_odbc</TT> suffix in <TT>ejabberd</TT> config file. You can use a relational
database for the following data:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Last connection date and time: Use <TT>mod_last_odbc</TT> instead of
<TT>mod_last</TT>.
</LI><LI CLASS="li-itemize">Offline messages: Use <TT>mod_offline_odbc</TT> instead of
<TT>mod_offline</TT>.
</LI><LI CLASS="li-itemize">Rosters: Use <TT>mod_roster_odbc</TT> instead of <TT>mod_roster</TT>.
</LI><LI CLASS="li-itemize">Users&#X2019; VCARD: Use <TT>mod_vcard_odbc</TT> instead of <TT>mod_vcard</TT>.
</LI><LI CLASS="li-itemize">Private XML storage: Use <TT>mod_private_odbc</TT> instead of <TT>mod_private</TT>.
</LI><LI CLASS="li-itemize">User rules for blocking communications: Use <TT>mod_privacy_odbc</TT> instead of <TT>mod_privacy</TT>.
</LI></UL><P>You can find more
<A HREF="http://www.ejabberd.im/contributions">contributed modules</A> on the
<TT>ejabberd</TT> website. Please remember that these contributions might not work or
that they can contain severe bugs and security leaks. Therefore, use them at
your own risk!</P><P> <A NAME="modcommonoptions"></A> </P><!--TOC subsection Common Options-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc36">3.3.2</A>&#XA0;&#XA0;<A HREF="#modcommonoptions">Common Options</A></H3><!--SEC END --><P> <A NAME="modcommonoptions"></A> </P><P>The following options are used by many modules. Therefore, they are described in
this separate section.</P><P> <A NAME="modiqdiscoption"></A> </P><!--TOC subsubsection <TT>iqdisc</TT>-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#modiqdiscoption"><TT>iqdisc</TT></A></H4><!--SEC END --><P> <A NAME="modiqdiscoption"></A> 
</P><P>Many modules define handlers for processing IQ queries of different namespaces
to this server or to a user (e.&#XA0;g. to <TT>example.org</TT> or to
<TT>user@example.org</TT>). This option defines processing discipline for
these queries. Possible values are:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>no_queue</TT></B></DT><DD CLASS="dd-description"> All queries of a namespace with this processing discipline are
processed immediately. This also means that no other packets can be processed
until this one has been completely processed. Hence this discipline is not
recommended if the processing of a query can take a relatively long time.
</DD><DT CLASS="dt-description"><B><TT>one_queue</TT></B></DT><DD CLASS="dd-description"> In this case a separate queue is created for the processing
of IQ queries of a namespace with this discipline. In addition, the processing
of this queue is done in parallel with that of other packets. This discipline
is most recommended.
</DD><DT CLASS="dt-description"><B><TT>{queues, N}</TT></B></DT><DD CLASS="dd-description"> N separate queues are created to process the
queries. The queries are thus process in parallel, but in a
controlled way.
</DD><DT CLASS="dt-description"><B><TT>parallel</TT></B></DT><DD CLASS="dd-description"> For every packet with this discipline a separate Erlang process
is spawned. Consequently, all these packets are processed in parallel.
Although spawning of Erlang process has a relatively low cost, this can break
the server&#X2019;s normal work, because the Erlang emulator has a limit on the
number of processes (32000 by default).
</DD></DL><P>Example:
</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_time, [{iqdisc, no_queue}]},
  ...
 ]}.
</PRE><P> <A NAME="modhostoption"></A> </P><!--TOC subsubsection <TT>host</TT>-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A HREF="#modhostoption"><TT>host</TT></A></H4><!--SEC END --><P> <A NAME="modhostoption"></A> 
</P><P>This option defines the Jabber ID of a service provided by an <TT>ejabberd</TT> module.
The keyword "@HOST@" is replaced at start time with the real virtual host string.</P><P>This example configures
the echo module to provide its echoing service
in the Jabber ID <TT>mirror.example.org</TT>:
</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_echo, [{host, "mirror.example.org"}]},
  ...
 ]}.
</PRE><P>However, if there are several virtual hosts and this module is enabled in all of them,
the "@HOST@" keyword must be used:
</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_echo, [{host, "mirror.@HOST@"}]},
  ...
 ]}.
</PRE><P> <A NAME="modannounce"></A> </P><!--TOC subsection <TT>mod_announce</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc37">3.3.3</A>&#XA0;&#XA0;<A HREF="#modannounce"><TT>mod_announce</TT></A></H3><!--SEC END --><P> <A NAME="modannounce"></A> 
</P><P>This module enables configured users to broadcast announcements and to set
the message of the day (MOTD).
Configured users can perform these actions with a
Jabber client either using Ad-hoc commands
or sending messages to specific JIDs.</P><P>The Ad-hoc commands are listed in the Server Discovery.
For this feature to work, <TT>mod_adhoc</TT> must be enabled.</P><P>The specific JIDs where messages can be sent are listed bellow.
The first JID in each entry will apply only to the specified virtual host
<TT>example.org</TT>, while the JID between brackets will apply to all virtual
hosts in ejabberd.
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>example.org/announce/all (example.org/announce/all-hosts/all)</TT></B></DT><DD CLASS="dd-description"> The
message is sent to all registered users. If the user is online and connected
to several resources, only the resource with the highest priority will receive
the message. If the registered user is not connected, the message will be
stored offline in assumption that offline storage
(see section&#XA0;<A HREF="#modoffline">3.3.10</A>) is enabled.
</DD><DT CLASS="dt-description"><B><TT>example.org/announce/online (example.org/announce/all-hosts/online)</TT></B></DT><DD CLASS="dd-description">The
message is sent to all connected users. If the user is online and connected
to several resources, all resources will receive the message.
</DD><DT CLASS="dt-description"><B><TT>example.org/announce/motd (example.org/announce/all-hosts/motd)</TT></B></DT><DD CLASS="dd-description">The
message is set as the message of the day (MOTD) and is sent to users when they
login. In addition the message is sent to all connected users (similar to
<TT>announce/online</TT>).
</DD><DT CLASS="dt-description"><B><TT>example.org/announce/motd/update (example.org/announce/all-hosts/motd/update)</TT></B></DT><DD CLASS="dd-description">
The message is set as message of the day (MOTD) and is sent to users when they
login. The message is <EM>not sent</EM> to any currently connected user.
</DD><DT CLASS="dt-description"><B><TT>example.org/announce/motd/delete (example.org/announce/all-hosts/motd/delete)</TT></B></DT><DD CLASS="dd-description">
Any message sent to this JID removes the existing message of the day (MOTD).
</DD></DL><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>access</TT></B></DT><DD CLASS="dd-description"> This option specifies who is allowed to
send announcements and to set the message of the day (by default, nobody is
able to send such messages).
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Only administrators can send announcements:
<PRE CLASS="verbatim">{access, announce, [{allow, admins}]}.

{modules,
 [
  ...
  {mod_adhoc, []},
  {mod_announce, [{access, announce}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">Administrators as well as the direction can send announcements:
<PRE CLASS="verbatim">{acl, direction, {user, "big_boss", "example.org"}}.
{acl, direction, {user, "assistant", "example.org"}}.
{acl, admins, {user, "admin", "example.org"}}.

{access, announce, [{allow, admins},
                    {allow, direction}]}.

{modules,
 [
  ...
  {mod_adhoc, []},
  {mod_announce, [{access, announce}]},
  ...
 ]}.
</PRE></LI></UL><P>Note that <TT>mod_announce</TT> can be resource intensive on large
deployments as it can broadcast lot of messages. This module should be
disabled for instances of <TT>ejabberd</TT> with hundreds of thousands users.</P><P> <A NAME="moddisco"></A> </P><!--TOC subsection <TT>mod_disco</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc38">3.3.4</A>&#XA0;&#XA0;<A HREF="#moddisco"><TT>mod_disco</TT></A></H3><!--SEC END --><P> <A NAME="moddisco"></A> 



</P><P>This module adds support for Service Discovery (<A HREF="http://www.xmpp.org/extensions/xep-0030.html">XEP-0030</A>). With
this module enabled, services on your server can be discovered by
Jabber clients. Note that <TT>ejabberd</TT> has no modules with support
for the superseded Jabber Browsing (<A HREF="http://www.xmpp.org/extensions/xep-0011.html">XEP-0011</A>) and Agent Information
(<A HREF="http://www.xmpp.org/extensions/xep-0094.html">XEP-0094</A>). Accordingly, Jabber clients need to have support for
the newer Service Discovery protocol if you want them be able to discover
the services you offer.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Service Discovery (<TT>http://jabber.org/protocol/disco#items</TT> and
<TT>http://jabber.org/protocol/disco#info</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD><DT CLASS="dt-description"><B><TT>extra_domains</TT></B></DT><DD CLASS="dd-description"> With this option,
extra domains can be added to the Service Discovery item list.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To serve a link to the Jabber User Directory on <TT>jabber.org</TT>:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_disco, [{extra_domains, ["users.jabber.org"]}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">To serve a link to the transports on another server:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_disco, [{extra_domains, ["icq.example.com",
                                "msn.example.com"]}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">To serve a link to a few friendly servers:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_disco, [{extra_domains, ["example.org",
                                "example.com"]}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modecho"></A> </P><!--TOC subsection <TT>mod_echo</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc39">3.3.5</A>&#XA0;&#XA0;<A HREF="#modecho"><TT>mod_echo</TT></A></H3><!--SEC END --><P> <A NAME="modecho"></A> 
</P><P>This module simply echoes any Jabber
packet back to the sender. This mirror can be of interest for
<TT>ejabberd</TT> and Jabber client debugging.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>echo.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD></DL><P>Example: Mirror, mirror, on the wall, who is the most beautiful
of them all?
</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_echo, [{host, "mirror.example.org"}]},
  ...
 ]}.
</PRE><P> <A NAME="modirc"></A> </P><!--TOC subsection <TT>mod_irc</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc40">3.3.6</A>&#XA0;&#XA0;<A HREF="#modirc"><TT>mod_irc</TT></A></H3><!--SEC END --><P> <A NAME="modirc"></A> 
</P><P>This module is an IRC transport that can be used to join channels on IRC
servers.</P><P>End user information:

</P><UL CLASS="itemize"><LI CLASS="li-itemize">
A Jabber client with &#X2018;groupchat 1.0&#X2019; support or Multi-User
Chat support (<A HREF="http://www.xmpp.org/extensions/xep-0045.html">XEP-0045</A>) is necessary to join IRC channels.
</LI><LI CLASS="li-itemize">An IRC channel can be joined in nearly the same way as joining a
Jabber Multi-User Chat room. The difference is that the room name will
be &#X2018;channel%<TT>irc.example.org</TT>&#X2019; in case <TT>irc.example.org</TT> is
the IRC server hosting &#X2018;channel&#X2019;. And of course the host should point
to the IRC transport instead of the Multi-User Chat service.
</LI><LI CLASS="li-itemize">You can register your nickame by sending &#X2018;IDENTIFY password&#X2019; to<BR>
 <TT>nickserver!irc.example.org@irc.jabberserver.org</TT>.
</LI><LI CLASS="li-itemize">Entering your password is possible by sending &#X2018;LOGIN nick password&#X2019;<BR>
 to <TT>nickserver!irc.example.org@irc.jabberserver.org</TT>.
</LI><LI CLASS="li-itemize">When using a popular Jabber server, it can occur that no
connection can be achieved with some IRC servers because they limit the
number of conections from one IP.
</LI></UL><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>irc.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD><DT CLASS="dt-description"><B><TT>access</TT></B></DT><DD CLASS="dd-description"> This option can be used to specify who
may use the IRC transport (default value: <TT>all</TT>).
</DD><DT CLASS="dt-description"><B><TT>default_encoding</TT></B></DT><DD CLASS="dd-description"> Set the default IRC encoding (default value: <TT>"koi8-r"</TT>).
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
In the first example, the IRC transport is available on (all) your
virtual host(s) with the prefix &#X2018;<TT>irc.</TT>&#X2019;. Furthermore, anyone is
able to use the transport. The default encoding is set to "iso8859-15".
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_irc, [{access, all}, {default_encoding, "iso8859-15"}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">In next example the IRC transport is available with JIDs with prefix <TT>irc-t.net</TT>.
Moreover, the transport is only accessible by paying customers registered on
our domains and on other servers.
<PRE CLASS="verbatim">{acl, paying_customers, {user, "customer1", "example.net"}}.
{acl, paying_customers, {user, "customer2", "example.com"}}.
{acl, paying_customers, {user, "customer3", "example.org"}}.

{access, paying_customers, [{allow, paying_customers},
                              {deny, all}]}.

{modules,
 [
  ...
  {mod_irc, [{access, paying_customers},
             {host, "irc.example.net"}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modlast"></A> </P><!--TOC subsection <TT>mod_last</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc41">3.3.7</A>&#XA0;&#XA0;<A HREF="#modlast"><TT>mod_last</TT></A></H3><!--SEC END --><P> <A NAME="modlast"></A> 
</P><P>This module adds support for Last Activity (<A HREF="http://www.xmpp.org/extensions/xep-0012.html">XEP-0012</A>). It can be used to
discover when a disconnected user last accessed the server, to know when a
connected user was last active on the server, or to query the uptime of the
<TT>ejabberd</TT> server.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Last activity (<TT>jabber:iq:last</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="modmuc"></A> </P><!--TOC subsection <TT>mod_muc</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc42">3.3.8</A>&#XA0;&#XA0;<A HREF="#modmuc"><TT>mod_muc</TT></A></H3><!--SEC END --><P> <A NAME="modmuc"></A> 
</P><P>This module provides a Multi-User Chat (<A HREF="http://www.xmpp.org/extensions/xep-0045.html">XEP-0045</A>) service.
Users can discover existing rooms, join or create them.
Occupants of a room can chat in public or have private chats.</P><P>Some of the features of Multi-User Chat:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Sending public and private messages to room occupants.
</LI><LI CLASS="li-itemize">Inviting other users to a room.
</LI><LI CLASS="li-itemize">Setting a room subject.
</LI><LI CLASS="li-itemize">Creating password protected rooms.
</LI><LI CLASS="li-itemize">Kicking and banning occupants.
</LI></UL><P>The MUC service allows any Jabber ID to register a nickname,
so nobody else can use that nickname in any room in the MUC service.
To register a nickname, open the Service Discovery in your
Jabber client and register in the MUC service.</P><P>This module supports clustering and load
balancing. One module can be started per cluster node. Rooms are
distributed at creation time on all available MUC module
instances. The multi-user chat module is clustered but the rooms
themselves are not clustered nor fault-tolerant: if the node managing a
set of rooms goes down, the rooms disappear and they will be recreated
on an available node on first connection attempt.</P><P>Module options:
</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>conference.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD><DT CLASS="dt-description"><B><TT>access</TT></B></DT><DD CLASS="dd-description"> You can specify who is allowed to use
the Multi-User Chat service. By default everyone is allowed to use it.
</DD><DT CLASS="dt-description"><B><TT>access_create</TT></B></DT><DD CLASS="dd-description"> To configure who is
allowed to create new rooms at the Multi-User Chat service, this option
can be used. By default everybody is allowed to create rooms.
</DD><DT CLASS="dt-description"><B><TT>access_persistent</TT></B></DT><DD CLASS="dd-description"> To configure who is
allowed to modify the &#X2019;persistent&#X2019; room option.
By default everybody is allowed to modify that option.
</DD><DT CLASS="dt-description"><B><TT>access_admin</TT></B></DT><DD CLASS="dd-description"> This option specifies
who is allowed to administrate the Multi-User Chat service. The default
value is <TT>none</TT>, which means that only the room creator can
administer his room.
The administrators can send a normal message to the service JID,
and it will be shown in all active rooms as a service message.
The administrators can send a groupchat message to the JID of an active room,
and the message will be shown in the room as a service message.
</DD><DT CLASS="dt-description"><B><TT>history_size</TT></B></DT><DD CLASS="dd-description"> A small history of
the current discussion is sent to users when they enter the
room. With this option you can define the number of history messages
to keep and send to users joining the room. The value is an
integer. Setting the value to <TT>0</TT> disables the history feature
and, as a result, nothing is kept in memory. The default value is
<TT>20</TT>. This value is global and thus affects all rooms on the
service.
</DD><DT CLASS="dt-description"><B><TT>max_users</TT></B></DT><DD CLASS="dd-description">  This option defines at
the service level, the maximum number of users allowed per
room. It can be lowered in each room configuration but cannot be
increased in individual room configuration. The default value is
200.
</DD><DT CLASS="dt-description"><B><TT>max_users_admin_threshold</TT></B></DT><DD CLASS="dd-description">
 This option defines the
number of service admins or room owners allowed to enter the room when
the maximum number of allowed occupants was reached. The default limit
is 5.
</DD><DT CLASS="dt-description"><B><TT>max_user_conferences</TT></B></DT><DD CLASS="dd-description">
 This option defines the maximum
number of rooms that any given user can join. The default value
is 10. This option is used to prevent possible abuses. Note that
this is a soft limit: some users can sometimes join more conferences
in cluster configurations.
</DD><DT CLASS="dt-description"><B><TT>min_message_interval</TT></B></DT><DD CLASS="dd-description"> 
This option defines the minimum interval between two messages send
by an occupant in seconds. This option is global and valid for all
rooms. A decimal value can be used. When this option is not defined,
message rate is not limited. This feature can be used to protect a
MUC service from occupant abuses and limit number of messages that will
be broadcasted by the service. A good value for this minimum message
interval is 0.4 second. If an occupant tries to send messages faster, an
error is send back explaining that the message has been discarded
and describing the reason why the message is not acceptable.
</DD><DT CLASS="dt-description"><B><TT>min_presence_interval</TT></B></DT><DD CLASS="dd-description">
 This option defines the
minimum of time between presence changes coming from a given occupant in
seconds. This option is global and valid for all rooms. A
decimal value can be used. When this option is not defined, no
restriction is applied. This option can be used to protect a MUC
service for occupants abuses. If an occupant tries
to change its presence more often than the specified interval, the
presence is cached by <TT>ejabberd</TT> and only the last presence is
broadcasted to all occupants in the room after expiration of the
interval delay. Intermediate presence packets are silently
discarded. A good value for this option is 4 seconds.
</DD><DT CLASS="dt-description"><B><TT>default_room_options</TT></B></DT><DD CLASS="dd-description"> 
This module option allows to define the desired default room options.
Note that the creator of a room can modify the options of his room
at any time using a Jabber client with MUC capability.
The available room options and the default values are:
<DL CLASS="description"><DT CLASS="dt-description">
<B><TT>{allow_change_subj, true}</TT></B></DT><DD CLASS="dd-description"> Allow occupants to change the subject.
</DD><DT CLASS="dt-description"><B><TT>{allow_private_messages, true}</TT></B></DT><DD CLASS="dd-description"> Occupants can send private messages to other occupants.
</DD><DT CLASS="dt-description"><B><TT>{allow_query_users, true}</TT></B></DT><DD CLASS="dd-description"> Occupants can send IQ queries to other occupants.
</DD><DT CLASS="dt-description"><B><TT>{allow_user_invites, false}</TT></B></DT><DD CLASS="dd-description"> Allow occupants to send invitations.
</DD><DT CLASS="dt-description"><B><TT>{allow_visitor_nickchange, true}</TT></B></DT><DD CLASS="dd-description"> Allow visitors to
change nickname.
</DD><DT CLASS="dt-description"><B><TT>{allow_visitor_status, true}</TT></B></DT><DD CLASS="dd-description"> Allow visitors to send
status text in presence updates. If disallowed, the <TT>status</TT>
text is stripped before broadcasting the presence update to all
the room occupants.
</DD><DT CLASS="dt-description"><B><TT>{anonymous, true}</TT></B></DT><DD CLASS="dd-description"> The room is anonymous:
occupants don&#X2019;t see the real JIDs of other occupants.
Note that the room moderators can always see the real JIDs of the occupants.
</DD><DT CLASS="dt-description"><B><TT>{logging, false}</TT></B></DT><DD CLASS="dd-description"> The public messages are logged using <TT>mod_muc_log</TT>.
</DD><DT CLASS="dt-description"><B><TT>{max_users, 200}</TT></B></DT><DD CLASS="dd-description"> Maximum number of occupants in the room.
</DD><DT CLASS="dt-description"><B><TT>{members_by_default, true}</TT></B></DT><DD CLASS="dd-description"> The occupants that enter the room are participants by default, so they have &#X2019;voice&#X2019;.
</DD><DT CLASS="dt-description"><B><TT>{members_only, false}</TT></B></DT><DD CLASS="dd-description"> Only members of the room can enter.
</DD><DT CLASS="dt-description"><B><TT>{moderated, true}</TT></B></DT><DD CLASS="dd-description"> Only occupants with &#X2019;voice&#X2019; can send public messages.
</DD><DT CLASS="dt-description"><B><TT>{password, ""}</TT></B></DT><DD CLASS="dd-description"> Password of the room. You may want to enable the next option too.
</DD><DT CLASS="dt-description"><B><TT>{password_protected, false}</TT></B></DT><DD CLASS="dd-description"> The password is required to enter the room.
</DD><DT CLASS="dt-description"><B><TT>{persistent, false}</TT></B></DT><DD CLASS="dd-description"> The room persists even if the last participant leaves.
</DD><DT CLASS="dt-description"><B><TT>{public, true}</TT></B></DT><DD CLASS="dd-description"> The room is public in the list of the MUC service, so it can be discovered.
</DD><DT CLASS="dt-description"><B><TT>{public_list, true}</TT></B></DT><DD CLASS="dd-description"> The list of participants is public, without requiring to enter the room.
</DD><DT CLASS="dt-description"><B><TT>{title, ""}</TT></B></DT><DD CLASS="dd-description"> A human-readable title of the room.
</DD></DL>
All of those room options can be set to <TT>true</TT> or <TT>false</TT>,
except <TT>password</TT> and <TT>title</TT> which are strings,
and <TT>max_users</TT> that is integer.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
In the first example everyone is allowed to use the Multi-User Chat
service. Everyone will also be able to create new rooms but only the user
<TT>admin@example.org</TT> is allowed to administrate any room. In this
example he is also a global administrator. When <TT>admin@example.org</TT>
sends a message such as &#X2018;Tomorrow, the Jabber server will be moved
to new hardware. This will involve service breakdowns around 23:00 UMT.
We apologise for this inconvenience.&#X2019; to <TT>conference.example.org</TT>,
it will be displayed in all active rooms. In this example the history
feature is disabled.
<PRE CLASS="verbatim">{acl, admins, {user, "admin", "example.org"}}.

{access, muc_admins, [{allow, admins}]}.

{modules,
 [
  ...
  {mod_muc, [{access, all},
             {access_create, all},
             {access_admin, muc_admins},
             {history_size, 0}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">In the second example the Multi-User Chat service is only accessible by
paying customers registered on our domains and on other servers. Of course
the administrator is also allowed to access rooms. In addition, he is the
only authority able to create and administer rooms. When
<TT>admin@example.org</TT> sends a message such as &#X2018;Tomorrow, the Jabber
server will be moved to new hardware. This will involve service breakdowns
around 23:00 UMT. We apologise for this inconvenience.&#X2019; to
<TT>conference.example.org</TT>, it will be displayed in all active rooms. No
<TT>history_size</TT> option is used, this means that the feature is enabled
and the default value of 20 history messages will be send to the users.
<PRE CLASS="verbatim">{acl, paying_customers, {user, "customer1", "example.net"}}.
{acl, paying_customers, {user, "customer2", "example.com"}}.
{acl, paying_customers, {user, "customer3", "example.org"}}.
{acl, admins, {user, "admin", "example.org"}}.

{access, muc_admins, [{allow, admins},
                      {deny, all}]}.
{access, muc_access, [{allow, paying_customers},
                      {allow, admins},
                      {deny, all}]}.

{modules,
 [
  ...
  {mod_muc, [{access, muc_access},
             {access_create, muc_admins},
             {access_admin, muc_admins}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">In the following example, MUC anti abuse options are used. An
occupant cannot send more than one message every 0.4 seconds and cannot
change its presence more than once every 4 seconds. No ACLs are
defined, but some user restriction could be added as well:<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_muc, [{min_message_interval, 0.4},
             {min_presence_interval, 4}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">This example shows how to use <TT>default_room_options</TT> to make sure
the newly created rooms have by default those options.
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_muc, [{access, muc_access},
             {access_create, muc_admins},
             {default_room_options,
              [
               {allow_change_subj, false},
               {allow_query_users, true},
               {allow_private_messages, true},
               {members_by_default, false},
               {title, "New chatroom"},
               {anonymous, false}
              ]},
             {access_admin, muc_admins}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modmuclog"></A> </P><!--TOC subsection <TT>mod_muc_log</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc43">3.3.9</A>&#XA0;&#XA0;<A HREF="#modmuclog"><TT>mod_muc_log</TT></A></H3><!--SEC END --><P> <A NAME="modmuclog"></A> 
</P><P>This module enables optional logging of Multi-User Chat (MUC) public conversations to
HTML. Once you enable this module, users can join a room using a MUC capable
Jabber client, and if they have enough privileges, they can request the
configuration form in which they can set the option to enable room logging.</P><P>Features:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Room details are added on top of each page: room title, JID,
author, subject and configuration.
</LI><LI CLASS="li-itemize">
The room JID in the generated HTML is a link to join the room (using
<A HREF="http://www.xmpp.org/rfcs/rfc5122.html">XMPP URI</A>).
</LI><LI CLASS="li-itemize">Subject and room configuration changes are tracked and displayed.
</LI><LI CLASS="li-itemize">Joins, leaves, nick changes, kicks, bans and &#X2018;/me&#X2019; are tracked and
displayed, including the reason if available.
</LI><LI CLASS="li-itemize">Generated HTML files are XHTML 1.0 Transitional and CSS compliant.
</LI><LI CLASS="li-itemize">Timestamps are self-referencing links.
</LI><LI CLASS="li-itemize">Links on top for quicker navigation: Previous day, Next day, Up.
</LI><LI CLASS="li-itemize">CSS is used for style definition, and a custom CSS file can be used.
</LI><LI CLASS="li-itemize">URLs on messages and subjects are converted to hyperlinks.
</LI><LI CLASS="li-itemize">Timezone used on timestamps is shown on the log files.
</LI><LI CLASS="li-itemize">A custom link can be added on top of each page.
</LI></UL><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>access_log</TT></B></DT><DD CLASS="dd-description">
This option restricts which occupants are allowed to enable or disable room
logging. The default value is <TT>muc_admin</TT>. Note for this default setting
you need to have an access rule for <TT>muc_admin</TT> in order to take effect.
</DD><DT CLASS="dt-description"><B><TT>cssfile</TT></B></DT><DD CLASS="dd-description">
With this option you can set whether the HTML files should have a custom CSS
file or if they need to use the embedded CSS file. Allowed values are
<TT>false</TT> and an URL to a CSS file. With the first value, HTML files will
include the embedded CSS code. With the latter, you can specify the URL of the
custom CSS file (for example: &#X2018;http://example.com/my.css&#X2019;). The default value
is <TT>false</TT>.
</DD><DT CLASS="dt-description"><B><TT>dirtype</TT></B></DT><DD CLASS="dd-description">
The type of the created directories can be specified with this option. Allowed
values are <TT>subdirs</TT> and <TT>plain</TT>. With the first value,
subdirectories are created for each year and month. With the latter, the
names of the log files contain the full date, and there are no subdirectories.
The default value is <TT>subdirs</TT>.
</DD><DT CLASS="dt-description"><B><TT>outdir</TT></B></DT><DD CLASS="dd-description">
This option sets the full path to the directory in which the HTML files should
be stored. Make sure the <TT>ejabberd</TT> daemon user has write access on that
directory. The default value is <TT>"www/muc"</TT>.
</DD><DT CLASS="dt-description"><B><TT>timezone</TT></B></DT><DD CLASS="dd-description">
The time zone for the logs is configurable with this option. Allowed values
are <TT>local</TT> and <TT>universal</TT>. With the first value, the local time,
as reported to Erlang by the operating system, will be used. With the latter,
GMT/UTC time will be used. The default value is <TT>local</TT>.
</DD><DT CLASS="dt-description"><B><TT>spam_prevention</TT></B></DT><DD CLASS="dd-description">
To prevent spam, the <TT>spam_prevention</TT> option adds a special attribute
to links that prevent their indexation by search engines. The default value
is <TT>true</TT>, which mean that nofollow attributes will be added to user
submitted links.
</DD><DT CLASS="dt-description"><B><TT>top_link</TT></B></DT><DD CLASS="dd-description">
With this option you can customize the link on the top right corner of each
log file. The syntax of this option is <TT>{"URL", "Text"}</TT>. The default
value is <TT>{"/", "Home"}</TT>.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
In the first example any room owner can enable logging, and a
custom CSS file will be used (http://example.com/my.css). The names
of the log files will contain the full date, and there will be no
subdirectories. The log files will be stored in /var/www/muclogs, and the
time zone will be GMT/UTC. Finally, the top link will be
<CODE>&lt;a href="http://www.jabber.ru/"&gt;Jabber.ru&lt;/a&gt;</CODE>.
<PRE CLASS="verbatim">{access, muc, [{allow, all}]}.

{modules,
 [
  ...
  {mod_muc_log, [
                 {access_log, muc},
                 {cssfile, "http://example.com/my.css"},
                 {dirtype, plain},
                 {outdir, "/var/www/muclogs"},
                 {timezone, universal},
                 {spam_prevention, true},
                 {top_link, {"http://www.jabber.ru/", "Jabber.ru"}}
                ]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">In the second example only <TT>admin1@example.org</TT> and
<TT>admin2@example.net</TT> can enable logging, and the embedded CSS file will be
used. The names of the log files will only contain the day (number),
and there will be subdirectories for each year and month. The log files will
be stored in /var/www/muclogs, and the local time will be used. Finally, the
top link will be the default <CODE>&lt;a href="/"&gt;Home&lt;/a&gt;</CODE>.
<PRE CLASS="verbatim">{acl, admins, {user, "admin1", "example.org"}}.
{acl, admins, {user, "admin2", "example.net"}}.

{access, muc_log, [{allow, admins},
                   {deny, all}]}.

{modules,
 [
  ...
  {mod_muc_log, [
                 {access_log, muc_log},
                 {cssfile, false},
                 {dirtype, subdirs},
                 {outdir, "/var/www/muclogs"},
                 {timezone, local}
                ]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modoffline"></A> </P><!--TOC subsection <TT>mod_offline</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc44">3.3.10</A>&#XA0;&#XA0;<A HREF="#modoffline"><TT>mod_offline</TT></A></H3><!--SEC END --><P> <A NAME="modoffline"></A> 
</P><P>This module implements offline message storage. This means that all messages
sent to an offline user will be stored on the server until that user comes
online again. Thus it is very similar to how email works. Note that
<TT>ejabberdctl</TT> has a command to delete expired messages
(see section&#XA0;<A HREF="#ejabberdctl">4.1</A>).</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>user_max_messages</TT></B></DT><DD CLASS="dd-description">This option
is use to set a max number of offline messages per user (quota). Its
value can be either <TT>infinity</TT> or a strictly positive
integer. The default value is <TT>infinity</TT>.
</DD></DL><P> <A NAME="modprivacy"></A> </P><!--TOC subsection <TT>mod_privacy</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc45">3.3.11</A>&#XA0;&#XA0;<A HREF="#modprivacy"><TT>mod_privacy</TT></A></H3><!--SEC END --><P> <A NAME="modprivacy"></A> 
</P><P>This module implements Blocking Communication (also known as Privacy Rules)
as defined in section 10 from XMPP IM. If end users have support for it in
their Jabber client, they will be able to:
</P><BLOCKQUOTE CLASS="quote">
<UL CLASS="itemize"><LI CLASS="li-itemize">
Retrieving one&#X2019;s privacy lists.
</LI><LI CLASS="li-itemize">Adding, removing, and editing one&#X2019;s privacy lists.
</LI><LI CLASS="li-itemize">Setting, changing, or declining active lists.
</LI><LI CLASS="li-itemize">Setting, changing, or declining the default list (i.e., the list that
is active by default).
</LI><LI CLASS="li-itemize">Allowing or blocking messages based on JID, group, or subscription type
(or globally).
</LI><LI CLASS="li-itemize">Allowing or blocking inbound presence notifications based on JID, group,
or subscription type (or globally).
</LI><LI CLASS="li-itemize">Allowing or blocking outbound presence notifications based on JID, group,
or subscription type (or globally).
</LI><LI CLASS="li-itemize">Allowing or blocking IQ stanzas based on JID, group, or subscription type
(or globally).
</LI><LI CLASS="li-itemize">Allowing or blocking all communications based on JID, group, or
subscription type (or globally).
</LI></UL>
(from <A HREF="http://www.xmpp.org/specs/rfc3921.html#privacy"><TT>http://www.xmpp.org/specs/rfc3921.html#privacy</TT></A>)
</BLOCKQUOTE><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Blocking Communication (<TT>jabber:iq:privacy</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="modprivate"></A> </P><!--TOC subsection <TT>mod_private</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc46">3.3.12</A>&#XA0;&#XA0;<A HREF="#modprivate"><TT>mod_private</TT></A></H3><!--SEC END --><P> <A NAME="modprivate"></A> 
</P><P>This module adds support for Private XML Storage (<A HREF="http://www.xmpp.org/extensions/xep-0049.html">XEP-0049</A>):
</P><BLOCKQUOTE CLASS="quote">
Using this method, Jabber entities can store private data on the server and
retrieve it whenever necessary. The data stored might be anything, as long as
it is valid XML. One typical usage for this namespace is the server-side storage
of client-specific preferences; another is Bookmark Storage (<A HREF="http://www.xmpp.org/extensions/xep-0048.html">XEP-0048</A>).
</BLOCKQUOTE><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Private XML Storage (<TT>jabber:iq:private</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="modproxy"></A> </P><!--TOC subsection <TT>mod_proxy65</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc47">3.3.13</A>&#XA0;&#XA0;<A HREF="#modproxy"><TT>mod_proxy65</TT></A></H3><!--SEC END --><P> <A NAME="modproxy"></A> 
</P><P>This module implements SOCKS5 Bytestreams (<A HREF="http://www.xmpp.org/extensions/xep-0065.html">XEP-0065</A>).
It allows <TT>ejabberd</TT> to act as a file transfer proxy between two
XMPP clients.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>host</TT></B></DT><DD CLASS="dd-description">This option defines the hostname of the service.
If this option is not set, the prefix &#X2018;<TT>proxy.</TT>&#X2019; is added to <TT>ejabberd</TT>
hostname.
</DD><DT CLASS="dt-description"><B><TT>name</TT></B></DT><DD CLASS="dd-description">Defines Service Discovery name of the service.
Default is <TT>"SOCKS5 Bytestreams"</TT>.
</DD><DT CLASS="dt-description"><B><TT>ip</TT></B></DT><DD CLASS="dd-description">This option specifies which network interface
to listen for. Default is an IP address of the service&#X2019;s DNS name, or,
if fails, <CODE>{127,0,0,1}</CODE>.
</DD><DT CLASS="dt-description"><B><TT>port</TT></B></DT><DD CLASS="dd-description">This option defines port to listen for
incoming connections. Default is&#XA0;7777.
</DD><DT CLASS="dt-description"><B><TT>auth_type</TT></B></DT><DD CLASS="dd-description">SOCKS5 authentication type.
Possible values are <TT>anonymous</TT> and <TT>plain</TT>. Default is
<TT>anonymous</TT>.
</DD><DT CLASS="dt-description"><B><TT>access</TT></B></DT><DD CLASS="dd-description">Defines ACL for file transfer initiators.
Default is <TT>all</TT>.
</DD><DT CLASS="dt-description"><B><TT>max_connections</TT></B></DT><DD CLASS="dd-description">Maximum number of
active connections per file transfer initiator. No limit by default.
</DD><DT CLASS="dt-description"><B><TT>shaper</TT></B></DT><DD CLASS="dd-description">This option defines shaper for
the file transfer peers. Shaper with the maximum bandwidth will be selected.
Default is <TT>none</TT>.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
The simpliest configuration of the module:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_proxy65, []},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">More complicated configuration.
<PRE CLASS="verbatim">{acl, proxy_users, {server, "example.org"}}.
{access, proxy65_access, [{allow, proxy_users}, {deny, all}]}.

{acl, admin, {user, "admin", "example.org"}}.
{shaper, proxyrate, {maxrate, 10240}}. %% 10 Kbytes/sec
{access, proxy65_shaper, [{none, admin}, {proxyrate, proxy_users}]}.

{modules,
 [
  ...
  {mod_proxy65, [{host, "proxy1.example.org"},
                 {name, "File Transfer Proxy"},
                 {ip, {200,150,100,1}},
                 {port, 7778},
                 {max_connections, 5},
                 {access, proxy65_access},
                 {shaper, proxy65_shaper}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modpubsub"></A> </P><!--TOC subsection <TT>mod_pubsub</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc48">3.3.14</A>&#XA0;&#XA0;<A HREF="#modpubsub"><TT>mod_pubsub</TT></A></H3><!--SEC END --><P> <A NAME="modpubsub"></A> 
</P><P>This module offers a Publish-Subscribe Service (<A HREF="http://www.xmpp.org/extensions/xep-0060.html">XEP-0060</A>).
The functionality in <TT>mod_pubsub</TT> can be extended using plugins.
The plugin that implements PEP (Personal Eventing via Pubsub) (<A HREF="http://www.xmpp.org/extensions/xep-0163.html">XEP-0163</A>)
is enabled in the default ejabberd configuration file,
and it requires <TT>mod_caps</TT>.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>pubsub.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD><DT CLASS="dt-description"><B><TT>access_createnode</TT></B></DT><DD CLASS="dd-description"> 
This option restricts which users are allowed to create pubsub nodes using
ACL and ACCESS. The default value is <TT>pubsub_createnode</TT>. </DD><DT CLASS="dt-description"><B><TT>plugins</TT></B></DT><DD CLASS="dd-description"> To specify which pubsub node plugins to use. If not defined, the default
pubsub plugin is always used.
</DD><DT CLASS="dt-description"><B><TT>nodetree</TT></B></DT><DD CLASS="dd-description"> To specify which nodetree to use. If not defined, the default pubsub
nodetree is used. Nodetrees are default and virtual. Only one nodetree can be used
and is shared by all node plugins.
</DD></DL><P>Example:
</P><PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_pubsub, [
                {access_createnode, pubsub_createnode},
                {plugins, ["default", "pep"]}
               ]}
  ...
 ]}.
</PRE><P> <A NAME="modregister"></A> </P><!--TOC subsection <TT>mod_register</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc49">3.3.15</A>&#XA0;&#XA0;<A HREF="#modregister"><TT>mod_register</TT></A></H3><!--SEC END --><P> <A NAME="modregister"></A> 
</P><P>This module adds support for In-Band Registration (<A HREF="http://www.xmpp.org/extensions/xep-0077.html">XEP-0077</A>). This protocol
enables end users to use a Jabber client to:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Register a new account on the server.
</LI><LI CLASS="li-itemize">Change the password from an existing account on the server.
</LI><LI CLASS="li-itemize">Delete an existing account on the server.
</LI></UL><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>access</TT></B></DT><DD CLASS="dd-description"> This option can be configured to specify
rules to restrict registration. If a rule returns &#X2018;deny&#X2019; on the requested
user name, registration for that user name is denied. (there are no
restrictions by default).
</DD><DT CLASS="dt-description"><B><TT>welcome_message</TT></B></DT><DD CLASS="dd-description"> Set a welcome message that
is sent to each newly registered account. The first string is the subject, and
the second string is the message body.
In the body you can set a newline with the characters: <CODE>\n</CODE>
</DD><DT CLASS="dt-description"><B><TT>registration_watchers</TT></B></DT><DD CLASS="dd-description"> This option defines a
list of JIDs which will be notified each time a new account is registered.
</DD><DT CLASS="dt-description"><B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for In-Band Registration (<TT>jabber:iq:register</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P>This module reads also another option defined globably for the server:
<TT>{registration_timeout, Timeout}</TT>. 
This option limits the frequency of registration from a given IP or username.
So, a user can&#X2019;t register a new account from the same IP address or JID during
this number of seconds after previous registration.
Timeout is expressed in seconds, and must be an integer.
To disable this limitation,
instead of an integer put a word like: <TT>infinity</TT>.
Default value: 600 seconds.</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Next example prohibits the registration of too short account names:
<PRE CLASS="verbatim">{acl, shortname, {user_glob, "?"}}.
{acl, shortname, {user_glob, "??"}}.
%% The same using regexp:
%%{acl, shortname, {user_regexp, "^..?$"}}.

{access, register, [{deny, shortname},
                    {allow, all}]}.

{modules,
 [
  ...
  {mod_register, [{access, register}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">The in-band registration of new accounts can be prohibited by changing the
<TT>access</TT> option. If you really want to disable all In-Band Registration
functionality, that is changing passwords in-band and deleting accounts
in-band, you have to remove <TT>mod_register</TT> from the modules list. In this
example all In-Band Registration functionality is disabled:
<PRE CLASS="verbatim">{access, register, [{deny, all}]}.

{modules,
 [
  ...
  %% {mod_register, [{access, register}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">Define the welcome message and two registration watchers.
Also define a registration timeout of one hour:
<PRE CLASS="verbatim">{registration_timeout, 3600}.
{modules,
 [
  ...
  {mod_register,
   [
    {welcome_message, {"Welcome!", "Hi.\nWelcome to this Jabber server.\n Check http://www.jabber.org\n\nBye"}},
    {registration_watchers, ["admin1@example.org", "boss@example.net"]}
   ]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modroster"></A> </P><!--TOC subsection <TT>mod_roster</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc50">3.3.16</A>&#XA0;&#XA0;<A HREF="#modroster"><TT>mod_roster</TT></A></H3><!--SEC END --><P> <A NAME="modroster"></A> 
</P><P>This module implements roster management as defined in <A HREF="http://www.xmpp.org/specs/rfc3921.html#roster">RFC 3921: XMPP IM</A>.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Roster Management (<TT>jabber:iq:roster</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="modservicelog"></A> </P><!--TOC subsection <TT>mod_service_log</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc51">3.3.17</A>&#XA0;&#XA0;<A HREF="#modservicelog"><TT>mod_service_log</TT></A></H3><!--SEC END --><P> <A NAME="modservicelog"></A> 
</P><P>This module adds support for logging end user packets via a Jabber message
auditing service such as
<A HREF="http://www.funkypenguin.info/project/bandersnatch/">Bandersnatch</A>. All user
packets are encapsulated in a <CODE>&lt;route/&gt;</CODE> element and sent to the specified
service(s).</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>loggers</TT></B></DT><DD CLASS="dd-description"> With this option a (list of) service(s)
that will receive the packets can be specified.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
To log all end user packets to the Bandersnatch service running on
<TT>bandersnatch.example.com</TT>:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_service_log, [{loggers, ["bandersnatch.example.com"]}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">To log all end user packets to the Bandersnatch service running on
<TT>bandersnatch.example.com</TT> and the backup service on
<TT>bandersnatch.example.org</TT>:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_service_log, [{loggers, ["bandersnatch.example.com",
                                "bandersnatch.example.org"]}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modsharedroster"></A> </P><!--TOC subsection <TT>mod_shared_roster</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc52">3.3.18</A>&#XA0;&#XA0;<A HREF="#modsharedroster"><TT>mod_shared_roster</TT></A></H3><!--SEC END --><P> <A NAME="modsharedroster"></A> 
</P><P>This module enables you to create shared roster groups. This means that you can
create groups of people that can see members from (other) groups in their
rosters. The big advantages of this feature are that end users do not need to
manually add all users to their rosters, and that they cannot permanently delete
users from the shared roster groups.
A shared roster group can have members from any Jabber server,
but the presence will only be available from and to members
of the same virtual host where the group is created.</P><P>Shared roster groups can be edited <EM>only</EM> via the Web Admin. Each group
has a unique identification and the following parameters:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B>Name</B></DT><DD CLASS="dd-description"> The name of the group, which will be displayed in the roster.
</DD><DT CLASS="dt-description"><B>Description</B></DT><DD CLASS="dd-description"> The description of the group. This parameter does not affect
anything.
</DD><DT CLASS="dt-description"><B>Members</B></DT><DD CLASS="dd-description"> A list of full JIDs of group members, entered one per line in
the Web Admin.
To put as members all the registered users in the virtual hosts,
you can use the special directive: @all@.
Note that this directive is designed for a small server with just a few hundred users.
</DD><DT CLASS="dt-description"><B>Displayed groups</B></DT><DD CLASS="dd-description"> A list of groups that will be in the rosters of this
group&#X2019;s members.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Take the case of a computer club that wants all its members seeing each
other in their rosters. To achieve this, they need to create a shared roster
group similar to next table:
<BLOCKQUOTE CLASS="table"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=left NOWRAP>Identification</TD><TD ALIGN=left NOWRAP>Group &#X2018;<TT>club_members</TT>&#X2019;</TD></TR>
<TR><TD ALIGN=left NOWRAP>Name</TD><TD ALIGN=left NOWRAP>Club Members</TD></TR>
<TR><TD ALIGN=left NOWRAP>Description</TD><TD ALIGN=left NOWRAP>Members from the computer club</TD></TR>
<TR><TD ALIGN=left NOWRAP>Members</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>member1@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>member2@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>member3@example.org</TT></TD></TR>
</TABLE></TD></TR>
<TR><TD ALIGN=left NOWRAP>Displayed groups</TD><TD ALIGN=left NOWRAP><TT>club_members</TT></TD></TR>
</TABLE>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
</LI><LI CLASS="li-itemize">In another case we have a company which has three divisions: Management,
Marketing and Sales. All group members should see all other members in their
rosters. Additionally, all managers should have all marketing and sales people
in their roster. Simultaneously, all marketeers and the whole sales team
should see all managers. This scenario can be achieved by creating shared
roster groups as shown in the following table:
<BLOCKQUOTE CLASS="table"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=left NOWRAP>Identification</TD><TD ALIGN=left NOWRAP> Group &#X2018;<TT>management</TT>&#X2019;</TD><TD ALIGN=left NOWRAP> Group &#X2018;<TT>marketing</TT>&#X2019;</TD><TD ALIGN=left NOWRAP> Group &#X2018;<TT>sales</TT>&#X2019;</TD></TR>
<TR><TD ALIGN=left NOWRAP>Name</TD><TD ALIGN=left NOWRAP>Management</TD><TD ALIGN=left NOWRAP>Marketing</TD><TD ALIGN=left NOWRAP>Sales</TD></TR>
<TR><TD ALIGN=left NOWRAP>Description</TD><TD ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=left NOWRAP> Members</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>manager1@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>manager2@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>manager3@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>manager4@example.org</TT></TD></TR>
</TABLE>
</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>marketeer1@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>marketeer2@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>marketeer3@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>marketeer4@example.org</TT></TD></TR>
</TABLE>
</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>saleswoman1@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>salesman1@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>saleswoman2@example.org</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>salesman2@example.org</TT></TD></TR>
</TABLE></TD></TR>
<TR><TD ALIGN=left NOWRAP>Displayed groups</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>management</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>marketing</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>sales</TT></TD></TR>
</TABLE>
</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>management</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>marketing</TT></TD></TR>
</TABLE>
</TD><TD ALIGN=left NOWRAP> <TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP> <TT>management</TT></TD></TR>
<TR><TD ALIGN=left NOWRAP> <TT>sales</TT></TD></TR>
</TABLE></TD></TR>
</TABLE>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
</LI></UL><P> <A NAME="modstats"></A> </P><!--TOC subsection <TT>mod_stats</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc53">3.3.19</A>&#XA0;&#XA0;<A HREF="#modstats"><TT>mod_stats</TT></A></H3><!--SEC END --><P> <A NAME="modstats"></A> 
</P><P>This module adds support for Statistics Gathering (<A HREF="http://www.xmpp.org/extensions/xep-0039.html">XEP-0039</A>). This protocol
allows you to retrieve next statistics from your <TT>ejabberd</TT> deployment:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Total number of registered users on the current virtual host (users/total).
</LI><LI CLASS="li-itemize">Total number of registered users on all virtual hosts (users/all-hosts/total).
</LI><LI CLASS="li-itemize">Total number of online users on the current virtual host (users/online).
</LI><LI CLASS="li-itemize">Total number of online users on all virtual hosts (users/all-hosts/online).
</LI></UL><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Statistics Gathering (<TT>http://jabber.org/protocol/stats</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P>As there are only a small amount of clients (for example
<A HREF="http://tkabber.jabber.ru/">Tkabber</A>) and software libraries with
support for this XEP, a few examples are given of the XML you need to send
in order to get the statistics. Here they are:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
You can request the number of online users on the current virtual host
(<TT>example.org</TT>) by sending:
<PRE CLASS="verbatim">&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/online'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</PRE></LI><LI CLASS="li-itemize">You can request the total number of registered users on all virtual hosts
by sending:
<PRE CLASS="verbatim">&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/all-hosts/total'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</PRE></LI></UL><P> <A NAME="modtime"></A> </P><!--TOC subsection <TT>mod_time</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc54">3.3.20</A>&#XA0;&#XA0;<A HREF="#modtime"><TT>mod_time</TT></A></H3><!--SEC END --><P> <A NAME="modtime"></A> 
</P><P>This module features support for Entity Time (<A HREF="http://www.xmpp.org/extensions/xep-0090.html">XEP-0090</A>). By using this XEP,
you are able to discover the time at another entity&#X2019;s location.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Entity Time (<TT>jabber:iq:time</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="modvcard"></A> </P><!--TOC subsection <TT>mod_vcard</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc55">3.3.21</A>&#XA0;&#XA0;<A HREF="#modvcard"><TT>mod_vcard</TT></A></H3><!--SEC END --><P> <A NAME="modvcard"></A> 
</P><P>This module allows end users to store and retrieve their vCard, and to retrieve
other users vCards, as defined in vcard-temp (<A HREF="http://www.xmpp.org/extensions/xep-0054.html">XEP-0054</A>). The module also
implements an uncomplicated Jabber User Directory based on the vCards of
these users. Moreover, it enables the server to send its vCard when queried.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>vjud.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD><DT CLASS="dt-description"><B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for <TT>vcard-temp</TT> IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD><DT CLASS="dt-description"><B><TT>search</TT></B></DT><DD CLASS="dd-description">This option specifies whether the search
functionality is enabled (value: <TT>true</TT>) or disabled (value:
<TT>false</TT>). If disabled, the option <TT>host</TT> will be ignored and the
Jabber User Directory service will not appear in the Service Discovery item
list. The default value is <TT>true</TT>.
</DD><DT CLASS="dt-description"><B><TT>matches</TT></B></DT><DD CLASS="dd-description">With this option, the number of reported
search results can be limited. If the option&#X2019;s value is set to <TT>infinity</TT>,
all search results are reported. The default value is <TT>30</TT>.
</DD><DT CLASS="dt-description"><B><TT>allow_return_all</TT></B></DT><DD CLASS="dd-description">This option enables
you to specify if search operations with empty input fields should return all
users who added some information to their vCard. The default value is
<TT>false</TT>.
</DD><DT CLASS="dt-description"><B><TT>search_all_hosts</TT></B></DT><DD CLASS="dd-description">If this option is set
to <TT>true</TT>, search operations will apply to all virtual hosts. Otherwise
only the current host will be searched. The default value is <TT>true</TT>.
This option is available in <TT>mod_vcard</TT>, but not available in <TT>mod_vcard_odbc</TT>.
</DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
In this first situation, search results are limited to twenty items,
every user who added information to their vCard will be listed when people
do an empty search, and only users from the current host will be returned:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_vcard, [{search, true},
               {matches, 20},
               {allow_return_all, true},
               {search_all_hosts, false}]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">The second situation differs in a way that search results are not limited,
and that all virtual hosts will be searched instead of only the current one:
<PRE CLASS="verbatim">{modules,
 [
  ...
  {mod_vcard, [{search, true},
               {matches, infinity},
               {allow_return_all, true}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="modvcardldap"></A> </P><!--TOC subsection <TT>mod_vcard_ldap</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc56">3.3.22</A>&#XA0;&#XA0;<A HREF="#modvcardldap"><TT>mod_vcard_ldap</TT></A></H3><!--SEC END --><P> <A NAME="modvcardldap"></A> 
</P><P><TT>ejabberd</TT> can map LDAP attributes to vCard fields. This behaviour is
implemented in the <TT>mod_vcard_ldap</TT> module. This module does not depend on the
authentication method (see&#XA0;<A HREF="#ldapauth">3.2.5</A>).</P><P>Note that <TT>ejabberd</TT> treats LDAP as a read-only storage:
it is possible to consult data, but not possible to
create accounts, change password or edit vCard that is stored in LDAP.</P><P>The <TT>mod_vcard_ldap</TT> module has
its own optional parameters. The first group of parameters has the same
meaning as the top-level LDAP parameters to set the authentication method:
<TT>ldap_servers</TT>, <TT>ldap_port</TT>, <TT>ldap_rootdn</TT>,
<TT>ldap_password</TT>, <TT>ldap_base</TT>, <TT>ldap_uids</TT>, and
<TT>ldap_filter</TT>. See section&#XA0;<A HREF="#ldapauth">3.2.5</A> for detailed information
about these options. If one of these options is not set, <TT>ejabberd</TT> will look
for the top-level option with the same name.</P><P>The second group of parameters
consists of the following <TT>mod_vcard_ldap</TT>-specific options:</P><DL CLASS="description"><DT CLASS="dt-description">

<B><TT>host</TT></B></DT><DD CLASS="dd-description">  This option defines the Jabber ID of the
service. If the <TT>host</TT> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<TT>vjud.</TT>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</DD><DT CLASS="dt-description"><B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for <TT>vcard-temp</TT> IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD><DT CLASS="dt-description"><B><TT>search</TT></B></DT><DD CLASS="dd-description">This option specifies whether the search
functionality is enabled (value: <TT>true</TT>) or disabled (value:
<TT>false</TT>). If disabled, the option <TT>host</TT> will be ignored and the
Jabber User Directory service will not appear in the Service Discovery item
list. The default value is <TT>true</TT>.
</DD><DT CLASS="dt-description"><B><TT>matches</TT></B></DT><DD CLASS="dd-description">With this option, the number of reported
search results can be limited. If the option&#X2019;s value is set to <TT>infinity</TT>,
all search results are reported. The default value is <TT>30</TT>.
</DD><DT CLASS="dt-description"><B><TT>ldap_vcard_map</TT></B></DT><DD CLASS="dd-description">With this option you can
set the table that maps LDAP attributes to vCard fields. The format is:
<TT>[</TT><TT>Name_of_vCard_field, Pattern, List_of_LDAP_attributes</TT><TT>, ...]</TT>.
<TT>Name_of_vcard_field</TT> is the type name of the vCard as defined in
<A HREF="http://www.ietf.org/rfc/rfc2426.txt">RFC 2426</A>. <TT>Pattern</TT> is a
string which contains pattern variables <TT>"%u"</TT>, <TT>"%d"</TT> or
<TT>"%s"</TT>. <TT>List_of_LDAP_attributes</TT> is the list containing LDAP
attributes. The pattern variables <TT>"%s"</TT> will be sequentially replaced
with the values of LDAP attributes from <TT>List_of_LDAP_attributes</TT>,
<TT>"%u"</TT> will be replaced with the user part of a JID, and <TT>"%d"</TT>
will be replaced with the domain part of a JID. The default is:
<PRE CLASS="verbatim">[{"NICKNAME", "%u", []},
 {"FN", "%s", ["displayName"]},
 {"LAST", "%s", ["sn"]},
 {"FIRST", "%s", ["givenName"]},
 {"MIDDLE", "%s", ["initials"]},
 {"ORGNAME", "%s", ["o"]},
 {"ORGUNIT", "%s", ["ou"]},
 {"CTRY", "%s", ["c"]},
 {"LOCALITY", "%s", ["l"]},
 {"STREET", "%s", ["street"]},
 {"REGION", "%s", ["st"]},
 {"PCODE", "%s", ["postalCode"]},
 {"TITLE", "%s", ["title"]},
 {"URL", "%s", ["labeleduri"]},
 {"DESC", "%s", ["description"]},
 {"TEL", "%s", ["telephoneNumber"]},
 {"EMAIL", "%s", ["mail"]},
 {"BDAY", "%s", ["birthDay"]},
 {"ROLE", "%s", ["employeeType"]},
 {"PHOTO", "%s", ["jpegPhoto"]}]
</PRE></DD><DT CLASS="dt-description"><B><TT>ldap_search_fields</TT></B></DT><DD CLASS="dd-description">This option
defines the search form and the LDAP attributes to search within. The format
is: <TT>[</TT><TT>Name, Attribute</TT><TT>, ...]</TT>. <TT>Name</TT> is the name of a search form
field which will be automatically translated by using the translation
files (see <TT>msgs/*.msg</TT> for available words). <TT>Attribute</TT> is the
LDAP attribute or the pattern <TT>"%u"</TT>. The default is:
<PRE CLASS="verbatim">[{"User", "%u"},
 {"Full Name", "displayName"},
 {"Given Name", "givenName"},
 {"Middle Name", "initials"},
 {"Family Name", "sn"},
 {"Nickname", "%u"},
 {"Birthday", "birthDay"},
 {"Country", "c"},
 {"City", "l"},
 {"Email", "mail"},
 {"Organization Name", "o"},
 {"Organization Unit", "ou"}]
</PRE></DD><DT CLASS="dt-description"><B><TT>ldap_search_reported</TT></B></DT><DD CLASS="dd-description">This option
defines which search fields should be reported. The format is:
<TT>[</TT><TT>Name, vCard_Name</TT><TT>, ...]</TT>. <TT>Name</TT> is the name of a search form
field which will be automatically translated by using the translation
files (see <TT>msgs/*.msg</TT> for available words). <TT>vCard_Name</TT> is the
vCard field name defined in the <TT>ldap_vcard_map</TT> option. The default
is:
<PRE CLASS="verbatim">[{"Full Name", "FN"},
 {"Given Name", "FIRST"},
 {"Middle Name", "MIDDLE"},
 {"Family Name", "LAST"},
 {"Nickname", "NICKNAME"},
 {"Birthday", "BDAY"},
 {"Country", "CTRY"},
 {"City", "LOCALITY"},
 {"Email", "EMAIL"},
 {"Organization Name", "ORGNAME"},
 {"Organization Unit", "ORGUNIT"}]
</PRE></DD></DL><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<P>Let&#X2019;s say <TT>ldap.example.org</TT> is the name of our LDAP server. We have
users with their passwords in <TT>"ou=Users,dc=example,dc=org"</TT> directory.
Also we have addressbook, which contains users emails and their additional
infos in <TT>"ou=AddressBook,dc=example,dc=org"</TT> directory. Corresponding
authentication section should looks like this:</P><PRE CLASS="verbatim">%% authentication method
{auth_method, ldap}.
%% DNS name of our LDAP server
{ldap_servers, ["ldap.example.org"]}.
%% We want to authorize users from 'shadowAccount' object class only
{ldap_filter, "(objectClass=shadowAccount)"}.
</PRE><P>Now we want to use users LDAP-info as their vCards. We have four attributes
defined in our LDAP schema: <TT>"mail"</TT> &#X2014; email address, <TT>"givenName"</TT>
&#X2014; first name, <TT>"sn"</TT> &#X2014; second name, <TT>"birthDay"</TT> &#X2014; birthday.
Also we want users to search each other. Let&#X2019;s see how we can set it up:</P><PRE CLASS="verbatim">{modules,
  ...
  {mod_vcard_ldap,
   [
    %% We use the same server and port, but want to bind anonymously because
    %% our LDAP server accepts anonymous requests to
    %% "ou=AddressBook,dc=example,dc=org" subtree.
    {ldap_rootdn, ""},
    {ldap_password, ""},
    %% define the addressbook's base
    {ldap_base, "ou=AddressBook,dc=example,dc=org"},
    %% uidattr: user's part of JID is located in the "mail" attribute
    %% uidattr_format: common format for our emails
    {ldap_uids, [{"mail","%u@mail.example.org"}]},
    %% We have to define empty filter here, because entries in addressbook does not
    %% belong to shadowAccount object class
    {ldap_filter, ""},
    %% Now we want to define vCard pattern
    {ldap_vcard_map,
     [{"NICKNAME", "%u", []}, % just use user's part of JID as his nickname
      {"FIRST", "%s", ["givenName"]},
      {"LAST", "%s", ["sn"]},
      {"FN", "%s, %s", ["sn", "givenName"]}, % example: "Smith, John"
      {"EMAIL", "%s", ["mail"]},
      {"BDAY", "%s", ["birthDay"]}]},
    %% Search form
    {ldap_search_fields,
     [{"User", "%u"},
      {"Name", "givenName"},
      {"Family Name", "sn"},
      {"Email", "mail"},
      {"Birthday", "birthDay"}]},
    %% vCard fields to be reported
    %% Note that JID is always returned with search results
    {ldap_search_reported,
     [{"Full Name", "FN"},
      {"Nickname", "NICKNAME"},
      {"Birthday", "BDAY"}]}
  ]}
  ...
}.
</PRE><P>Note that <TT>mod_vcard_ldap</TT> module checks an existence of the user before
searching his info in LDAP.</P></LI><LI CLASS="li-itemize"><TT>ldap_vcard_map</TT> example:
<PRE CLASS="verbatim">{ldap_vcard_map,
 [{"NICKNAME", "%u", []},
  {"FN", "%s", ["displayName"]},
  {"CTRY", "Russia", []},
  {"EMAIL", "%u@%d", []},
  {"DESC", "%s\n%s", ["title", "description"]}
 ]},
</PRE></LI><LI CLASS="li-itemize"><TT>ldap_search_fields</TT> example:
<PRE CLASS="verbatim">{ldap_search_fields,
 [{"User", "uid"},
  {"Full Name", "displayName"},
  {"Email", "mail"}
 ]},
</PRE></LI><LI CLASS="li-itemize"><TT>ldap_search_reported</TT> example:
<PRE CLASS="verbatim">{ldap_search_reported,
 [{"Full Name", "FN"},
  {"Email", "EMAIL"},
  {"Birthday", "BDAY"},
  {"Nickname", "NICKNAME"}
 ]},
</PRE></LI></UL><P> <A NAME="modversion"></A> </P><!--TOC subsection <TT>mod_version</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc57">3.3.23</A>&#XA0;&#XA0;<A HREF="#modversion"><TT>mod_version</TT></A></H3><!--SEC END --><P> <A NAME="modversion"></A> 
</P><P>This module implements Software Version (<A HREF="http://www.xmpp.org/extensions/xep-0092.html">XEP-0092</A>). Consequently, it
answers <TT>ejabberd</TT>&#X2019;s version when queried.</P><P>Options:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>show_os</TT></B></DT><DD CLASS="dd-description">Should the operating system be revealed or not.
The default value is <TT>true</TT>.
</DD><DT CLASS="dt-description"><B><TT>iqdisc</TT></B></DT><DD CLASS="dd-description"> This specifies
the processing discipline for Software Version (<TT>jabber:iq:version</TT>) IQ queries (see section&#XA0;<A HREF="#modiqdiscoption">3.3.2</A>).
</DD></DL><P> <A NAME="manage"></A> </P><!--TOC chapter Managing an <TT>ejabberd</TT> server-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc58">Chapter&#XA0;4</A>&#XA0;&#XA0;<A HREF="#manage">Managing an <TT>ejabberd</TT> server</A></H1><!--SEC END --><P> <A NAME="manage"></A> </P><P> <A NAME="ejabberdctl"></A> </P><!--TOC section <TT>ejabberdctl</TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc59">4.1</A>&#XA0;&#XA0;<A HREF="#ejabberdctl"><TT>ejabberdctl</TT></A></H2><!--SEC END --><P> <A NAME="ejabberdctl"></A> </P><P> <A NAME="commands"></A> </P><!--TOC subsection Commands-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc60">4.1.1</A>&#XA0;&#XA0;<A HREF="#commands">Commands</A></H3><!--SEC END --><P> <A NAME="commands"></A> </P><P>The <TT>ejabberdctl</TT> command line administration script allows to start, stop and perform
many other administrative tasks in a local or remote <TT>ejabberd</TT> server.</P><P>When <TT>ejabberdctl</TT> is executed without any parameter,
it displays the available options. If there isn&#X2019;t an <TT>ejabberd</TT> server running,
the available parameters are:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>start</TT></B></DT><DD CLASS="dd-description"> Start <TT>ejabberd</TT> in background mode. This is the default method.
</DD><DT CLASS="dt-description"><B><TT>debug</TT></B></DT><DD CLASS="dd-description"> Attach an Erlang shell to an already existing <TT>ejabberd</TT> server. This allows to execute commands interactively in the <TT>ejabberd</TT> server.
</DD><DT CLASS="dt-description"><B><TT>live</TT></B></DT><DD CLASS="dd-description"> Start <TT>ejabberd</TT> in live mode: the shell keeps attached to the started server, showing log messages and allowing to execute interactive commands.
</DD></DL><P>If there is an <TT>ejabberd</TT> server running in the system,
<TT>ejabberdctl</TT> shows all the available commands in that server.
The more interesting ones are:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>status</TT></B></DT><DD CLASS="dd-description"> Check the status of the <TT>ejabberd</TT> server.
</DD><DT CLASS="dt-description"><B><TT>stop</TT></B></DT><DD CLASS="dd-description"> Stop the <TT>ejabberd</TT> server which is running in the machine.
</DD><DT CLASS="dt-description"><B><TT>reopen-log</TT></B></DT><DD CLASS="dd-description"> If you use a tool to rotate logs, you have to configure it
so that this command is executed after each rotation.
</DD><DT CLASS="dt-description"><B><TT>backup, restore, install-fallback, dump, load</TT></B></DT><DD CLASS="dd-description"> You can use these
commands to create and restore backups.
</DD><DT CLASS="dt-description"><B><TT>import-file, import-dir</TT></B></DT><DD CLASS="dd-description"> 
These options can be used to migrate from other Jabber/XMPP servers. There
exist tutorials to <A HREF="http://www.ejabberd.im/migrate-to-ejabberd">migrate from other software to ejabberd</A>.
</DD><DT CLASS="dt-description"><B><TT>delete-expired-messages</TT></B></DT><DD CLASS="dd-description"> This option can be used to delete old messages
in offline storage. This might be useful when the number of offline messages
is very high.
</DD></DL><P>The <TT>ejabberdctl</TT> script also allows the argument <TT>--node NODENAME</TT>.
This allows to administer a remote node.</P><P>The <TT>ejabberdctl</TT> script can be configured in the file <TT>ejabberdctl.cfg</TT>.
This file includes detailed information about each configurable option.</P><P>The <TT>ejabberdctl</TT> script returns a numerical status code.
Success is represented by <TT>0</TT>,
error is represented by <TT>1</TT>,
and other codes may be used for specifical results.
This can be used by other scripts to determine automatically
if a command succedded or failed,
for example using: <TT>echo $?</TT></P><P> <A NAME="erlangconfiguration"></A> </P><!--TOC subsection Erlang runtime system-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc61">4.1.2</A>&#XA0;&#XA0;<A HREF="#erlangconfiguration">Erlang runtime system</A></H3><!--SEC END --><P> <A NAME="erlangconfiguration"></A> </P><P><TT>ejabberd</TT> is an Erlang/OTP application that runs inside an Erlang runtime system.
This system is configured using environment variables and command line parameters.
The <TT>ejabberdctl</TT> administration script uses many of those possibilities.
You can configure some of them with the file <TT>ejabberdctl.cfg</TT>,
which includes detailed description about them.
This section describes for reference purposes
all the environment variables and command line parameters.</P><P>The environment variables:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>EJABBERD_CONFIG_PATH</TT></B></DT><DD CLASS="dd-description">
	Path to the ejabberd configuration file.
</DD><DT CLASS="dt-description"><B><TT>EJABBERD_MSGS_PATH</TT></B></DT><DD CLASS="dd-description">
	Path to the directory with translated strings.
</DD><DT CLASS="dt-description"><B><TT>EJABBERD_LOG_PATH</TT></B></DT><DD CLASS="dd-description">
	Path to the ejabberd service log file.
</DD><DT CLASS="dt-description"><B><TT>EJABBERD_SO_PATH</TT></B></DT><DD CLASS="dd-description">
	Path to the directory with binary system libraries.
</DD><DT CLASS="dt-description"><B><TT>HOME</TT></B></DT><DD CLASS="dd-description">
	Path to the directory that is considered <TT>ejabberd</TT>&#X2019;s home.
	This path is used to read the file <TT>.erlang.cookie</TT>.
</DD><DT CLASS="dt-description"><B><TT>ERL_CRASH_DUMP</TT></B></DT><DD CLASS="dd-description">
	Path to the file where crash reports will be dumped.
</DD><DT CLASS="dt-description"><B><TT>ERL_INETRC</TT></B></DT><DD CLASS="dd-description">
	Indicates which IP name resolution to use. It is required if using <TT>-sname</TT>.
</DD><DT CLASS="dt-description"><B><TT>ERL_MAX_PORTS</TT></B></DT><DD CLASS="dd-description">
	Maximum number of simultaneously open Erlang ports.
</DD><DT CLASS="dt-description"><B><TT>ERL_MAX_ETS_TABLES</TT></B></DT><DD CLASS="dd-description">
	Maximum number of ETS and Mnesia tables.
</DD></DL><P>The command line parameters:
</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>-sname ejabberd</TT></B></DT><DD CLASS="dd-description">
	The Erlang node will be identified using only the first part
	of the host name, i.&#XA0;e. other Erlang nodes outside this domain cannot contact
	this node. This is the preferable option in most cases.
</DD><DT CLASS="dt-description"><B><TT>-name ejabberd</TT></B></DT><DD CLASS="dd-description">
	The Erlang node will be fully identified.
This is only useful if you plan to setup an <TT>ejabberd</TT> cluster with nodes in different networks.
</DD><DT CLASS="dt-description"><B><TT>-kernel inetrc "/etc/ejabberd/inetrc"</TT></B></DT><DD CLASS="dd-description">
	Indicates which IP name resolution to use. It is required if using <TT>-sname</TT>.
</DD><DT CLASS="dt-description"><B><TT>-detached</TT></B></DT><DD CLASS="dd-description">
Starts the Erlang system detached from the system console.
	Useful for running daemons and backgrounds processes.
</DD><DT CLASS="dt-description"><B><TT>-noinput</TT></B></DT><DD CLASS="dd-description">
	Ensures that the Erlang system never tries to read any input.
	Useful for running daemons and backgrounds processes.
</DD><DT CLASS="dt-description"><B><TT>-pa /var/lib/ejabberd/ebin</TT></B></DT><DD CLASS="dd-description">
	Specify the directory where Erlang binary files (*.beam) are located.
</DD><DT CLASS="dt-description"><B><TT>-s ejabberd</TT></B></DT><DD CLASS="dd-description">
	Tell Erlang runtime system to start the <TT>ejabberd</TT> application.
</DD><DT CLASS="dt-description"><B><TT>-mnesia dir "/var/lib/ejabberd/db/nodename"</TT></B></DT><DD CLASS="dd-description">
	Specify the Mnesia database directory.
</DD><DT CLASS="dt-description"><B><TT>-sasl sasl_error_logger {file, "/var/log/ejabberd/sasl.log"}</TT></B></DT><DD CLASS="dd-description">
	Path to the Erlang/OTP system log file.
</DD><DT CLASS="dt-description"><B><TT>+K [true|false]</TT></B></DT><DD CLASS="dd-description">
	Kernel polling.
</DD><DT CLASS="dt-description"><B><TT>-smp [auto|enable|disable]</TT></B></DT><DD CLASS="dd-description">
	SMP support.
</DD><DT CLASS="dt-description"><B><TT>+P 250000</TT></B></DT><DD CLASS="dd-description">
	Maximum number of Erlang processes.
</DD><DT CLASS="dt-description"><B><TT>-remsh ejabberd@localhost</TT></B></DT><DD CLASS="dd-description">
	Open an Erlang shell in a remote Erlang node.
</DD></DL><P>
Note that some characters need to be escaped when used in shell scripts, for instance <CODE>"</CODE> and <CODE>{}</CODE>.
You can find other options in the Erlang manual page (<TT>erl -man erl</TT>).</P><P> <A NAME="webadmin"></A> </P><!--TOC section Web Admin-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc62">4.2</A>&#XA0;&#XA0;<A HREF="#webadmin">Web Admin</A></H2><!--SEC END --><P> <A NAME="webadmin"></A> 
</P><P>The <TT>ejabberd</TT> Web Admin allows to administer most of <TT>ejabberd</TT> using a web browser.</P><P>This feature is enabled by default:
a <TT>ejabberd_http</TT> listener with the option <TT>web_admin</TT> (see
section&#XA0;<A HREF="#listened">3.1.3</A>) is included in the listening ports. Then you can open
<CODE>http://server:port/admin/</CODE> in your favourite web browser. You
will be asked to enter the username (the <EM>full</EM> Jabber ID) and password
of an <TT>ejabberd</TT> user with administrator rights. After authentication
you will see a page similar to figure&#XA0;<A HREF="#fig:webadmmain">4.1</A>.</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>

<IMG SRC="webadmmain.png" ALT="webadmmain.png">


<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 4.1: Top page from the Web Admin</TD></TR>
</TABLE></DIV>
<A NAME="fig:webadmmain"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE><P>
Here you can edit access restrictions, manage users, create backups,
manage the database, enable/disable ports listened for, view server
statistics,&#X2026;</P><P>Examples:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
You can serve the Web Admin on the same port as the
HTTP Polling interface. In this example
you should point your web browser to <CODE>http://example.org:5280/admin/</CODE> to
administer all virtual hosts or to
<CODE>http://example.org:5280/admin/server/example.com/</CODE> to administer only
the virtual host <TT>example.com</TT>. Before you get access to the Web Admin
you need to enter as username, the JID and password from a registered user
that is allowed to configure <TT>ejabberd</TT>. In this example you can enter as
username &#X2018;<TT>admin@example.net</TT>&#X2019; to administer all virtual hosts (first
URL). If you log in with &#X2018;<TT>admin@example.com</TT>&#X2019; on<BR>
 <CODE>http://example.org:5280/admin/server/example.com/</CODE> you can only
administer the virtual host <TT>example.com</TT>.
<PRE CLASS="verbatim">{acl, admins, {user, "admin", "example.net"}}.
{host_config, "example.com", [{acl, admins, {user, "admin", "example.com"}}]}.
{access, configure, [{allow, admins}]}.

{hosts, ["example.org"]}.

{listen,
 [
  ...
  {5280, ejabberd_http, [http_poll, web_admin]},
  ...
 ]}.
</PRE></LI><LI CLASS="li-itemize">For security reasons, you can serve the Web Admin on a secured
connection, on a port differing from the HTTP Polling interface, and bind it
to the internal LAN IP. The Web Admin will be accessible by pointing your
web browser to <CODE>https://192.168.1.1:5280/admin/</CODE>:
<PRE CLASS="verbatim">
{hosts, ["example.org"]}.

{listen,
 [
  ...
  {5270, ejabberd_http,    [http_poll]},
  {5280, ejabberd_http,    [web_admin, {ip, {192, 168, 1, 1}},
                            tls, {certfile, "/usr/local/etc/server.pem"}]},
  ...
 ]}.
</PRE></LI></UL><P> <A NAME="adhoccommands"></A> </P><!--TOC section Ad-hoc Commands-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc63">4.3</A>&#XA0;&#XA0;<A HREF="#adhoccommands">Ad-hoc Commands</A></H2><!--SEC END --><P> <A NAME="adhoccommands"></A> </P><P>If you enable <TT>mod_configure</TT> and <TT>mod_adhoc</TT>,
you can perform several administrative tasks in <TT>ejabberd</TT>
with a Jabber client.
The client must support Ad-Hoc Commands (<A HREF="http://www.xmpp.org/extensions/xep-0050.html">XEP-0050</A>),
and you must login in the Jabber server with
an account with proper privileges.</P><P> <A NAME="changeerlangnodename"></A> </P><!--TOC section Change Computer Hostname-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc64">4.4</A>&#XA0;&#XA0;<A HREF="#changeerlangnodename">Change Computer Hostname</A></H2><!--SEC END --><P> <A NAME="changeerlangnodename"></A> </P><P><TT>ejabberd</TT> uses the distributed Mnesia database.
Being distributed, Mnesia enforces consistency of its file,
so it stores the name of the Erlang node in it (see section <A HREF="#nodename">5.4</A>).
The name of an Erlang node includes the hostname of the computer.
So, the name of the Erlang node changes
if you change the name of the machine in which <TT>ejabberd</TT> runs,
or when you move <TT>ejabberd</TT> to a different machine.</P><P>So, if you want to change the computer hostname where <TT>ejabberd</TT> is installed,
you must follow these instructions:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
	In the old server, backup the Mnesia database using the Web Admin or <TT>ejabberdctl</TT>.
	For example:
<PRE CLASS="verbatim">ejabberdctl backup /tmp/ejabberd-oldhost.backup
</PRE>	</LI><LI CLASS="li-enumerate">In the new server, restore the backup file using the Web Admin or <TT>ejabberdctl</TT>.
	For example:
<PRE CLASS="verbatim">ejabberdctl restore /tmp/ejabberd-oldhost.backup
</PRE></LI></OL><P> <A NAME="secure"></A> </P><!--TOC chapter Securing <TT>ejabberd</TT>-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc65">Chapter&#XA0;5</A>&#XA0;&#XA0;<A HREF="#secure">Securing <TT>ejabberd</TT></A></H1><!--SEC END --><P> <A NAME="secure"></A> </P><P> <A NAME="firewall"></A> </P><!--TOC section Firewall Settings-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc66">5.1</A>&#XA0;&#XA0;<A HREF="#firewall">Firewall Settings</A></H2><!--SEC END --><P> <A NAME="firewall"></A> 
</P><P>You need to take the following TCP ports in mind when configuring your firewall:
</P><BLOCKQUOTE CLASS="table"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=left NOWRAP><B>Port</B></TD><TD ALIGN=left NOWRAP><B>Description</B></TD></TR>
<TR><TD ALIGN=left NOWRAP>5222</TD><TD ALIGN=left NOWRAP>Standard port for Jabber/XMPP client connections, plain or STARTTLS.</TD></TR>
<TR><TD ALIGN=left NOWRAP>5223</TD><TD ALIGN=left NOWRAP>Standard port for Jabber client connections using the old SSL method.</TD></TR>
<TR><TD ALIGN=left NOWRAP>5269</TD><TD ALIGN=left NOWRAP>Standard port for Jabber/XMPP server connections.</TD></TR>
<TR><TD ALIGN=left NOWRAP>4369</TD><TD ALIGN=left NOWRAP>Port used by EPMD for communication between Erlang nodes.</TD></TR>
<TR><TD ALIGN=left NOWRAP>port range</TD><TD ALIGN=left NOWRAP>Used for connections between Erlang nodes. This range is configurable.</TD></TR>
</TABLE>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE><P> <A NAME="epmd"></A> </P><!--TOC section epmd-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc67">5.2</A>&#XA0;&#XA0;<A HREF="#epmd">epmd</A></H2><!--SEC END --><P> <A NAME="epmd"></A> </P><P><A HREF="http://www.erlang.org/doc/man/epmd.html">epmd (Erlang Port Mapper Daemon)</A>
is a small name server included in Erlang/OTP
and used by Erlang programs when establishing distributed Erlang communications.
<TT>ejabberd</TT> needs <TT>epmd</TT> to use <TT>ejabberdctl</TT> and also when clustering <TT>ejabberd</TT> nodes.
This small program is automatically started by Erlang, and is never stopped.
If <TT>ejabberd</TT> is stopped, and there aren&#X2019;t any other Erlang programs
running in the system, you can safely stop <TT>epmd</TT> if you want.</P><P><TT>ejabberd</TT> runs inside an Erlang node.
To communicate with <TT>ejabberd</TT>, the script <TT>ejabberdctl</TT> starts a new Erlang node
and connects to the Erlang node that holds <TT>ejabberd</TT>.
In order for this communication to work,
<TT>epmd</TT> must be running and listening for name requests in the port 4369.
You should block the port 4369 in the firewall,
so only the programs in your machine can access it.</P><P>If you build a cluster of several <TT>ejabberd</TT> instances,
each <TT>ejabberd</TT> instance is called an <TT>ejabberd</TT> node.
Those <TT>ejabberd</TT> nodes use a special Erlang communication method to
build the cluster, and EPMD is again needed listening in the port 4369.
So, if you plan to build a cluster of <TT>ejabberd</TT> nodes
you must open the port 4369 for the machines involved in the cluster.
Remember to block the port so Internet doesn&#X2019;t have access to it.</P><P>Once an Erlang node solved the node name of another Erlang node using EPMD and port 4369,
the nodes communicate directly.
The ports used in this case are random.
You can limit the range of ports when starting Erlang with a command-line parameter, for example:
</P><PRE CLASS="verbatim">erl ... -kernel inet_dist_listen_min 4370 inet_dist_listen_max 4375
</PRE><P> <A NAME="cookie"></A> </P><!--TOC section Erlang Cookie-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc68">5.3</A>&#XA0;&#XA0;<A HREF="#cookie">Erlang Cookie</A></H2><!--SEC END --><P> <A NAME="cookie"></A> </P><P>The Erlang cookie is a string with numbers and letters.
An Erlang node reads the cookie at startup from the command-line parameter <TT>-setcookie</TT>.
If not indicated, the cookie is read from the cookie file <TT>$HOME/.erlang.cookie</TT>.
If this file does not exist, it is created immediately with a random cookie.
Two Erlang nodes communicate only if they have the same cookie.
Setting a cookie on the Erlang node allows you to structure your Erlang network
and define which nodes are allowed to connect to which.</P><P>Thanks to Erlang cookies, you can prevent access to the Erlang node by mistake,
for example when there are several Erlang nodes running different programs in the same machine.</P><P>Setting a secret cookie is a simple method
to difficult unauthorized access to your Erlang node.
However, the cookie system is not ultimately effective
to prevent unauthorized access or intrusion to an Erlang node.
The communication between Erlang nodes are not encrypted,
so the cookie could be read sniffing the traffic on the network.
The recommended way to secure the Erlang node is to block the port 4369.</P><P> <A NAME="nodename"></A> </P><!--TOC section Erlang node name-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc69">5.4</A>&#XA0;&#XA0;<A HREF="#nodename">Erlang node name</A></H2><!--SEC END --><P> <A NAME="nodename"></A> </P><P>An Erlang node may have a node name.
The name can be short (if indicated with the command-line parameter <TT>-sname</TT>)
or long (if indicated with the parameter <TT>-name</TT>).
Starting an Erlang node with -sname limits the communication between Erlang nodes to the LAN.</P><P>Using the option <TT>-sname</TT> instead of <TT>-name</TT> is a simple method
to difficult unauthorized access to your Erlang node.
However, it is not ultimately effective to prevent access to the Erlang node,
because it may be possible to fake the fact that you are on another network
using a modified version of Erlang <TT>epmd</TT>.
The recommended way to secure the Erlang node is to block the port 4369.</P><P> <A NAME="secure-files"></A> </P><!--TOC section Securing sensible files-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc70">5.5</A>&#XA0;&#XA0;<A HREF="#secure-files">Securing sensible files</A></H2><!--SEC END --><P> <A NAME="secure-files"></A> </P><P><TT>ejabberd</TT> stores sensible data in the file system either in plain text or binary files.
The file system permissions should be set to only allow the proper user to read,
write and execute those files and directories.</P><DL CLASS="description"><DT CLASS="dt-description">
<B><TT>ejabberd configuration file: /etc/ejabberd/ejabberd.cfg</TT></B></DT><DD CLASS="dd-description">
Contains the JID of administrators
and passwords of external components.
The backup files probably contain also this information,
so it is preferable to secure the whole <TT>/etc/ejabberd/</TT> directory.
</DD><DT CLASS="dt-description"><B><TT>ejabberd service log: /var/log/ejabberd/ejabberd.log</TT></B></DT><DD CLASS="dd-description">
Contains IP addresses of clients.
If the loglevel is set to 5, it contains whole conversations and passwords.
If a logrotate system is used, there may be several log files with similar information,
so it is preferable to secure the whole <TT>/var/log/ejabberd/</TT> directory.
</DD><DT CLASS="dt-description"><B><TT>Mnesia database spool files: /var/lib/ejabberd/db/*</TT></B></DT><DD CLASS="dd-description">
The files store binary data, but some parts are still readable.
The files are generated by Mnesia and their permissions cannot be set directly,
so it is preferable to secure the whole <TT>/var/lib/ejabberd/db/</TT> directory.
</DD><DT CLASS="dt-description"><B><TT>Erlang cookie file: /var/lib/ejabberd/.erlang.cookie</TT></B></DT><DD CLASS="dd-description">
See section <A HREF="#cookie">5.3</A>.
</DD></DL><P> <A NAME="clustering"></A> </P><!--TOC chapter Clustering-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc71">Chapter&#XA0;6</A>&#XA0;&#XA0;<A HREF="#clustering">Clustering</A></H1><!--SEC END --><P> <A NAME="clustering"></A> 
</P><P> <A NAME="howitworks"></A> </P><!--TOC section How it Works-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc72">6.1</A>&#XA0;&#XA0;<A HREF="#howitworks">How it Works</A></H2><!--SEC END --><P> <A NAME="howitworks"></A> 
</P><P>A Jabber domain is served by one or more <TT>ejabberd</TT> nodes. These nodes can
be run on different machines that are connected via a network. They all
must have the ability to connect to port 4369 of all another nodes, and must
have the same magic cookie (see Erlang/OTP documentation, in other words the
file <TT>~ejabberd/.erlang.cookie</TT> must be the same on all nodes). This is
needed because all nodes exchange information about connected users, s2s
connections, registered services, etc&#X2026;</P><P>Each <TT>ejabberd</TT> node has the following modules:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
router,
</LI><LI CLASS="li-itemize">local router,
</LI><LI CLASS="li-itemize">session manager,
</LI><LI CLASS="li-itemize">s2s manager.
</LI></UL><P> <A NAME="router"></A> </P><!--TOC subsection Router-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc73">6.1.1</A>&#XA0;&#XA0;<A HREF="#router">Router</A></H3><!--SEC END --><P> <A NAME="router"></A> 
</P><P>This module is the main router of Jabber packets on each node. It
routes them based on their destination&#X2019;s domains. It uses a global
routing table. The domain of the packet&#X2019;s destination is searched in the
routing table, and if it is found, the packet is routed to the
appropriate process. If not, it is sent to the s2s manager.</P><P> <A NAME="localrouter"></A> </P><!--TOC subsection Local Router-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc74">6.1.2</A>&#XA0;&#XA0;<A HREF="#localrouter">Local Router</A></H3><!--SEC END --><P> <A NAME="localrouter"></A> 
</P><P>This module routes packets which have a destination domain equal to
one of this server&#X2019;s host names. If the destination JID has a non-empty user
part, it is routed to the session manager, otherwise it is processed depending
on its content.</P><P> <A NAME="sessionmanager"></A> </P><!--TOC subsection Session Manager-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc75">6.1.3</A>&#XA0;&#XA0;<A HREF="#sessionmanager">Session Manager</A></H3><!--SEC END --><P> <A NAME="sessionmanager"></A> 
</P><P>This module routes packets to local users. It looks up to which user
resource a packet must be sent via a presence table. Then the packet is
either routed to the appropriate c2s process, or stored in offline
storage, or bounced back.</P><P> <A NAME="s2smanager"></A> </P><!--TOC subsection s2s Manager-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc76">6.1.4</A>&#XA0;&#XA0;<A HREF="#s2smanager">s2s Manager</A></H3><!--SEC END --><P> <A NAME="s2smanager"></A> 
</P><P>This module routes packets to other Jabber servers. First, it
checks if an opened s2s connection from the domain of the packet&#X2019;s
source to the domain of the packet&#X2019;s destination exists. If that is the case,
the s2s manager routes the packet to the process
serving this connection, otherwise a new connection is opened.</P><P> <A NAME="cluster"></A> </P><!--TOC section Clustering Setup-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc77">6.2</A>&#XA0;&#XA0;<A HREF="#cluster">Clustering Setup</A></H2><!--SEC END --><P> <A NAME="cluster"></A> 
</P><P>Suppose you already configured <TT>ejabberd</TT> on one machine named (<TT>first</TT>),
and you need to setup another one to make an <TT>ejabberd</TT> cluster. Then do
following steps:</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Copy <CODE>~ejabberd/.erlang.cookie</CODE> file from <TT>first</TT> to
<TT>second</TT>.<P>(alt) You can also add &#X2018;<CODE>-cookie content_of_.erlang.cookie</CODE>&#X2019;
option to all &#X2018;<TT>erl</TT>&#X2019; commands below.</P></LI><LI CLASS="li-enumerate">On <TT>second</TT> run the following command as the <TT>ejabberd</TT> daemon user,
in the working directory of <TT>ejabberd</TT>:<PRE CLASS="verbatim">erl -sname ejabberd \
    -mnesia dir "/var/lib/ejabberd/" \
    -mnesia extra_db_nodes "['ejabberd@first']" \
    -s mnesia
</PRE><P>This will start Mnesia serving the same database as <TT>ejabberd@first</TT>.
You can check this by running the command &#X2018;<CODE>mnesia:info().</CODE>&#X2019;. You
should see a lot of remote tables and a line like the following:</P><P>Note: the Mnesia directory may be different in your system.
To know where does ejabberd expect Mnesia to be installed by default,
call <A HREF="#ejabberdctl">4.1</A> without options and it will show some help,
including the Mnesia database spool dir.</P><PRE CLASS="verbatim">running db nodes   = [ejabberd@first, ejabberd@second]
</PRE></LI><LI CLASS="li-enumerate">Now run the following in the same &#X2018;<TT>erl</TT>&#X2019; session:<PRE CLASS="verbatim">mnesia:change_table_copy_type(schema, node(), disc_copies).
</PRE><P>This will create local disc storage for the database.</P><P>(alt) Change storage type of the <TT>scheme</TT> table to &#X2018;RAM and disc
copy&#X2019; on the second node via the Web Admin.</P></LI><LI CLASS="li-enumerate">Now you can add replicas of various tables to this node with
&#X2018;<CODE>mnesia:add_table_copy</CODE>&#X2019; or
&#X2018;<CODE>mnesia:change_table_copy_type</CODE>&#X2019; as above (just replace
&#X2018;<CODE>schema</CODE>&#X2019; with another table name and &#X2018;<CODE>disc_copies</CODE>&#X2019;
can be replaced with &#X2018;<CODE>ram_copies</CODE>&#X2019; or
&#X2018;<CODE>disc_only_copies</CODE>&#X2019;).<P>Which tables to replicate is very dependant on your needs, you can get
some hints from the command &#X2018;<CODE>mnesia:info().</CODE>&#X2019;, by looking at the
size of tables and the default storage type for each table on &#X2019;first&#X2019;.</P><P>Replicating a table makes lookups in this table faster on this node.
Writing, on the other hand, will be slower. And of course if machine with one
of the replicas is down, other replicas will be used.</P><P>Also <A HREF="http://www.erlang.org/doc/apps/mnesia/Mnesia_chap5.html#5.3">section 5.3 (Table Fragmentation) of Mnesia User&#X2019;s Guide</A> can be helpful.
</P><P>(alt) Same as in previous item, but for other tables.</P></LI><LI CLASS="li-enumerate">Run &#X2018;<CODE>init:stop().</CODE>&#X2019; or just &#X2018;<CODE>q().</CODE>&#X2019; to exit from
the Erlang shell. This probably can take some time if Mnesia has not yet
transfered and processed all data it needed from <TT>first</TT>.</LI><LI CLASS="li-enumerate">Now run <TT>ejabberd</TT> on <TT>second</TT> with almost the same config as
on <TT>first</TT> (you probably do not need to duplicate &#X2018;<CODE>acl</CODE>&#X2019;
and &#X2018;<CODE>access</CODE>&#X2019; options &#X2014; they will be taken from
<TT>first</TT>, and <CODE>mod_muc</CODE> and <CODE>mod_irc</CODE> should be
enabled only on one machine in the cluster).
</LI></OL><P>You can repeat these steps for other machines supposed to serve this
domain.</P><P> <A NAME="servicelb"></A> </P><!--TOC section Service Load-Balancing-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc78">6.3</A>&#XA0;&#XA0;<A HREF="#servicelb">Service Load-Balancing</A></H2><!--SEC END --><P> <A NAME="servicelb"></A> 
</P><P> <A NAME="componentlb"></A> </P><!--TOC subsection Components Load-Balancing-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc79">6.3.1</A>&#XA0;&#XA0;<A HREF="#componentlb">Components Load-Balancing</A></H3><!--SEC END --><P> <A NAME="componentlb"></A> </P><P> <A NAME="domainlb"></A> </P><!--TOC subsection Domain Load-Balancing Algorithm-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc80">6.3.2</A>&#XA0;&#XA0;<A HREF="#domainlb">Domain Load-Balancing Algorithm</A></H3><!--SEC END --><P> <A NAME="domainlb"></A> 
</P><P><TT>ejabberd</TT> includes an algorithm to load balance the components that are plugged on an <TT>ejabberd</TT> cluster. It means that you can plug one or several instances of the same component on each <TT>ejabberd</TT> cluster and that the traffic will be automatically distributed.</P><P>The default distribution algorithm try to deliver to a local instance of a component. If several local instances are available, one instance is chosen randomly. If no instance is available locally, one instance is chosen randomly among the remote component instances.</P><P>If you need a different behaviour, you can change the load balancing behaviour with the option <TT>domain_balancing</TT>. The syntax of the option is the following:</P><PRE CLASS="verbatim">{domain_balancing, "component.example.com", &lt;balancing_criterium&gt;}.
</PRE><P>Several balancing criteria are available:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>destination</TT>: the full JID of the packet <TT>to</TT> attribute is used.
</LI><LI CLASS="li-itemize"><TT>source</TT>: the full JID of the packet <TT>from</TT> attribute is used.
</LI><LI CLASS="li-itemize"><TT>bare_destination</TT>: the bare JID (without resource) of the packet <TT>to</TT> attribute is used.
</LI><LI CLASS="li-itemize"><TT>bare_source</TT>: the bare JID (without resource) of the packet <TT>from</TT> attribute is used.
</LI></UL><P>If the value corresponding to the criteria is the same, the same component instance in the cluster will be used.</P><P> <A NAME="lbbuckets"></A> </P><!--TOC subsection Load-Balancing Buckets-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc81">6.3.3</A>&#XA0;&#XA0;<A HREF="#lbbuckets">Load-Balancing Buckets</A></H3><!--SEC END --><P> <A NAME="lbbuckets"></A> 
</P><P>When there is a risk of failure for a given component, domain balancing can cause service trouble. If one component is failing the service will not work correctly unless the sessions are rebalanced.</P><P>In this case, it is best to limit the problem to the sessions handled by the failing component. This is what the <TT>domain_balancing_component_number</TT> option does, making the load balancing algorithm not dynamic, but sticky on a fix number of component instances.</P><P>The syntax is the following:
</P><PRE CLASS="verbatim">{domain_balancing_component_number, "component.example.com", N}
</PRE><P> <A NAME="debugging"></A> </P><!--TOC chapter Debugging-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc82">Chapter&#XA0;7</A>&#XA0;&#XA0;<A HREF="#debugging">Debugging</A></H1><!--SEC END --><P> <A NAME="debugging"></A> 
</P><P> <A NAME="watchdog"></A> </P><!--TOC section Watchdog Alerts-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc83">7.1</A>&#XA0;&#XA0;<A HREF="#watchdog">Watchdog Alerts</A></H2><!--SEC END --><P> <A NAME="watchdog"></A> 
</P><P><TT>ejabberd</TT> includes a watchdog mechanism.
If a process in the <TT>ejabberd</TT> server consumes too much memory,
a message is sent to the Jabber accounts defined with the option
<TT>watchdog_admins</TT>
 in the <TT>ejabberd</TT> configuration file.
Example configuration:
</P><PRE CLASS="verbatim">{watchdog_admins, ["admin2@localhost", "admin2@example.org"]}.
</PRE><P>To remove watchdog admins, remove them in the option.
To remove all watchdog admins, set the option with an empty list:
</P><PRE CLASS="verbatim">{watchdog_admins, []}.
</PRE><P> <A NAME="logfiles"></A> </P><!--TOC section Log Files-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc84">7.2</A>&#XA0;&#XA0;<A HREF="#logfiles">Log Files</A></H2><!--SEC END --><P> <A NAME="logfiles"></A> </P><P>An <TT>ejabberd</TT> node writes two log files:
</P><DL CLASS="description"><DT CLASS="dt-description">
	<B><TT>ejabberd.log</TT></B></DT><DD CLASS="dd-description"> is the ejabberd service log, with the messages reported by <TT>ejabberd</TT> code
	</DD><DT CLASS="dt-description"><B><TT>sasl.log</TT></B></DT><DD CLASS="dd-description"> is the Erlang/OTP system log, with the messages reported by Erlang/OTP using SASL (System Architecture Support Libraries)
</DD></DL><P>The option <TT>loglevel</TT> modifies the verbosity of the file ejabberd.log.
The possible levels are:
</P><DL CLASS="description"><DT CLASS="dt-description">
	<B><TT>0</TT></B></DT><DD CLASS="dd-description"> No ejabberd log at all (not recommended)
	</DD><DT CLASS="dt-description"><B><TT>1</TT></B></DT><DD CLASS="dd-description"> Critical
	</DD><DT CLASS="dt-description"><B><TT>2</TT></B></DT><DD CLASS="dd-description"> Error
	</DD><DT CLASS="dt-description"><B><TT>3</TT></B></DT><DD CLASS="dd-description"> Warning
	</DD><DT CLASS="dt-description"><B><TT>4</TT></B></DT><DD CLASS="dd-description"> Info
	</DD><DT CLASS="dt-description"><B><TT>5</TT></B></DT><DD CLASS="dd-description"> Debug
</DD></DL><P>
For example, the default configuration is:
</P><PRE CLASS="verbatim">{loglevel, 4}.
</PRE><P> <A NAME="debugconsole"></A> </P><!--TOC section Debug Console-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc85">7.3</A>&#XA0;&#XA0;<A HREF="#debugconsole">Debug Console</A></H2><!--SEC END --><P> <A NAME="debugconsole"></A> </P><P>The Debug Console is an Erlang shell attached to an already running <TT>ejabberd</TT> server.
With this Erlang shell, an experienced administrator can perform complex tasks.</P><P>This shell gives complete control over the <TT>ejabberd</TT> server,
so it is important to use it with extremely care.
There are some simple and safe examples in the article
<A HREF="http://www.ejabberd.im/interconnect-erl-nodes">Interconnecting Erlang Nodes</A></P><P>To exit the shell, close the window or press the keys: control+c control+c.</P><P> <A NAME="i18ni10n"></A> </P><!--TOC chapter Internationalization and Localization-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc86">Appendix&#XA0;A</A>&#XA0;&#XA0;<A HREF="#i18ni10n">Internationalization and Localization</A></H1><!--SEC END --><P> <A NAME="i18ni10n"></A> 
</P><P>All built-in modules support the <TT>xml:lang</TT> attribute inside IQ queries.
Figure&#XA0;<A HREF="#fig:discorus">A.1</A>, for example, shows the reply to the following query:
</P><PRE CLASS="verbatim">&lt;iq id='5'
    to='example.org'
    type='get'
    xml:lang='ru'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
</PRE><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>

<IMG SRC="discorus.png" ALT="discorus.png">


<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure A.1: Service Discovery when <TT>xml:lang=&#X2019;ru&#X2019;</TT></TD></TR>
</TABLE></DIV>
<A NAME="fig:discorus"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE><P>The Web Admin also supports the <CODE>Accept-Language</CODE> HTTP header.</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>

<IMG SRC="webadmmainru.png" ALT="webadmmainru.png">


<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure A.2: Web Admin showing a virtual host when the web browser provides the
HTTP header &#X2018;Accept-Language: ru&#X2019;</TD></TR>
</TABLE></DIV>
<A NAME="fig:webadmmainru"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE><P> <A NAME="releasenotes"></A> </P><!--TOC chapter Release Notes-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc87">Appendix&#XA0;B</A>&#XA0;&#XA0;<A HREF="#releasenotes">Release Notes</A></H1><!--SEC END --><P> <A NAME="releasenotes"></A> 
</P><P>Release notes are available from <A HREF="http://www.process-one.net/en/ejabberd/release_notes/">ejabberd Home Page</A></P><P> <A NAME="acknowledgements"></A> </P><!--TOC chapter Acknowledgements-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc88">Appendix&#XA0;C</A>&#XA0;&#XA0;<A HREF="#acknowledgements">Acknowledgements</A></H1><!--SEC END --><P> <A NAME="acknowledgements"></A> </P><P>Thanks to all people who contributed to this guide:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Alexey Shchepin (<A HREF="xmpp:aleksey@jabber.ru"><TT>xmpp:aleksey@jabber.ru</TT></A>)
</LI><LI CLASS="li-itemize">Badlop (<A HREF="xmpp:badlop@jabberes.org"><TT>xmpp:badlop@jabberes.org</TT></A>)
</LI><LI CLASS="li-itemize">Evgeniy Khramtsov (<A HREF="xmpp:xram@jabber.ru"><TT>xmpp:xram@jabber.ru</TT></A>)
</LI><LI CLASS="li-itemize">Florian Zumbiehl (<A HREF="xmpp:florz@florz.de"><TT>xmpp:florz@florz.de</TT></A>)
</LI><LI CLASS="li-itemize">Michael Grigutsch (<A HREF="xmpp:migri@jabber.i-pobox.net"><TT>xmpp:migri@jabber.i-pobox.net</TT></A>)
</LI><LI CLASS="li-itemize">Mickael Remond (<A HREF="xmpp:mremond@process-one.net"><TT>xmpp:mremond@process-one.net</TT></A>)
</LI><LI CLASS="li-itemize">Sander Devrieze (<A HREF="xmpp:s.devrieze@gmail.com"><TT>xmpp:s.devrieze@gmail.com</TT></A>)
</LI><LI CLASS="li-itemize">Sergei Golovan (<A HREF="xmpp:sgolovan@nes.ru"><TT>xmpp:sgolovan@nes.ru</TT></A>)
</LI><LI CLASS="li-itemize">Vsevolod Pelipas (<A HREF="xmpp:vsevoload@jabber.ru"><TT>xmpp:vsevoload@jabber.ru</TT></A>)
</LI></UL><P> <A NAME="copyright"></A> </P><!--TOC chapter Copyright Information-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc89">Appendix&#XA0;D</A>&#XA0;&#XA0;<A HREF="#copyright">Copyright Information</A></H1><!--SEC END --><P> <A NAME="copyright"></A> </P><P>Ejabberd Installation and Operation Guide.<BR>
Copyright &#XA9; 2003 &#X2014; 2008 ProcessOne</P><P>This document is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.</P><P>This document is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</P><P>You should have received a copy of the GNU General Public License along with
this document; if not, write to the Free Software Foundation, Inc., 51 Franklin
Street, Fifth Floor, Boston, MA 02110-1301, USA.</P><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://hevea.inria.fr/index.html"><EM>H</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>V</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>A</EM></A><EM>.</EM></BLOCKQUOTE></BODY>
</HTML>
