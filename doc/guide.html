<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD><TITLE>Ejabberd 1.1.1 Installation and Operation Guide</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=KOI8-R">
<META name="GENERATOR" content="hevea 1.07">
</HEAD>
<BODY >
<!--HEVEA command line is: /usr/bin/hevea guide.tex -->
<!--HTMLHEAD-->
<!--ENDHTML-->
<!--PREFIX <ARG ></ARG>-->
<!--CUT DEF section 1 -->
<BR>
<BR>
<A NAME="sec:titlepage"></A>

 
<H1 ALIGN=center>Ejabberd 1.1.1 Installation and Operation Guide</H1>

<H3 ALIGN=center>Alexey Shchepin<BR>
<A HREF="mailto:alexey@sevcom.net"><TT>mailto:alexey@sevcom.net</TT></A><BR>
<A HREF="xmpp:aleksey@jabber.ru"><TT>xmpp:aleksey@jabber.ru</TT></A></H3>
<BR>
<DIV ALIGN=center>
 
 <IMG SRC="logo.png">
 

 <BR>
<BR>

 </DIV>
<BLOCKQUOTE><I>I can thoroughly recommend ejabberd for ease of setup --
 Kevin Smith, Current maintainer of the Psi project</I></BLOCKQUOTE>
<!--TOC section Table of Contents-->

<H2>Table of Contents</H2><!--SEC END -->

<UL><LI>
<A HREF="#htoc1">1&nbsp;&nbsp;Introduction</A>
<UL><LI>
<A HREF="#htoc2">1.1&nbsp;&nbsp;Key Features</A>
<LI><A HREF="#htoc3">1.2&nbsp;&nbsp;Additional Features</A>
</UL>
<LI><A HREF="#htoc4">2&nbsp;&nbsp;Installation from Source</A>
<UL><LI>
<A HREF="#htoc5">2.1&nbsp;&nbsp;Installation Requirements</A>
<UL><LI>
<A HREF="#htoc6">2.1.1&nbsp;&nbsp;``Unix-like'' operating systems</A>
<LI><A HREF="#htoc7">2.1.2&nbsp;&nbsp;Windows</A>
</UL>
<LI><A HREF="#htoc8">2.2&nbsp;&nbsp;Obtaining <TT>ejabberd</TT></A>
<LI><A HREF="#htoc9">2.3&nbsp;&nbsp;Compilation</A>
<UL><LI>
<A HREF="#htoc10">2.3.1&nbsp;&nbsp;``Unix-like'' operating systems</A>
<LI><A HREF="#htoc11">2.3.2&nbsp;&nbsp;Windows</A>
</UL>
<LI><A HREF="#htoc12">2.4&nbsp;&nbsp;Starting</A>
</UL>
<LI><A HREF="#htoc13">3&nbsp;&nbsp;Configuration</A>
<UL><LI>
<A HREF="#htoc14">3.1&nbsp;&nbsp;Initial Configuration</A>
<UL><LI>
<A HREF="#htoc15">3.1.1&nbsp;&nbsp;Host Names</A>
<LI><A HREF="#htoc16">3.1.2&nbsp;&nbsp;Default Language</A>
<LI><A HREF="#htoc17">3.1.3&nbsp;&nbsp;Access Rules</A>
<LI><A HREF="#htoc18">3.1.4&nbsp;&nbsp;Shapers</A>
<LI><A HREF="#htoc19">3.1.5&nbsp;&nbsp;Limitation of the number of opened sessions</A>
<LI><A HREF="#htoc20">3.1.6&nbsp;&nbsp;Listened Sockets</A>
<LI><A HREF="#htoc21">3.1.7&nbsp;&nbsp;Modules</A>
<LI><A HREF="#htoc22">3.1.8&nbsp;&nbsp;Virtual Hosting</A>
<LI><A HREF="#htoc23">3.1.9&nbsp;&nbsp;SASL anonymous and anonymous login</A>
</UL>
<LI><A HREF="#htoc24">3.2&nbsp;&nbsp;Relational Database Support</A>
<UL><LI>
<A HREF="#htoc25">3.2.1&nbsp;&nbsp;Preliminary steps</A>
<LI><A HREF="#htoc26">3.2.2&nbsp;&nbsp;Authentication against a relational database</A>
<LI><A HREF="#htoc27">3.2.3&nbsp;&nbsp;Relational database for other modules</A>
</UL>
<LI><A HREF="#htoc28">3.3&nbsp;&nbsp;Creating an Initial Administrator</A>
<LI><A HREF="#htoc29">3.4&nbsp;&nbsp;Online Configuration and Monitoring</A>
<UL><LI>
<A HREF="#htoc30">3.4.1&nbsp;&nbsp;Web Interface</A>
<LI><A HREF="#htoc31">3.4.2&nbsp;&nbsp;<TT>ejabberdctl</TT></A>
</UL>
</UL>
<LI><A HREF="#htoc32">4&nbsp;&nbsp;Firewall Settings</A>
<LI><A HREF="#htoc33">5&nbsp;&nbsp;SRV Records</A>
<LI><A HREF="#htoc34">6&nbsp;&nbsp;Clustering</A>
<UL><LI>
<A HREF="#htoc35">6.1&nbsp;&nbsp;How it Works</A>
<UL><LI>
<A HREF="#htoc36">6.1.1&nbsp;&nbsp;Router</A>
<LI><A HREF="#htoc37">6.1.2&nbsp;&nbsp;Local Router</A>
<LI><A HREF="#htoc38">6.1.3&nbsp;&nbsp;Session Manager</A>
<LI><A HREF="#htoc39">6.1.4&nbsp;&nbsp;s2s Manager</A>
</UL>
<LI><A HREF="#htoc40">6.2&nbsp;&nbsp;Clustering Setup</A>
</UL>
<LI><A HREF="#htoc41">A&nbsp;&nbsp;Built-in Modules</A>
<UL><LI>
<A HREF="#htoc42">A.1&nbsp;&nbsp;Overview</A>
<LI><A HREF="#htoc43">A.2&nbsp;&nbsp;Common Options</A>
<UL><LI>
<A HREF="#htoc44">A.2.1&nbsp;&nbsp;<TT>iqdisc</TT></A>
<LI><A HREF="#htoc45">A.2.2&nbsp;&nbsp;<TT>hosts</TT></A>
</UL>
<LI><A HREF="#htoc46">A.3&nbsp;&nbsp;<TT>mod_announce</TT></A>
<LI><A HREF="#htoc47">A.4&nbsp;&nbsp;<TT>mod_disco</TT></A>
<LI><A HREF="#htoc48">A.5&nbsp;&nbsp;<TT>mod_echo</TT></A>
<LI><A HREF="#htoc49">A.6&nbsp;&nbsp;<TT>mod_irc</TT></A>
<LI><A HREF="#htoc50">A.7&nbsp;&nbsp;<TT>mod_last</TT></A>
<LI><A HREF="#htoc51">A.8&nbsp;&nbsp;<TT>mod_muc</TT></A>
<LI><A HREF="#htoc52">A.9&nbsp;&nbsp;<TT>mod_muc_log</TT></A>
<LI><A HREF="#htoc53">A.10&nbsp;&nbsp;<TT>mod_offline</TT></A>
<LI><A HREF="#htoc54">A.11&nbsp;&nbsp;<TT>mod_privacy</TT></A>
<LI><A HREF="#htoc55">A.12&nbsp;&nbsp;<TT>mod_private</TT></A>
<LI><A HREF="#htoc56">A.13&nbsp;&nbsp;<TT>mod_pubsub</TT></A>
<LI><A HREF="#htoc57">A.14&nbsp;&nbsp;<TT>mod_register</TT></A>
<LI><A HREF="#htoc58">A.15&nbsp;&nbsp;<TT>mod_roster</TT></A>
<LI><A HREF="#htoc59">A.16&nbsp;&nbsp;<TT>mod_service_log</TT></A>
<LI><A HREF="#htoc60">A.17&nbsp;&nbsp;<TT>mod_shared_roster</TT></A>
<LI><A HREF="#htoc61">A.18&nbsp;&nbsp;<TT>mod_stats</TT></A>
<LI><A HREF="#htoc62">A.19&nbsp;&nbsp;<TT>mod_time</TT></A>
<LI><A HREF="#htoc63">A.20&nbsp;&nbsp;<TT>mod_vcard</TT></A>
<LI><A HREF="#htoc64">A.21&nbsp;&nbsp;LDAP and <TT>mod_vcard_ldap</TT></A>
<UL><LI>
<A HREF="#htoc65">A.21.1&nbsp;&nbsp;Features</A>
<LI><A HREF="#htoc66">A.21.2&nbsp;&nbsp;Connection</A>
<LI><A HREF="#htoc67">A.21.3&nbsp;&nbsp;Authentication</A>
<LI><A HREF="#htoc68">A.21.4&nbsp;&nbsp;vCards and Search</A>
<LI><A HREF="#htoc69">A.21.5&nbsp;&nbsp;Examples</A>
</UL>
<LI><A HREF="#htoc70">A.22&nbsp;&nbsp;<TT>mod_version</TT></A>
</UL>
<LI><A HREF="#htoc71">B&nbsp;&nbsp;Internationalization and Localization</A>
<LI><A HREF="#htoc72">C&nbsp;&nbsp;Release Notes</A>
<UL><LI>
<A HREF="#htoc73">C.1&nbsp;&nbsp;ejabberd 0.9</A>
<LI><A HREF="#htoc74">C.2&nbsp;&nbsp;ejabberd 0.9.1</A>
<LI><A HREF="#htoc75">C.3&nbsp;&nbsp;ejabberd 0.9.8</A>
<LI><A HREF="#htoc76">C.4&nbsp;&nbsp;ejabberd 1.0.0</A>
<LI><A HREF="#htoc77">C.5&nbsp;&nbsp;ejabberd 1.1.0</A>
<LI><A HREF="#htoc78">C.6&nbsp;&nbsp;ejabberd 1.1.1</A>
</UL>
<LI><A HREF="#htoc79">D&nbsp;&nbsp;Acknowledgements</A>
</UL>

<!--TOC section Introduction-->

<H2><A NAME="htoc1">1</A>&nbsp;&nbsp;Introduction</H2><!--SEC END -->

<A NAME="sec:intr"></A>
 
<TT>ejabberd</TT> is a free (GPL) distributed fault-tolerant Jabber/XMPP server and is mainly written in <A HREF="http://www.erlang.org/">Erlang</A>.<BR>
<BR>
<TT>ejabberd</TT> is designed to be a stable, standards compliant, and feature rich Jabber/XMPP server.<BR>
<BR>
<TT>ejabberd</TT> is suitable for small servers, whether they need to be scalable or not, as well as extremely big servers.<BR>
<BR>
<!--TOC subsection Key Features-->

<H3><A NAME="htoc2">1.1</A>&nbsp;&nbsp;Key Features</H3><!--SEC END -->

<A NAME="sec:keyfeatures"></A>

<TT>ejabberd</TT> is:
<UL><LI>
Multiplatform: <TT>ejabberd</TT> runs under Microsoft Windows and Unix derived systems such as Linux, FreeBSD and NetBSD.<BR>
<BR>
<LI>Distributed: You can run <TT>ejabberd</TT> on a cluster of machines and all of them will serve the same Jabber domain(s). When you need more capacity you can simply add a new cheap node to your cluster. Accordingly, you do not need to buy an expensive high-end machine to support tens of thousands concurrent users.<BR>
<BR>
<LI>Fault-tolerant: You can deploy an <TT>ejabberd</TT> cluster so that all the information required for a properly working service will be replicated permanently on all nodes. This means that if one of the nodes crashes, the others will continue working without disruption. In addition, nodes also can be added or replaced ``on the fly''.<BR>
<BR>
<LI>Administrator Friendly: <TT>ejabberd</TT> is built on top of the Open Source Erlang. As a result you do not need to install an external database, an external web server, amongst others because everything is already included, and ready to run out of the box. Other administrator benefits include:
<UL><LI>
Comprehensive documentation.
<LI>Straightforward installers for Linux, Mac OS X, and Windows.
<LI>Web interface for administration tasks.
<LI>Shared Roster Groups.
<LI>Command line administration tool.
<LI>Can integrate with existing authentication mechanisms.
<LI>Capability to send announce messages.
</UL><BR>
<BR>
<LI>Internationalized: <TT>ejabberd</TT> leads in internationalization. Hence it is very well suited in a globalized world. Related features are:
<UL><LI>
Translated in 11 languages.
<LI>Support for <A HREF="http://www.ietf.org/rfc/rfc3490.txt">IDNA</A>.
</UL><BR>
<BR>
<LI>Open Standards: <TT>ejabberd</TT> is the first Open Source Jabber server claiming to fully comply to the XMPP standard.
<UL><LI>
Fully XMPP compliant 
<LI>XML-based protocol
<LI><A HREF="http://ejabberd.jabber.ru/protocols">Many JEPs supported</A>.
</UL></UL>
<!--TOC subsection Additional Features-->

<H3><A NAME="htoc3">1.2</A>&nbsp;&nbsp;Additional Features</H3><!--SEC END -->

<A NAME="sec:addfeatures"></A>

Besides common Jabber server features, <TT>ejabberd</TT> comes with a wide range of other features:
<UL><LI>
Modular
<UL><LI>
Load only the modules you want.
<LI>Extend <TT>ejabberd</TT> with your own custom modules.
</UL>
<LI>Security
<UL><LI>
SASL and STARTTLS for c2s and s2s connections.
<LI>STARTTLS and Dialback s2s connections.
<LI>Web interface accessible via HTTPS secure access.
</UL>
<LI>Databases
<UL><LI>
Native MySQL support.
<LI>Native PostgreSQL support.
<LI>Mnesia.
<LI>ODBC data storage support. 
<LI>Microsoft SQL Server support (via ODBC).
</UL>
<LI>Authentication
<UL><LI>
LDAP and ODBC. 
<LI>External Authentication script.
<LI>Internal Authentication.
</UL>
<LI>Others
<UL><LI>
Compressing XML streams with Stream Compression (<A HREF="http://www.jabber.org/jeps/jep-0138.html">JEP-0138</A>).
<LI>Interface with networks such as AIM, ICQ and MSN.
<LI>Statistics via Statistics Gathering (<A HREF="http://www.jabber.org/jeps/jep-0039.html">JEP-0039</A>).
<LI>IPv6 support both for c2s and s2s connections.
<LI><A HREF="http://www.jabber.org/jeps/jep-0045.html">Multi-User Chat</A> module with logging.
<LI>Users Directory based on users vCards.
<LI><A HREF="http://www.jabber.org/jeps/jep-0060.html">Publish-Subscribe</A> component.
<LI>Support for virtual hosting. 
<LI><A HREF="http://www.jabber.org/jeps/jep-0025.html">HTTP Polling</A> service.
<LI>IRC transport.
</UL>
</UL>
<!--TOC section Installation from Source-->

<H2><A NAME="htoc4">2</A>&nbsp;&nbsp;Installation from Source</H2><!--SEC END -->

<A NAME="sec:installation"></A>

<!--TOC subsection Installation Requirements-->

<H3><A NAME="htoc5">2.1</A>&nbsp;&nbsp;Installation Requirements</H3><!--SEC END -->

<A NAME="sec:installreq"></A>
<!--TOC subsubsection ``Unix-like'' operating systems-->

<H4><A NAME="htoc6">2.1.1</A>&nbsp;&nbsp;``Unix-like'' operating systems</H4><!--SEC END -->

<A NAME="sec:installrequnix"></A>

To compile <TT>ejabberd</TT> on a ``Unix-like'' operating system, you need:
<UL><LI>
GNU Make;
<LI>GCC;
<LI>libexpat 1.95 or higher;
<LI>Erlang/OTP R9C-2 or higher;
<LI>OpenSSL 0.9.6 or higher (optional).
<LI>Zlib 1.2.3 or higher (optional).
<LI>GNU Iconv 1.8 or higher (optional, not needed at all on systems with GNU libc).
</UL>
<!--TOC subsubsection Windows-->

<H4><A NAME="htoc7">2.1.2</A>&nbsp;&nbsp;Windows</H4><!--SEC END -->

<A NAME="sec:installreqwin"></A>

To compile <TT>ejabberd</TT> on a Windows flavour, you need:
<UL><LI>
MS Visual C++ 6.0 Compiler
<LI><A HREF="http://erlang.org/download.html">Erlang/OTP R9C-2 or higher</A>
<LI><A HREF="http://sourceforge.net/project/showfiles.php?group_id=10127&package_id=11277">Expat 1.95.7 or higher</A>
<LI><A HREF="http://www.gnu.org/software/libiconv/">GNU Iconv 1.9.1</A>
(optional)
<LI><A HREF="http://www.slproweb.com/products/Win32OpenSSL.html">Shining Light OpenSSL</A>
(to enable SSL connections)
<LI><A HREF="http://www.zlib.net/">Zlib 1.2.3 or higher</A>
</UL>
<!--TOC subsection Obtaining <TT>ejabberd</TT>-->

<H3><A NAME="htoc8">2.2</A>&nbsp;&nbsp;Obtaining <TT>ejabberd</TT></H3><!--SEC END -->

<A NAME="sec:obtaining"></A>

Released versions of <TT>ejabberd</TT> can be obtained from <BR>
<A HREF="http://www.process-one.net/en/projects/ejabberd/download.html"><TT>http://www.process-one.net/en/projects/ejabberd/download.html</TT></A>.<BR>
<BR>

The latest development version can be retrieved from the Subversion repository.
<PRE>
  svn co http://svn.process-one.net/ejabberd/trunk ejabberd
</PRE>
<!--TOC subsection Compilation-->

<H3><A NAME="htoc9">2.3</A>&nbsp;&nbsp;Compilation</H3><!--SEC END -->

<A NAME="sec:compilation"></A>

<!--TOC subsubsection ``Unix-like'' operating systems-->

<H4><A NAME="htoc10">2.3.1</A>&nbsp;&nbsp;``Unix-like'' operating systems</H4><!--SEC END -->

<A NAME="sec:compilationunix"></A>

Compile <TT>ejabberd</TT> on a ``Unix-like'' operating system by executing:
<PRE>
  ./configure
  make
  su
  make install
</PRE>
These commands will:
<UL><LI>
install <TT>ejabberd</TT> into the directory <CODE>/var/lib/ejabberd</CODE>,
<LI>install the configuration file into <CODE>/etc/ejabberd</CODE>,
<LI>create a directory called <CODE>/var/log/ejabberd</CODE> to store log files.
</UL>
<!--TOC subsubsection Windows-->

<H4><A NAME="htoc11">2.3.2</A>&nbsp;&nbsp;Windows</H4><!--SEC END -->

<A NAME="sec:compilationwin"></A>

<UL><LI>
Install Erlang emulator (for example, into <CODE>C:\Program Files\erl5.3</CODE>).
<LI>Install Expat library into <CODE>C:\Program Files\Expat-1.95.7</CODE>
 directory.<BR>
<BR>
Copy file <CODE>C:\Program Files\Expat-1.95.7\Libs\libexpat.dll</CODE>
 to your Windows system directory (for example, <CODE>C:\WINNT</CODE> or
 <CODE>C:\WINNT\System32</CODE>)
<LI>Build and install the Iconv library into the directory
 <CODE>C:\Program Files\iconv-1.9.1</CODE>.<BR>
<BR>
Copy file <CODE>C:\Program Files\iconv-1.9.1\bin\iconv.dll</CODE> to your
 Windows system directory (more installation instructions can be found in the
 file README.woe32 in the iconv distribution).<BR>
<BR>
Note: instead of copying libexpat.dll and iconv.dll to the Windows
 directory, you can add the directories
 <CODE>C:\Program Files\Expat-1.95.7\Libs</CODE> and
 <CODE>C:\Program Files\iconv-1.9.1\bin</CODE> to the <CODE>PATH</CODE> environment
 variable.
<LI>While in the directory <CODE>ejabberd\src</CODE> run:
<PRE>
configure.bat
nmake -f Makefile.win32
</PRE><LI>Edit the file <CODE>ejabberd\src\ejabberd.cfg</CODE> and run
<PRE>
werl -s ejabberd -name ejabberd
</PRE></UL>
<!--TOC subsection Starting-->

<H3><A NAME="htoc12">2.4</A>&nbsp;&nbsp;Starting</H3><!--SEC END -->

<A NAME="sec:starting"></A>

Execute the following command to start <TT>ejabberd</TT>:
<PRE>
  erl -pa /var/lib/ejabberd/ebin -name ejabberd -s ejabberd
</PRE>or
<PRE>
  erl -pa /var/lib/ejabberd/ebin -sname ejabberd -s ejabberd
</PRE>In the latter case the Erlang node will be identified using only the first part
of the host name, i.&nbsp;e. other Erlang nodes outside this domain can't contact
this node.<BR>
<BR>
Note that when using the above command, <TT>ejabberd</TT> will search for the
configuration file in the current directory and will use the current directory
for storing its user database and for logging.<BR>
<BR>
To specify the path to the configuration file, the log files and the Mnesia
database directory, you may use the following command:
<PRE>
  erl -pa /var/lib/ejabberd/ebin \
      -sname ejabberd \
      -s ejabberd \
      -ejabberd config \"/etc/ejabberd/ejabberd.cfg\" \
                log_path \"/var/log/ejabberd/ejabberd.log\" \
      -sasl sasl_error_logger \{file,\"/var/log/ejabberd/sasl.log\"\} \
      -mnesia dir \"/var/lib/ejabberd/spool\"
</PRE>
You can find other useful options in the Erlang manual page
(<TT>erl -man erl</TT>).<BR>
<BR>
To use more than 1024 connections, you should set the environment variable
<CODE>ERL_MAX_PORTS</CODE>:
<PRE>
  export ERL_MAX_PORTS=32000
</PRE>Note that with this value, <TT>ejabberd</TT> will use more memory (approximately 6&nbsp;MB
more).<BR>
<BR>
To reduce memory usage, you may set the environment variable
<CODE>ERL_FULLSWEEP_AFTER</CODE>:
<PRE>
  export ERL_FULLSWEEP_AFTER=0
</PRE>But in this case <TT>ejabberd</TT> can start to work slower.<BR>
<BR>
<!--TOC section Configuration-->

<H2><A NAME="htoc13">3</A>&nbsp;&nbsp;Configuration</H2><!--SEC END -->

<A NAME="sec:configuration"></A>
<!--TOC subsection Initial Configuration-->

<H3><A NAME="htoc14">3.1</A>&nbsp;&nbsp;Initial Configuration</H3><!--SEC END -->

<A NAME="sec:initconfig"></A>

The configuration file will be loaded the first time you start <TT>ejabberd</TT>. The
content from this file will be parsed and stored in a database. Subsequently the
configuration will be loaded from the database and any commands in the
configuration file are appended to the entries in the database. The
configuration file contains a sequence of Erlang terms. Lines beginning with a
<TT>`%'</TT> sign are ignored. Each term is a tuple of which the first element is
the name of an option, and any further elements are that option's values. If the
configuration file do not contain for instance the ``hosts'' option, the old
host name(s) stored in the database will be used.<BR>
<BR>
You can override the old values stored in the database by adding next lines to
the configuration file:
<PRE>
  override_global.
  override_local.
  override_acls.
</PRE>With these lines the old global options, local options and ACLs will be removed
before new ones are added.<BR>
<BR>
<!--TOC subsubsection Host Names-->

<H4><A NAME="htoc15">3.1.1</A>&nbsp;&nbsp;Host Names</H4><!--SEC END -->

<A NAME="sec:confighostname"></A>

The option <TT>hosts</TT> defines a list containing one or more domains that
<TT>ejabberd</TT> will serve.<BR>
<BR>
Examples:
<UL><LI>
Serving one domain:
<UL><LI>
<PRE>
  {hosts, ["example.org"]}.
</PRE><LI>Backwards compatibility with older <TT>ejabberd</TT> versions can be retained
 with:
 <PRE>
  {host, "example.org"}.
</PRE></UL>
<LI>Serving two domains:
<PRE>
  {hosts, ["example.net", "example.com"]}.
</PRE></UL>
<!--TOC subsubsection Default Language-->

<H4><A NAME="htoc16">3.1.2</A>&nbsp;&nbsp;Default Language</H4><!--SEC END -->

<A NAME="sec:configlanguage"></A>

The option <TT>language</TT> defines the default language of server strings that
can be seen by Jabber clients. If a Jabber client do not support
<TT>xml:lang</TT>, the specified language is used. The default value for the
option <TT>language</TT> is <TT>"en"</TT>. In order to take effect there must be a
translation file <TT>&lt;language&gt;.msg</TT> in <TT>ejabberd</TT>'s <TT>msgs</TT> directory.<BR>
<BR>
Examples:
<UL><LI>
To set Russian as default language:
<PRE>
  {language, "ru"}.
</PRE><LI>To set Spanish as default language:
<PRE>
  {language, "es"}.
</PRE></UL>
<!--TOC subsubsection Access Rules-->

<H4><A NAME="htoc17">3.1.3</A>&nbsp;&nbsp;Access Rules</H4><!--SEC END -->

<A NAME="sec:configaccess"></A>

Access control in <TT>ejabberd</TT> is performed via Access Control Lists (ACLs). The
declarations of ACLs in the configuration file have the following syntax:
<PRE>
  {acl, &lt;aclname&gt;, {&lt;acltype&gt;, ...}}.
</PRE>
<TT>&lt;acltype&gt;</TT> can be one of the following:
<DL COMPACT=compact><DT>
<B><TT>all</TT></B><DD> Matches all JIDs. Example:
<PRE>
{acl, all, all}.
</PRE><DT><B><TT>{user, &lt;username&gt;}</TT></B><DD> Matches the user with the name
 <TT>&lt;username&gt;</TT> at the first virtual host. Example:
<PRE>
{acl, admin, {user, "yozhik"}}.
</PRE><DT><B><TT>{user, &lt;username&gt;, &lt;server&gt;}</TT></B><DD> Matches the user with the JID
 <TT>&lt;username&gt;@&lt;server&gt;</TT> and any resource. Example:
<PRE>
{acl, admin, {user, "yozhik", "example.org"}}.
</PRE><DT><B><TT>{server, &lt;server&gt;}</TT></B><DD> Matches any JID from server
 <TT>&lt;server&gt;</TT>. Example:
<PRE>
{acl, exampleorg, {server, "example.org"}}.
</PRE><DT><B><TT>{user_regexp, &lt;regexp&gt;}</TT></B><DD> Matches any local user with a name that
 matches <TT>&lt;regexp&gt;</TT> at the first virtual host. Example:
<PRE>
{acl, tests, {user, "^test[0-9]*$"}}.
</PRE><DT><B><TT>{user_regexp, &lt;regexp&gt;, &lt;server&gt;}</TT></B><DD> Matches any user with a name
 that matches <TT>&lt;regexp&gt;</TT> at server <TT>&lt;server&gt;</TT>. Example:
<PRE>
{acl, tests, {user, "^test", "example.org"}}.
</PRE><DT><B><TT>{server_regexp, &lt;regexp&gt;}</TT></B><DD> Matches any JID from the server that
 matches <TT>&lt;regexp&gt;</TT>. Example:
<PRE>
{acl, icq, {server, "^icq\\."}}.
</PRE><DT><B><TT>{node_regexp, &lt;user_regexp&gt;, &lt;server_regexp&gt;}</TT></B><DD> Matches any user
 with a name that matches <TT>&lt;user_regexp&gt;</TT> at any server that matches
 <TT>&lt;server_regexp&gt;</TT>. Example:
<PRE>
{acl, yohzik, {node_regexp, "^yohzik$", "^example.(com|org)$"}}.
</PRE><DT><B><TT>{user_glob, &lt;glob&gt;}</TT></B><DD>
<DT><B><TT>{user_glob, &lt;glob&gt;, &lt;server&gt;}</TT></B><DD>
<DT><B><TT>{server_glob, &lt;glob&gt;}</TT></B><DD>
<DT><B><TT>{node_glob, &lt;user_glob&gt;, &lt;server_glob&gt;}</TT></B><DD> This is the same as
 above. However, it uses shell glob patterns instead of regexp. These patterns
 can have the following special characters:
 <DL COMPACT=compact><DT>
 <B><TT>*</TT></B><DD> matches any string including the null string.
 <DT><B><TT>?</TT></B><DD> matches any single character.
 <DT><B><TT>[...]</TT></B><DD> matches any of the enclosed characters. Character
 ranges are specified by a pair of characters separated by a <TT>`-'</TT>.
 If the first character after <TT>`['</TT> is a <TT>`!'</TT>, any
 character not enclosed is matched.
 </DL>
</DL>
The following ACLs are pre-defined:
<DL COMPACT=compact><DT>
<B><TT>all</TT></B><DD> Matches any JID.
<DT><B><TT>none</TT></B><DD> Matches no JID.
</DL>
An entry allowing or denying access to different services looks similar to
this:
<PRE>
  {access, &lt;accessname&gt;, [{allow, &lt;aclname&gt;},
                          {deny, &lt;aclname&gt;},
                          ...
                         ]}.
</PRE>When a JID is checked to have access to <TT>&lt;accessname&gt;</TT>, the server
sequentially checks if that JID mathes any of the ACLs that are named in the
second elements of the tuples in the list. If it matches, the first element of
the first matched tuple is returned, otherwise ``<TT>deny</TT>'' is returned.<BR>
<BR>
Example:
<PRE>
  {access, configure, [{allow, admin}]}.
  {access, something, [{deny, badmans},
                       {allow, all}]}.
</PRE>
The following access rules are pre-defined:
<DL COMPACT=compact><DT>
<B><TT>all</TT></B><DD> Always returns ``<TT>allow</TT>''
<DT><B><TT>none</TT></B><DD> Always returns ``<TT>deny</TT>''
</DL>
<!--TOC subsubsection Shapers-->

<H4><A NAME="htoc18">3.1.4</A>&nbsp;&nbsp;Shapers</H4><!--SEC END -->

<A NAME="sec:configshaper"></A>

Shapers enable you to limit connection traffic. The syntax of
shapers is like this:
<PRE>
  {shaper, &lt;shapername&gt;, &lt;kind&gt;}.
</PRE>Currently only one kind of shaper called <TT>maxrate</TT> is available. It has the
following syntax:
<PRE>
  {maxrate, &lt;rate&gt;}
</PRE>where <TT>&lt;rate&gt;</TT> stands for the maximum allowed incomig rate in bytes per
second.<BR>
<BR>
Examples:
<UL><LI>
To define a shaper named ``<TT>normal</TT>'' with traffic speed limited to
1,000&nbsp;bytes/second:
<PRE>
  {shaper, normal, {maxrate, 1000}}.
</PRE><LI>To define a shaper named ``<TT>fast</TT>'' with traffic speed limited to
50,000&nbsp;bytes/second:
<PRE>
  {shaper, fast, {maxrate, 50000}}.
</PRE></UL>
<!--TOC subsubsection Limitation of the number of opened sessions-->

<H4><A NAME="htoc19">3.1.5</A>&nbsp;&nbsp;Limitation of the number of opened sessions</H4><!--SEC END -->

<A NAME="sec:configmaxsessions"></A>

This option specifies the maximum number of sessions (authenticated
connections) per user. If a user tries to open more than the maximum number of
allowed sessions, with different resources, the first opened session will be
disconnected. The error ``<TT>session replaced</TT>'' is send to the
disconnected session. This value is either a number or <TT>infinity</TT>. For
example <CODE>{max\_user\_sessions, 10}</CODE>. The default value is <TT>10</TT>.<BR>
<BR>
This option can be define per virtual host. See section&nbsp;<A HREF="#sec:configvirtualhost">3.1.8</A>.<BR>
<BR>
<!--TOC subsubsection Listened Sockets-->

<H4><A NAME="htoc20">3.1.6</A>&nbsp;&nbsp;Listened Sockets</H4><!--SEC END -->

<A NAME="sec:configlistened"></A>

The option <TT>listen</TT> defines for which addresses and ports <TT>ejabberd</TT>
will listen and what services will be run on them. Each element of the list is a
tuple with the following elements:
<UL><LI>
Port number.
<LI>Module that serves this port.
<LI>Options to this module.
</UL>

Currently next modules are implemented:
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>ejabberd_c2s</TT></TD>
<TD VALIGN=top ALIGN=left NOWRAP>Description</TD>
<TD VALIGN=top ALIGN=left>Handles c2s connections.</TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD>
<TD VALIGN=top ALIGN=left NOWRAP>Options</TD>
<TD VALIGN=top ALIGN=left><TT>access</TT>, <TT>certfile</TT>, <TT>inet6</TT>,
 <TT>ip</TT>, <TT>max_stanza_size</TT>, <TT>shaper</TT>, <TT>ssl</TT>,
 <TT>tls</TT>, <TT>starttls</TT>, <TT>starttls_required</TT>,
 <TT>zlib</TT></TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>ejabberd_s2s_in</TT></TD>
<TD VALIGN=top ALIGN=left NOWRAP>Description</TD>
<TD VALIGN=top ALIGN=left>Handles incoming s2s
 connections.</TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD>
<TD VALIGN=top ALIGN=left NOWRAP>Options</TD>
<TD VALIGN=top ALIGN=left><TT>inet6</TT>, <TT>ip</TT>,
 <TT>max_stanza_size</TT></TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>ejabberd_service</TT></TD>
<TD VALIGN=top ALIGN=left NOWRAP>Description</TD>
<TD VALIGN=top ALIGN=left>Interacts with external
 components (*).</TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD>
<TD VALIGN=top ALIGN=left NOWRAP>Options</TD>
<TD VALIGN=top ALIGN=left><TT>access</TT>, <TT>hosts</TT>, <TT>inet6</TT>,
 <TT>ip</TT>, <TT>shaper</TT></TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>ejabberd_http</TT></TD>
<TD VALIGN=top ALIGN=left NOWRAP>Description</TD>
<TD VALIGN=top ALIGN=left>Handles incoming HTTP
 connections.</TD>
</TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD>
<TD VALIGN=top ALIGN=left NOWRAP>Options</TD>
<TD VALIGN=top ALIGN=left><TT>certfile</TT>, <TT>http_poll</TT>,
 <TT>inet6</TT>, <TT>ip</TT>, <TT>tls</TT>, <TT>web_admin</TT></TD>
</TR></TABLE>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
(*) The mechanism for <A HREF="http://ejabberd.jabber.ru/tutorials-transports">external components</A> is defined in Jabber Component Protocol (<A HREF="http://www.jabber.org/jeps/jep-0114.html">JEP-0114</A>).<BR>
<BR>
The following options are available:
<DL COMPACT=compact><DT>
 <B><TT>{access, &lt;access rule&gt;}</TT></B><DD> This option defines
 access to the port. The default value is ``<TT>all</TT>''.
 <DT><B><TT>{certfile, Path}</TT></B><DD> Path to a file containing the SSL certificate.
 <DT><B><TT>{hosts, [Hostnames], [HostOptions]}</TT></B><DD> This option
 defines one or more hostnames of connected services and enables you to
 specify additional options including <TT>{password, Secret}</TT>.
 <DT><B><TT>http_poll</TT></B><DD> 
 This option enables HTTP Polling (<A HREF="http://www.jabber.org/jeps/jep-0025.html">JEP-0025</A>) support. HTTP Polling
 enables access via HTTP requests to <TT>ejabberd</TT> from behind firewalls which
 do not allow outgoing sockets on port 5222.<BR>
<BR>
If HTTP Polling is enabled, it will be available at
 <CODE>http://server:port/http-poll/</CODE>. Be aware that support for HTTP Polling
 is also needed in the Jabber client. Remark also that HTTP Polling can be
 interesting to host a web-based Jabber client such as
 <A HREF="http://jwchat.sourceforge.net/">JWChat</A> (there is a tutorial to
 <A HREF="http://ejabberd.jabber.ru/jwchat">install JWChat</A> with
 instructions for <TT>ejabberd</TT>).
 <DT><B><TT>inet6</TT></B><DD> Set up the socket for IPv6.
 <DT><B><TT>{ip, IPAddress}</TT></B><DD> This option specifies which network
 interface to listen for. For example <CODE>{ip, {192, 168, 1, 1}}</CODE>.
 <DT><B><TT>{max_stanza_size, Size}</TT></B><DD> This
 option specifies an approximate maximal size in bytes of XML stanzas.
 For example <CODE>{max\_stanza\_size, 65536}</CODE>. The default value
 is ``<TT>infinity</TT>''.
 <DT><B><TT>{shaper, &lt;access rule&gt;}</TT></B><DD> This option defines a
 shaper for the port (see section&nbsp;<A HREF="#sec:configshaper">3.1.4</A>). The default value
 is ``<TT>none</TT>''.
 <DT><B><TT>ssl</TT></B><DD> This option specifies that traffic on
 the port will be encrypted using SSL. You should also set the
 <TT>certfile</TT> option. It is recommended to use the <TT>tls</TT> option
 instead.
 <DT><B><TT>starttls</TT></B><DD> This option
 specifies that STARTTLS encryption is available on connections to the port.
 You should also set the <TT>certfile</TT> option.
 <DT><B><TT>starttls_required</TT></B><DD> This option
 specifies that STARTTLS encryption is required on connections to the port.
 No unencrypted connections will be allowed. You should also set the
 <TT>certfile</TT> option.
 <DT><B><TT>tls</TT></B><DD> This option specifies that traffic on
 the port will be encrypted using SSL immediately after connecting. You
 should also set the <TT>certfile</TT> option.
 <DT><B><TT>zlib</TT></B><DD> This
 option specifies that Zlib stream compression (as defined in <A HREF="http://www.jabber.org/jeps/jep-0138.html">JEP-0138</A>)
 is available on connections to the port. Client cannot use stream compression and
 stream encryption simultaneously, so if you specify both <TT>tls</TT> (or <TT>ssl</TT>)
 and <TT>zlib</TT> the latter option will not affect connection at all.
 <DT><B><TT>web_admin</TT></B><DD> This option
 enables the web interface for <TT>ejabberd</TT> administration which is available
 at <CODE>http://server:port/admin/</CODE>. Login and password are the username and
 password of one of the registered users who are granted access by the
 ``configure'' access rule.
</DL>
Also the following global options are available for s2s connections:
<DL COMPACT=compact><DT>
 <B><TT>{s2s_use_starttls, true|false}</TT></B><DD>
 This option defines whether to use STARTTLS
 for s2s connections.
 <DT><B><TT>{s2s_certfile, Path}</TT></B><DD> Path to the
 file containing the SSL certificate.
 <DT><B><TT>{domain_certfile, Domain, Path}</TT></B><DD> Path
 to the file containing the SSL certificate for the specified domain.
</DL>
For instance, the following configuration defines that:
<UL><LI>
c2s connections are listened for on port 5222 and 5223 (SSL) and denied
 for the user ``<TT>bad</TT>''
<LI>s2s connections are listened for on port 5269 with STARTTLS for secured
 traffic enabled.
<LI>Port 5280 is serving the web interface and the HTTP Polling service. Note
 that it is also possible to serve them on different ports. The second
 example in section&nbsp;<A HREF="#sec:webadm">3.4.1</A> shows how exactly this can be done.
<LI>All users except for the administrators have a traffic of limit 
 1,000&nbsp;Bytes/second
<LI>The
 <A HREF="http://ejabberd.jabber.ru/pyaimt">AIM transport</A>
 <TT>aim.example.org</TT> is connected to port 5233 with password
 ``<TT>aimsecret</TT>''
<LI>The ICQ transport JIT (<TT>icq.example.org</TT> and
 <TT>sms.example.org</TT>) is connected to port 5234 with password
 ``<TT>jitsecret</TT>''
<LI>The
 <A HREF="http://ejabberd.jabber.ru/pymsnt">MSN transport</A>
 <TT>msn.example.org</TT> is connected to port 5235 with password
 ``<TT>msnsecret</TT>''
<LI>The
 <A HREF="http://ejabberd.jabber.ru/yahoo-transport-2">Yahoo! transport</A>
 <TT>yahoo.example.org</TT> is connected to port 5236 with password
 ``<TT>yahoosecret</TT>''
<LI>The <A HREF="http://ejabberd.jabber.ru/jabber-gg-transport">Gadu-Gadu transport</A> <TT>gg.example.org</TT> is
 connected to port 5237 with password ``<TT>ggsecret</TT>''
<LI>The
 <A HREF="http://ejabberd.jabber.ru/jmc">Jabber Mail Component</A>
 <TT>jmc.example.org</TT> is connected to port 5238 with password
 ``<TT>jmcsecret</TT>''
</UL>
<PRE>
  {acl, blocked, {user, "bad"}}.
  {access, c2s, [{deny, blocked},
                 {allow, all}]}.
  {shaper, normal, {maxrate, 1000}}.
  {access, c2s_shaper, [{none, admin},
                        {normal, all}]}.
  {listen,
   [{5222, ejabberd_c2s,     [{access, c2s}, {shaper, c2s_shaper}]},
    {5223, ejabberd_c2s,     [{access, c2s},
                              ssl, {certfile, "/path/to/ssl.pem"}]},
    {5269, ejabberd_s2s_in,  []},
    {5280, ejabberd_http,    [http_poll, web_admin]},
    {5233, ejabberd_service, [{host, "aim.example.org",
                               [{password, "aimsecret"}]}]},
    {5234, ejabberd_service, [{hosts, ["icq.example.org", "sms.example.org"],
                               [{password, "jitsecret"}]}]},
    {5235, ejabberd_service, [{host, "msn.example.org",
                               [{password, "msnsecret"}]}]},
    {5236, ejabberd_service, [{host, "yahoo.example.org",
                               [{password, "yahoosecret"}]}]},
    {5237, ejabberd_service, [{host, "gg.example.org",
                               [{password, "ggsecret"}]}]},
    {5238, ejabberd_service, [{host, "jmc.example.org",
                               [{password, "jmcsecret"}]}]}
   ]
  }.
  {s2s_use_starttls, true}.
  {s2s_certfile, "/path/to/ssl.pem"}.
</PRE>Note, that for jabberd 1.4- or WPJabber-based
services you have to make the transports log and do XDB by themselves:
<PRE>
  &lt;!--
     You have to add elogger and rlogger entries here when using ejabberd.
     In this case the transport will do the logging.
  --&gt;

  &lt;log id='logger'&gt;
    &lt;host/&gt;
    &lt;logtype/&gt;
    &lt;format&gt;%d: [%t] (%h): %s&lt;/format&gt;
    &lt;file&gt;/var/log/jabber/service.log&lt;/file&gt;
  &lt;/log&gt;

  &lt;!--
     Some Jabber server implementations do not provide
     XDB services (for example, jabberd2 and ejabberd).
     xdb_file.so is loaded in to handle all XDB requests.
  --&gt;

  &lt;xdb id="xdb"&gt;
    &lt;host/&gt;
    &lt;load&gt;
      &lt;!-- this is a lib of wpjabber or jabberd --&gt;
      &lt;xdb_file&gt;/usr/lib/jabber/xdb_file.so&lt;/xdb_file&gt;
      &lt;/load&gt;
    &lt;xdb_file xmlns="jabber:config:xdb_file"&gt;
      &lt;spool&gt;&lt;jabberd:cmdline flag='s'&gt;/var/spool/jabber&lt;/jabberd:cmdline&gt;&lt;/spool&gt;
    &lt;/xdb_file&gt;
  &lt;/xdb&gt;
</PRE>
<!--TOC subsubsection Modules-->

<H4><A NAME="htoc21">3.1.7</A>&nbsp;&nbsp;Modules</H4><!--SEC END -->

<A NAME="sec:configmodules"></A>

The option <TT>modules</TT> defines the list of modules that will be loaded after
<TT>ejabberd</TT>'s startup. Each entry in the list is a tuple in which the first
element is the name of a module and the second is a list of options for that
module. Read section&nbsp;<A HREF="#sec:modules">A</A> for detailed information about modules.<BR>
<BR>
Examples:
<UL><LI>
In this simple example, only the module <TT>mod_echo</TT> is loaded and no
 options are specified between square brackets:
 <PRE>
  {modules,
   [{mod_echo,      []}
   ]}.
</PRE><LI>The second example is also simple: the modules <TT>mod_echo</TT>, <TT>mod_time</TT>, and
 <TT>mod_version</TT> are loaded without options. Remark that, besides the last entry,
 all entries end with a comma:
 <PRE>
  {modules,
   [{mod_echo,      []},
    {mod_time,      []},
    {mod_version,   []}
   ]}.
</PRE></UL>
<!--TOC subsubsection Virtual Hosting-->

<H4><A NAME="htoc22">3.1.8</A>&nbsp;&nbsp;Virtual Hosting</H4><!--SEC END -->

<A NAME="sec:configvirtualhost"></A>

Options can be defined separately for every virtual host using the
<TT>host_config</TT> option. It has the following
syntax:
<PRE>
  {host_config, &lt;hostname&gt;, [&lt;option&gt;, &lt;option&gt;, ...]}.
</PRE>
Examples:
<UL><LI>
Domain <TT>example.net</TT> is using the internal authentication method while
 domain <TT>example.com</TT> is using the LDAP server running on the domain
 <TT>localhost</TT> to perform authentication:
<PRE>
{host_config, "example.net", [{auth_method, internal}]}.

{host_config, "example.com", [{auth_method, ldap},
                              {ldap_servers, ["localhost"]},
                              {ldap_uidattr, "uid"},
                              {ldap_rootdn, "dc=localdomain"},
                              {ldap_rootdn, "dc=example,dc=com"},
                              {ldap_password, ""}]}.
</PRE><LI>Domain <TT>example.net</TT> is using ODBC to perform authentication
 while domain <TT>example.com</TT> is using the LDAP servers running on the domains
 <TT>localhost</TT> and <TT>otherhost</TT>:
<PRE>
{host_config, "example.net", [{auth_method, odbc},
                              {odbc_server, "DSN=ejabberd;UID=ejabberd;PWD=ejabberd"}]}.

{host_config, "example.com", [{auth_method, ldap},
                              {ldap_servers, ["localhost", "otherhost"]},
                              {ldap_uidattr, "uid"},
                              {ldap_rootdn, "dc=localdomain"},
                              {ldap_rootdn, "dc=example,dc=com"},
                              {ldap_password, ""}]}.
</PRE></UL>
<!--TOC subsubsection SASL anonymous and anonymous login-->

<H4><A NAME="htoc23">3.1.9</A>&nbsp;&nbsp;SASL anonymous and anonymous login</H4><!--SEC END -->

<A NAME="sec:configsaslanonymous"></A>

The configuration of the anonymous mode can be done with three
<TT>host_config</TT> parameters:
<UL><LI> 
<TT>auth_method</TT>: This value is used for defining the authentication method:
internal, odbc, ldap, external). You now have a special extra option to enable
anonymous mode: anonymous.<BR>
<BR>
<LI><TT>allow_multiple_connections</TT>: This option can be either true or false and
is only used when the anonymous mode is enabled. Setting it to true means that
the same username will be able to be taken several time in anonymous login
mode if different resource are used to connect. This option is only useful in
very special cases. It defaults to false.<BR>
<BR>
<LI><TT>anonymous_protocol</TT>: This option can take three values:
 <TT>sasl_anon</TT>, <TT>login_anon</TT> or both. <TT>sasl_anon</TT> means that
 SASL anonymous mode is enabled. <TT>login_anon</TT> means that anonymous
 login mode is enabled. both means that SASL anonymous and login anonymous are
 enabled.
</UL>
Those options are defined for each virtual host with the <TT>host_config</TT>
parameter (see section&nbsp;<A HREF="#sec:configvirtualhost">3.1.8</A>).<BR>
<BR>
Examples:
<UL><LI>
To enable anonymous login on a virtual host:
<PRE>
{host_config, "public.example.org", [{auth_method, anonymous},
                                     {anonymous_protocol, login_anon}]}.
</PRE><LI>To enable anonymous login and internal authentication on a virtual host:
<PRE>
{host_config, "public.example.org", [{auth_method, [anonymous,internal]},
                                     {anonymous_protocol, login_anon}]}.
</PRE><LI>To enable SASL anonymous on a virtual host:
<PRE>
{host_config, "public.example.org", [{auth_method, [anonymous]},
                                     {anonymous_protocol, sasl_anon}]}.
</PRE><LI>To enable SASL anonymous and anonymous login on a virtual host:
<PRE>
{host_config, "public.example.org", [{auth_method, [anonymous]},
                                     {anonymous_protocol, both}]}.
</PRE><LI>To enable SASL anonymous, anonymous login and internal authentication on
a virtual host:
<PRE>
{host_config, "public.example.org", [{auth_method, [anonymous,internal]},
                                     {anonymous_protocol, both}]}.
</PRE></UL>
A detailled tutorial on SASL anonymous and anonymous login support is
available from:
<A HREF="http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support"><TT>http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support</TT></A><BR>
<BR>
<!--TOC subsection Relational Database Support-->

<H3><A NAME="htoc24">3.2</A>&nbsp;&nbsp;Relational Database Support</H3><!--SEC END -->

<A NAME="sec:relationaldatabase"></A>
<!--TOC subsubsection Preliminary steps-->

<H4><A NAME="htoc25">3.2.1</A>&nbsp;&nbsp;Preliminary steps</H4><!--SEC END -->

<A NAME="sec:relationaldatabasecompilation"></A>
If you have installed ejabberd using a binary version, the compilation steps
are not needed as they have already been done correctly.<BR>
<BR>
Otherwise, to be able to use ejabberd with a relational database you need to
enable ODBC modules during compilation, even if you want to use ejabberd with
MySQL or PostgreSQL in native mode. The following <TT>configure</TT> command can
be used to enable the relational modules:
<PRE>
./configure --enable-odbc
</PRE>
If you are planning to use Microsoft SQL Server with ODBC, you need to specify
it from the <TT>configure</TT> command before compilation:
<PRE>
./configure --enable-odbc --enable-mssql
</PRE>
<!--TOC subsubsection Authentication against a relational database-->

<H4><A NAME="htoc26">3.2.2</A>&nbsp;&nbsp;Authentication against a relational database</H4><!--SEC END -->

<A NAME="sec:relationaldatabaseauth"></A>
ejabberd use its internal Mnesia database as a default. It is however possible
to use relational database to store persistant, long-living data. When
switching the <TT>auth_method</TT> from internal to <TT>odbc</TT>, you are
telling ejabberd to use a relational database for authentication. Different
<TT>auth_method</TT> values can be used for different virtual hosts in the
system.<BR>
<BR>
The option value name be misleading, as the method name is use both for access
to relational database through ODBC or through the native interface. In any
case, the first step is to define the odbc <TT>auth_method</TT>. For example:
<PRE>
{host_config, "public.example.org", [{auth_method, [odbc]}]}.
</PRE>
The actual database access is defined in the option <TT>odbc_server</TT>. Its
value is use to defined if we want to use ODBC, or one of the two native
interface available, PostgreSQL or MySQL.<BR>
<BR>
To use a relational database through ODBC, you can pass the ODBC connection
string as <TT>odbc_server</TT> parameter. For example:
<PRE>
{odbc_server, "DSN=database;UID=ejabberd;PWD=password"}.
</PRE>
To use the native PostgreSQL interface, you can pass a tuple of the following form as
parameter:
<PRE>
{pgsql, "Server", "Database", "Username", "Password"}
</PRE>
<TT>pgsql</TT> is a keyword that should be kept as is. For example:
<PRE>
{odbc_server, {pgsql, "localhost", "database", "ejabberd", "password"}}.
</PRE>
Note that you need to install the Erlang PgSQL library first. This library is
available from Sourceforge: <A HREF="http://cvs.sourceforge.net/viewcvs.py/jungerl/jungerl/lib/pgsql/"><TT>http://cvs.sourceforge.net/viewcvs.py/jungerl/jungerl/lib/pgsql/</TT></A><BR>
<BR>
To use the native MySQL interface, the same tuple should be passed, except
that you now have to use the <TT>mysql</TT> keyword instead of the <TT>pgsql</TT>
keyword:
<PRE>
{mysql, "Server", "Database", "Username", "Password"}
</PRE>
<TT>mysql</TT> is a keyword that should be kept as is. For example:
<PRE>
{odbc_server, {mysql, "localhost", "test", "root", "password"}}.
</PRE>
Note that you need to install the Erlang MySQL library first. This library is
directly available from Process-one website: <A HREF="http://support.process-one.net/doc/display/CONTRIBS/Yxa"><TT>http://support.process-one.net/doc/display/CONTRIBS/Yxa</TT></A><BR>
<BR>
A detailled tutorial to set-up <TT>ejabberd</TT> using the native MySQL interface is
available from: <A HREF="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver"><TT>http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver</TT></A><BR>
<BR>
<!--TOC subsubsection Relational database for other modules-->

<H4><A NAME="htoc27">3.2.3</A>&nbsp;&nbsp;Relational database for other modules</H4><!--SEC END -->

<A NAME="sec:relationaldatabaseextra"></A>
It is possible to use a relational database to store pieces of
information. You can do this by changing the module name to a name with an
<TT>_odbc</TT> suffix in <TT>ejabberd</TT> config file. You can use a relational
database for the following data:
<UL><LI>
Last connection date and time: Use <TT>mod_last_odbc</TT> instead of
 <TT>mod_last</TT>.
<LI>Offline messages: Use <TT>mod_offline_odbc</TT> instead of
 <TT>mod_offline</TT>.
<LI>Rosters: Use <TT>mod_roster_odbc</TT> instead of <TT>mod_roster</TT>.
<LI>Users' VCARD: Use <TT>mod_vcard_odbc</TT> instead of <TT>mod_vcard</TT>.
</UL>
<!--TOC subsection Creating an Initial Administrator-->

<H3><A NAME="htoc28">3.3</A>&nbsp;&nbsp;Creating an Initial Administrator</H3><!--SEC END -->

<A NAME="sec:initialadmin"></A>
Before the web interface can be entered to perform administration tasks, an
account with administrator rights is needed on your <TT>ejabberd</TT> deployment.<BR>
<BR>
Instructions to create an initial administrator account:
<OL type=1><LI>
Register an account on your <TT>ejabberd</TT> deployment. An account can be
 created in two ways:
 <OL type=a><LI>
 Using the tool <TT>ejabberdctl</TT> (see
 section&nbsp;<A HREF="#sec:ejabberdctl">3.4.2</A>):
 <PRE>
% ejabberdctl node@host register admin example.org password
</PRE><LI>Using In-Band Registration (see section&nbsp;<A HREF="#sec:modregister">A.14</A>): you can
 use a Jabber client to register an account.
 </OL>
<LI>Edit the configuration file to promote the account created in the previous
 step to an account with administrator rights. Note that if you want to add
 more administrators, a seperate acl entry is needed for each administrator.
 <PRE>
  {acl, admins, {user, "admin", "example.org"}}.
  {access, configure, [{allow, admins}]}.
</PRE><LI>Restart <TT>ejabberd</TT> to load the new configuration.
<LI>Open the web interface (<CODE>http://server:port/admin/</CODE>) in your
 favourite browser. Make sure to enter the <EM>full</EM> JID as username (in this
 example: <TT>admin@example.org</TT>. The reason that you also need to enter the
 suffix, is because <TT>ejabberd</TT>'s virtual hosting support.
</OL>
<!--TOC subsection Online Configuration and Monitoring-->

<H3><A NAME="htoc29">3.4</A>&nbsp;&nbsp;Online Configuration and Monitoring</H3><!--SEC END -->

<A NAME="sec:onlineconfig"></A>
<!--TOC subsubsection Web Interface-->

<H4><A NAME="htoc30">3.4.1</A>&nbsp;&nbsp;Web Interface</H4><!--SEC END -->

<A NAME="sec:webadm"></A>

To perform online configuration of <TT>ejabberd</TT> you need to enable the
<TT>ejabberd_http</TT> listener with the option <TT>web_admin</TT> (see
section&nbsp;<A HREF="#sec:configlistened">3.1.6</A>). Then you can open 
<CODE>http://server:port/admin/</CODE> in your favourite web browser. You
will be asked to enter the username (the <EM>full</EM> Jabber ID) and password
of an <TT>ejabberd</TT> user with administrator rights. After authentication
you will see a page similar to figure&nbsp;<A HREF="#fig:webadmmain">1</A>.
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 
 <IMG SRC="webadmmain.png">
 

 <BR>
<DIV ALIGN=center>Figure 1: Top page from the web interface</DIV><BR>

 <A NAME="fig:webadmmain"></A>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
Here you can edit access restrictions, manage users, create backups,
manage the database, enable/disable ports listened for, view server
statistics,...<BR>
<BR>
Examples:
<UL><LI>
You can serve the web interface on the same port as the
 HTTP Polling interface. In this example
 you should point your web browser to <CODE>http://example.org:5280/admin/</CODE> to
 administer all virtual hosts or to
 <CODE>http://example.org:5280/admin/server/example.com/</CODE> to administer only
 the virtual host <TT>example.com</TT>. Before you get access to the web interface
 you need to enter as username, the JID and password from a registered user
 that is allowed to configure <TT>ejabberd</TT>. In this example you can enter as
 username ``<TT>admin@example.net</TT>'' to administer all virtual hosts (first
 URL). If you log in with ``<TT>admin@example.com</TT>'' on<BR>
<CODE>http://example.org:5280/admin/server/example.com/</CODE> you can only
 administer the virtual host <TT>example.com</TT>.
 <PRE>
  ...
  {acl, admins, {user, "admin", "example.net"}}.
  {host_config, "example.com", [{acl, admins, {user, "admin", "example.com"}}]}.
  {access, configure, [{allow, admins}]}.
  ...
  {hosts, ["example.org"]}.
  ...
  {listen,
   [...
    {5280, ejabberd_http, [http_poll, web_admin]},
    ...
   ]
  }.
</PRE><LI>For security reasons, you can serve the web interface on a secured
 connection, on a port differing from the HTTP Polling interface, and bind it
 to the internal LAN IP. The web interface will be accessible by pointing your
 web browser to <CODE>https://192.168.1.1:5280/admin/</CODE>:
 <PRE>
  ...
  {hosts, ["example.org"]}.
  ...
  {listen,
   [...
    {5270, ejabberd_http,    [http_poll]},
    {5280, ejabberd_http,    [web_admin, {ip, {192, 168, 1, 1}},
                              tls, {certfile, "/usr/local/etc/server.pem"}]},
    ...
   ]
  }.
</PRE></UL>
<!--TOC subsubsection <TT>ejabberdctl</TT>-->

<H4><A NAME="htoc31">3.4.2</A>&nbsp;&nbsp;<TT>ejabberdctl</TT></H4><!--SEC END -->

<A NAME="sec:ejabberdctl"></A>
It is possible to do some administration operations using the command
line tool <TT>ejabberdctl</TT>. You can list all available options by
running <TT>ejabberdctl</TT> without arguments:
<PRE>
% ejabberdctl
Usage: ejabberdctl node command

Available commands:
  status                        get ejabberd status
  stop                          stop ejabberd
  restart                       restart ejabberd
  reopen-log                    reopen log file
  register user server password register a user
  unregister user server        unregister a user
  backup file                   store a database backup to file
  restore file                  restore a database backup from file
  install-fallback file         install a database fallback from file
  dump file                     dump a database to a text file
  load file                     restore a database from a text file
  import-file file              import user data from jabberd 1.4 spool file
  import-dir dir                import user data from jabberd 1.4 spool directory
  registered-users              list all registered users
  delete-expired-messages       delete expired offline messages from database

Example:
  ejabberdctl ejabberd@host restart
</PRE>
Additional information:
<DL COMPACT=compact><DT>
<B><TT>reopen-log </TT></B><DD> If you use a tool to rotate logs, you have to configure it
 so that this command is executed after each rotation.
<DT><B><TT>backup, restore, install-fallback, dump, load</TT></B><DD> You can use these
 commands to create and restore backups. 
<DT><B><TT>import-file, import-dir</TT></B><DD> 
 These options can be used to migrate from other Jabber/XMPP servers. There
 exist tutorials to <A HREF="http://ejabberd.jabber.ru/jabberd1-to-ejabberd">migrate from jabberd 1.4</A>
 and to <A HREF="http://ejabberd.jabber.ru/jabberd2-to-ejabberd">migrate from jabberd2</A>.
<DT><B><TT>delete-expired-messages</TT></B><DD> This option can be used to delete old messages
 in offline storage. This might be useful when the number of offline messages
 is very high.
</DL>
<!--TOC section Firewall Settings-->

<H2><A NAME="htoc32">4</A>&nbsp;&nbsp;Firewall Settings</H2><!--SEC END -->

<A NAME="sec:firewall"></A>

You need to take the following TCP ports in mind when configuring your firewall:
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD ALIGN=left NOWRAP>Port</TD>
<TD ALIGN=left NOWRAP>Description</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>5222</TD>
<TD ALIGN=left NOWRAP>SASL and unencrypted c2s connections.</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>5223</TD>
<TD ALIGN=left NOWRAP>Obsolete SSL c2s connections.</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>5269</TD>
<TD ALIGN=left NOWRAP>s2s connections.</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>4369</TD>
<TD ALIGN=left NOWRAP>Only for clustering (see&nbsp;<A HREF="#sec:clustering">6</A>).</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>port range</TD>
<TD ALIGN=left NOWRAP>Only for clustring (see&nbsp;<A HREF="#sec:clustering">6</A>). This range
 is configurable (see&nbsp;<A HREF="#sec:starting">2.4</A>).</TD>
</TR></TABLE>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
<!--TOC section SRV Records-->

<H2><A NAME="htoc33">5</A>&nbsp;&nbsp;SRV Records</H2><!--SEC END -->

<A NAME="sec:srv"></A>

<UL><LI>
General information:
 <A HREF="http://en.wikipedia.org/wiki/SRV_record">SRV record</A>
<LI>Practical information:
 <A HREF="http://jabberd.jabberstudio.org/2/docs/section05.html#5_7">Setting DNS SRV Records</A>
</UL>
<!--TOC section Clustering-->

<H2><A NAME="htoc34">6</A>&nbsp;&nbsp;Clustering</H2><!--SEC END -->

<A NAME="sec:clustering"></A>

<!--TOC subsection How it Works-->

<H3><A NAME="htoc35">6.1</A>&nbsp;&nbsp;How it Works</H3><!--SEC END -->

<A NAME="sec:howitworks"></A>

A Jabber domain is served by one or more <TT>ejabberd</TT> nodes. These nodes can
be run on different machines that are connected via a network. They all
must have the ability to connect to port 4369 of all another nodes, and must
have the same magic cookie (see Erlang/OTP documentation, in other words the
file <TT>~ejabberd/.erlang.cookie</TT> must be the same on all nodes). This is
needed because all nodes exchange information about connected users, s2s
connections, registered services, etc...<BR>
<BR>
Each <TT>ejabberd</TT> node has the following modules:
<UL><LI>
router,
<LI>local router,
<LI>session manager,
<LI>s2s manager.
</UL>
<!--TOC subsubsection Router-->

<H4><A NAME="htoc36">6.1.1</A>&nbsp;&nbsp;Router</H4><!--SEC END -->


This module is the main router of Jabber packets on each node. It
routes them based on their destination's domains. It uses a global
routing table. The domain of the packet's destination is searched in the
routing table, and if it is found, the packet is routed to the
appropriate process. If not, it is sent to the s2s manager.<BR>
<BR>
<!--TOC subsubsection Local Router-->

<H4><A NAME="htoc37">6.1.2</A>&nbsp;&nbsp;Local Router</H4><!--SEC END -->


This module routes packets which have a destination domain equal to
one of this server's host names. If the destination JID has a non-empty user
part, it is routed to the session manager, otherwise it is processed depending
on its content.<BR>
<BR>
<!--TOC subsubsection Session Manager-->

<H4><A NAME="htoc38">6.1.3</A>&nbsp;&nbsp;Session Manager</H4><!--SEC END -->


This module routes packets to local users. It looks up to which user
resource a packet must be sent via a presence table. Then the packet is
either routed to the appropriate c2s process, or stored in offline
storage, or bounced back.<BR>
<BR>
<!--TOC subsubsection s2s Manager-->

<H4><A NAME="htoc39">6.1.4</A>&nbsp;&nbsp;s2s Manager</H4><!--SEC END -->


This module routes packets to other Jabber servers. First, it
checks if an opened s2s connection from the domain of the packet's
source to the domain of the packet's destination exists. If that is the case,
the s2s manager routes the packet to the process
serving this connection, otherwise a new connection is opened.<BR>
<BR>
<!--TOC subsection Clustering Setup-->

<H3><A NAME="htoc40">6.2</A>&nbsp;&nbsp;Clustering Setup</H3><!--SEC END -->

<A NAME="sec:cluster"></A>

Suppose you already configured <TT>ejabberd</TT> on one machine named (<TT>first</TT>),
and you need to setup another one to make an <TT>ejabberd</TT> cluster. Then do
following steps:
<OL type=1><LI>
Copy <CODE>~ejabberd/.erlang.cookie</CODE> file from <TT>first</TT> to
 <TT>second</TT>.<BR>
<BR>
(alt) You can also add ``<CODE>-cookie content_of_.erlang.cookie</CODE>''
 option to all ``<TT>erl</TT>'' commands below.<BR>
<BR>
<LI>On <TT>second</TT> run as the `<TT>ejabberd</TT>' user in the directory
 where <TT>ejabberd</TT> will work later the following command:
<PRE>
erl -sname ejabberd \
    -mnesia extra_db_nodes "['ejabberd@first']" \
    -s mnesia
</PRE>
 This will start Mnesia serving the same database as <TT>ejabberd@first</TT>.
 You can check this by running the command ``<CODE>mnesia:info().</CODE>''. You
 should see a lot of remote tables and a line like the following:
<PRE>
running db nodes   = [ejabberd@first, ejabberd@second]
</PRE><BR>
<BR>
<LI>Now run the following in the same ``<TT>erl</TT>'' session:
<PRE>
mnesia:change_table_copy_type(schema, node(), disc_copies).
</PRE>
 This will create local disc storage for the database.<BR>
<BR>
(alt) Change storage type of `<TT>scheme</TT>' table to ``RAM and disc
 copy'' on the second node via the web interface.<BR>
<BR>
<LI>Now you can add replicas of various tables to this node with
 ``<CODE>mnesia:add_table_copy</CODE>'' or
 ``<CODE>mnesia:change_table_copy_type</CODE>'' as above (just replace
 ``<CODE>schema</CODE>'' with another table name and ``<CODE>disc_copies</CODE>''
 can be replaced with ``<CODE>ram_copies</CODE>'' or
 ``<CODE>disc_only_copies</CODE>'').<BR>
<BR>
Which tables to replicate is very dependant on your needs, you can get
 some hints from the command ``<CODE>mnesia:info().</CODE>'', by looking at the
 size of tables and the default storage type for each table on 'first'.<BR>
<BR>
Replicating a table makes lookups in this table faster on this node.
 Writing, on the other hand, will be slower. And of course if machine with one
 of the replicas is down, other replicas will be used.<BR>
<BR>
Also <A HREF="http://www.erlang.se/doc/doc-5.4.9/lib/mnesia-4.2.2/doc/html/Mnesia_chap5.html#5.3">section 5.3 (Table Fragmentation) of Mnesia User's Guide</A> can be helpful.
 <BR>
<BR>
 (alt) Same as in previous item, but for other tables.<BR>
<BR>
<LI>Run ``<CODE>init:stop().</CODE>'' or just ``<CODE>q().</CODE>'' to exit from
 the Erlang shell. This probably can take some time if Mnesia has not yet
 transfered and processed all data it needed from <TT>first</TT>.<BR>
<BR>
<LI>Now run <TT>ejabberd</TT> on <TT>second</TT> with almost the same config as
 on <TT>first</TT> (you probably don't need to duplicate ``<CODE>acl</CODE>''
 and ``<CODE>access</CODE>'' options --- they will be taken from
 <TT>first</TT>, and <CODE>mod_muc</CODE> and <CODE>mod_irc</CODE> should be
 enabled only on one machine in the cluster).
</OL>
You can repeat these steps for other machines supposed to serve this
domain.<BR>
<BR>

<!--TOC section Built-in Modules-->

<H2><A NAME="htoc41">A</A>&nbsp;&nbsp;Built-in Modules</H2><!--SEC END -->

<A NAME="sec:modules"></A>

<!--TOC subsection Overview-->

<H3><A NAME="htoc42">A.1</A>&nbsp;&nbsp;Overview</H3><!--SEC END -->

<A NAME="sec:modoverview"></A>

The following table lists all modules available in the official <TT>ejabberd</TT>
distribution. You can find more
<A HREF="http://ejabberd.jabber.ru/contributions">contributed modules</A> on the
ejabberd website. Please remember that these contributions might not work or
that they can contain severe bugs and security leaks. Therefore, use them at
your own risk!<BR>
<BR>
You can see which database backend each module needs by looking at the suffix:
<UL><LI>
``_ldap'', this means that the module needs an LDAP server as backend.
<LI>``_odbc'', this means that the module needs an ODBC compatible database,
 a MySQL database, or a PostgreSQL database as backend.
<LI>Nothing, this means that the modules uses Erlang's built-in database
 Mnesia as backend.
</UL>
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD ALIGN=left NOWRAP>Module</TD>
<TD ALIGN=left NOWRAP>Feature</TD>
<TD ALIGN=left NOWRAP>Dependencies</TD>
<TD ALIGN=left NOWRAP>Needed for XMPP?</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_adhoc</TT></TD>
<TD ALIGN=left NOWRAP>Ad-Hoc Commands (<A HREF="http://www.jabber.org/jeps/jep-0050.html">JEP-0050</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_announce</TT></TD>
<TD ALIGN=left NOWRAP>Manage announcements</TD>
<TD ALIGN=left NOWRAP><TT>mod_adhoc</TT></TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_configure</TT></TD>
<TD ALIGN=left NOWRAP>Support for online</TD>
<TD ALIGN=left NOWRAP><TT>mod_adhoc</TT></TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>configuration of ejabberd</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_disco</TT></TD>
<TD ALIGN=left NOWRAP>Service Discovery (<A HREF="http://www.jabber.org/jeps/jep-0030.html">JEP-0030</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_echo</TT></TD>
<TD ALIGN=left NOWRAP>Echoes Jabber packets</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_irc</TT></TD>
<TD ALIGN=left NOWRAP>IRC transport</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_last</TT></TD>
<TD ALIGN=left NOWRAP>Last Activity (<A HREF="http://www.jabber.org/jeps/jep-0012.html">JEP-0012</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_last_odbc</TT></TD>
<TD ALIGN=left NOWRAP>Last Activity (<A HREF="http://www.jabber.org/jeps/jep-0012.html">JEP-0012</A>)</TD>
<TD ALIGN=left NOWRAP>ODBC compatible</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>database, MySQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>or PostgreSQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_muc</TT></TD>
<TD ALIGN=left NOWRAP>Multi-User Chat (<A HREF="http://www.jabber.org/jeps/jep-0045.html">JEP-0045</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_muc_log</TT></TD>
<TD ALIGN=left NOWRAP>Multi-User Chat room logging</TD>
<TD ALIGN=left NOWRAP><TT>mod_muc</TT></TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_offline</TT></TD>
<TD ALIGN=left NOWRAP>Offline message storage</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_offline_odbc</TT></TD>
<TD ALIGN=left NOWRAP>Offline message storage</TD>
<TD ALIGN=left NOWRAP>ODBC compatible</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>database, MySQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>or PostgreSQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_privacy</TT></TD>
<TD ALIGN=left NOWRAP>Blocking Communication</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>Yes</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_private</TT></TD>
<TD ALIGN=left NOWRAP>Private XML Storage (<A HREF="http://www.jabber.org/jeps/jep-0049.html">JEP-0049</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_pubsub</TT></TD>
<TD ALIGN=left NOWRAP>Publish-Subscribe (<A HREF="http://www.jabber.org/jeps/jep-0060.html">JEP-0060</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_register</TT></TD>
<TD ALIGN=left NOWRAP>In-Band Registration (<A HREF="http://www.jabber.org/jeps/jep-0077.html">JEP-0077</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_roster</TT></TD>
<TD ALIGN=left NOWRAP>Roster management</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>Yes (*)</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_roster_odbc</TT></TD>
<TD ALIGN=left NOWRAP>Roster management</TD>
<TD ALIGN=left NOWRAP>ODBC compatible</TD>
<TD ALIGN=left NOWRAP>Yes (*)</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>database, MySQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>or PostgreSQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_service_log</TT></TD>
<TD ALIGN=left NOWRAP>Copy user messages to logger service</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_shared_roster</TT></TD>
<TD ALIGN=left NOWRAP>Shared roster management</TD>
<TD ALIGN=left NOWRAP><TT>mod_roster</TT> or</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP><TT>mod_roster_odbc</TT></TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_stats</TT></TD>
<TD ALIGN=left NOWRAP>Statistics Gathering (<A HREF="http://www.jabber.org/jeps/jep-0039.html">JEP-0039</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_time</TT></TD>
<TD ALIGN=left NOWRAP>Entity Time (<A HREF="http://www.jabber.org/jeps/jep-0090.html">JEP-0090</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_vcard</TT></TD>
<TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.jabber.org/jeps/jep-0054.html">JEP-0054</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_vcard_ldap</TT></TD>
<TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.jabber.org/jeps/jep-0054.html">JEP-0054</A>)</TD>
<TD ALIGN=left NOWRAP>LDAP server</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_vcard_odbc</TT></TD>
<TD ALIGN=left NOWRAP>vcard-temp (<A HREF="http://www.jabber.org/jeps/jep-0054.html">JEP-0054</A>)</TD>
<TD ALIGN=left NOWRAP>ODBC compatible</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>database, MySQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>or PostgreSQL</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>mod_version</TT></TD>
<TD ALIGN=left NOWRAP>Software Version (<A HREF="http://www.jabber.org/jeps/jep-0092.html">JEP-0092</A>)</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
<TD ALIGN=left NOWRAP>No</TD>
</TR></TABLE>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
(*) This module or a similar one with another database backend is needed for
XMPP compliancy.<BR>
<BR>
<!--TOC subsection Common Options-->

<H3><A NAME="htoc43">A.2</A>&nbsp;&nbsp;Common Options</H3><!--SEC END -->

<A NAME="sec:modcommonopts"></A>
The following options are used by many modules. Therefore, they are described in
this separate section.<BR>
<BR>
<!--TOC subsubsection <TT>iqdisc</TT>-->

<H4><A NAME="htoc44">A.2.1</A>&nbsp;&nbsp;<TT>iqdisc</TT></H4><!--SEC END -->

<A NAME="sec:modiqdiscoption"></A>

Many modules define handlers for processing IQ queries of different namespaces
to this server or to a user (e.&nbsp;g. to <TT>example.org</TT> or to
<TT>user@example.org</TT>). This option defines processing discipline for
these queries. Possible values are:
<DL COMPACT=compact><DT>
<B><TT>no_queue</TT></B><DD> All queries of a namespace with this processing discipline are
 processed immediately. This also means that no other packets can be processed
 until this one has been completely processed. Hence this discipline is not
 recommended if the processing of a query can take a relatively long time.
<DT><B><TT>one_queue</TT></B><DD> In this case a separate queue is created for the processing
 of IQ queries of a namespace with this discipline. In addition, the processing
 of this queue is done in parallel with that of other packets. This discipline
 is most recommended.
<DT><B><TT>parallel</TT></B><DD> For every packet with this discipline a separate Erlang process
 is spawned. Consequently, all these packets are processed in parallel.
 Although spawning of Erlang process has a relatively low cost, this can break
 the server's normal work, because the Erlang emulator has a limit on the
 number of processes (32000 by default).
</DL>
Example:
<PRE>
  {modules,
   [
    ...
    {mod_time, [{iqdisc, no_queue}]},
    ...
   ]}.
</PRE>
<!--TOC subsubsection <TT>hosts</TT>-->

<H4><A NAME="htoc45">A.2.2</A>&nbsp;&nbsp;<TT>hosts</TT></H4><!--SEC END -->

<A NAME="sec:modhostsoption"></A>

A module acting as a service can have one or more hostnames. These hostnames
can be defined with the <TT>hosts</TT> option.<BR>
<BR>
Examples:
<UL><LI>
Serving the echo module on one domain:
 <UL><LI>
 <PRE>
  {modules,
   [
    ...
    {mod_echo, [{hosts, ["echo.example.org"]}]},
    ...
   ]}.
</PRE><LI>Backwards compatibility with older ejabberd versions can be retained
 with:
 <PRE>
  {modules,
   [
    ...
    {mod_echo, [{host, "echo.example.org"}]},
    ...
   ]}.
</PRE></UL>
 <LI>Serving the echo module on two domains:
 <PRE>
  {modules,
   [
    ...
    {mod_echo, [{hosts, ["echo.example.net", "echo.example.com"]}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_announce</TT>-->

<H3><A NAME="htoc46">A.3</A>&nbsp;&nbsp;<TT>mod_announce</TT></H3><!--SEC END -->

<A NAME="sec:modannounce"></A>

This module enables configured users to broadcast announcements and to set
the message of the day (MOTD). Configured users can do these actions with their
Jabber client by sending messages to specific JIDs. These JIDs are listed in
next paragraph. The first JID in each entry will apply only to the virtual host
<TT>example.org</TT>, while the JID between brackets will apply to all virtual
hosts:
<DL COMPACT=compact><DT>
<B><TT>example.org/announce/all (example.org/announce/all-hosts/all)</TT></B><DD> The
 message is sent to all registered users. If the user is online and connected
 to several resources, only the resource with the highest priority will receive
 the message. If the registered user is not connected, the message will be
 stored offline in assumption that offline storage
 (see section&nbsp;<A HREF="#sec:modoffline">A.10</A>) is enabled.
<DT><B><TT>example.org/announce/online (example.org/announce/all-hosts/online)</TT></B><DD>The
 message is sent to all connected users. If the user is online and connected
 to several resources, all resources will receive the message.
<DT><B><TT>example.org/announce/motd (example.org/announce/all-hosts/motd)</TT></B><DD>The
 message is set as the message of the day (MOTD) and is sent to users when they
 login. In addition the message is sent to all connected users (similar to
 <TT>announce/online</TT>).
<DT><B><TT>example.org/announce/motd/update (example.org/announce/all-hosts/motd/update)</TT></B><DD>
 The message is set as message of the day (MOTD) and is sent to users when they
 login. The message is <EM>not sent</EM> to any currently connected user.
<DT><B><TT>example.org/announce/motd/delete (example.org/announce/all-hosts/motd/delete)</TT></B><DD>
 Any message sent to this JID removes the existing message of the day (MOTD).
</DL>
Options:
<DL COMPACT=compact><DT>
<B><TT>access</TT></B><DD> This option specifies who is allowed to
 send announcements and to set the message of the day (by default, nobody is
 able to send such messages).
</DL>
Examples:
<UL><LI>
Only administrators can send announcements:
 <PRE>
  {access, announce, [{allow, admins}]}.

  {modules,
   [
    ...
    {mod_announce, [{access, announce}]},
    ...
   ]}.
</PRE><LI>Administrators as well as the direction can send announcements:
 <PRE>
  {acl, direction, {user, "big_boss", "example.org"}}.
  {acl, direction, {user, "assistant", "example.org"}}.
  {acl, admins, {user, "admin", "example.org"}}.
  ...
  {access, announce, [{allow, admins},
                      {allow, direction}]}.
  ...
  {modules,
   [
    ...
    {mod_announce, [{access, announce}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_disco</TT>-->

<H3><A NAME="htoc47">A.4</A>&nbsp;&nbsp;<TT>mod_disco</TT></H3><!--SEC END -->

<A NAME="sec:moddisco"></A>

This module adds support for Service Discovery (<A HREF="http://www.jabber.org/jeps/jep-0030.html">JEP-0030</A>). With
this module enabled, services on your server can be discovered by
Jabber clients. Note that <TT>ejabberd</TT> has no modules with support
for the superseded Jabber Browsing (<A HREF="http://www.jabber.org/jeps/jep-0011.html">JEP-0011</A>) and Agent Information
(<A HREF="http://www.jabber.org/jeps/jep-0094.html">JEP-0094</A>). Accordingly, Jabber clients need to have support for
the newer Service Discovery protocol if you want them be able to discover
the services you offer.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Service Discovery (<TT>http://jabber.org/protocol/disco#items</TT> and
 <TT>http://jabber.org/protocol/disco#info</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
<DT><B><TT>extra_domains</TT></B><DD> With this option,
 extra domains can be added to the Service Discovery item list.
</DL>
Examples:
<UL><LI>
To serve a link to the Jabber User Directory on <TT>jabber.org</TT>:
 <PRE>
  {modules,
   [
    ...
    {mod_disco, [{extra_domains, ["users.jabber.org"]}]},
    ...
   ]}.
</PRE><LI>To serve a link to the transports on another server:
 <PRE>
  {modules,
   [
    ...
    {mod_disco, [{extra_domains, ["icq.example.com",
                                  "msn.example.com"]}]},
    ...
   ]}.
</PRE><LI>To serve a link to a few friendly servers:
 <PRE>
  {modules,
   [
    ...
    {mod_disco, [{extra_domains, ["example.org",
                                  "example.com"]}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_echo</TT>-->

<H3><A NAME="htoc48">A.5</A>&nbsp;&nbsp;<TT>mod_echo</TT></H3><!--SEC END -->

<A NAME="sec:modecho"></A>

This module simply echoes any Jabber
packet back to the sender. This mirror can be of interest for
<TT>ejabberd</TT> and Jabber client debugging.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>echo.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

</DL>
Examples:
<UL><LI>
Mirror, mirror, on the wall, who is the most beautiful
 of them all?
 <PRE>
  {modules,
   [
    ...
    {mod_echo, [{hosts, ["mirror.example.org"]}]},
    ...
   ]}.
</PRE><LI>If you still do not understand the inner workings of <TT>mod_echo</TT>,
 you can find a few more examples in section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>.
</UL>
<!--TOC subsection <TT>mod_irc</TT>-->

<H3><A NAME="htoc49">A.6</A>&nbsp;&nbsp;<TT>mod_irc</TT></H3><!--SEC END -->

<A NAME="sec:modirc"></A>

This module is an IRC transport that can be used to join channels on IRC
servers.<BR>
<BR>
End user information:

<UL><LI>
A Jabber client with ``groupchat 1.0'' support or Multi-User
 Chat support (<A HREF="http://www.jabber.org/jeps/jep-0045.html">JEP-0045</A>) is necessary to join IRC channels.
<LI>An IRC channel can be joined in nearly the same way as joining a
 Jabber Multi-User Chat room. The difference is that the room name will
 be ``channel%<TT>irc.example.org</TT>'' in case <TT>irc.example.org</TT> is
 the IRC server hosting ``channel''. And of course the host should point
 to the IRC transport instead of the Multi-User Chat service.
<LI>You can register your nickame by sending ``IDENTIFY password'' to<BR>
<TT>nickserver!irc.example.org@irc.jabberserver.org</TT>.
<LI>Entering your password is possible by sending ``LOGIN nick password''<BR>
to <TT>nickserver!irc.example.org@irc.jabberserver.org</TT>.
<LI>When using a popular Jabber server, it can occur that no
 connection can be achieved with some IRC servers because they limit the
 number of conections from one IP.
</UL>
Options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>irc.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

<DT><B><TT>access</TT></B><DD> This option can be used to specify who
 may use the IRC transport (default value: <TT>all</TT>).
</DL>
Examples:
<UL><LI>
In the first example, the IRC transport is available on (all) your
 virtual host(s) with the prefix ``<TT>irc.</TT>''. Furthermore, anyone is
 able to use the transport.
 <PRE>
  {modules,
   [
    ...
    {mod_irc, [{access, all}]},
    ...
   ]}.
</PRE><LI>In next example the IRC transport is available on the two virtual hosts
 <TT>example.net</TT> and <TT>example.com</TT> with different prefixes on each host.
 Moreover, the transport is only accessible by paying customers registered on
 our domains and on other servers.
 <PRE>
  {acl, paying_customers, {user, "customer1", "example.net"}}.
  {acl, paying_customers, {user, "customer2", "example.com"}}.
  {acl, paying_customers, {user, "customer3", "example.org"}}.
  ...
  {access, paying_customers, [{allow, paying_customers},
                              {deny, all}]}.
  ...
  {modules,
   [
    ...
    {mod_irc, [{access, paying_customers},
               {hosts, ["irc.example.net", "irc-transport.example.com"]}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_last</TT>-->

<H3><A NAME="htoc50">A.7</A>&nbsp;&nbsp;<TT>mod_last</TT></H3><!--SEC END -->

<A NAME="sec:modlast"></A>

This module adds support for Last Activity (<A HREF="http://www.jabber.org/jeps/jep-0012.html">JEP-0012</A>). It can be used to
discover when a disconnected user last accessed the server, to know when a
connected user was last active on the server, or to query the uptime of the
<TT>ejabberd</TT> server.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Last activity (<TT>jabber:iq:last</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC subsection <TT>mod_muc</TT>-->

<H3><A NAME="htoc51">A.8</A>&nbsp;&nbsp;<TT>mod_muc</TT></H3><!--SEC END -->

<A NAME="sec:modmuc"></A>

With this module enabled, your server will support Multi-User Chat
(<A HREF="http://www.jabber.org/jeps/jep-0045.html">JEP-0045</A>). End users will be able to join text conferences. Notice
that this module is not (yet) clusterable.<BR>
<BR>
Some of the features of Multi-User Chat:
<UL><LI>
Sending private messages to room participants.
<LI>Inviting users.
<LI>Setting a conference topic.
<LI>Creating password protected rooms.
<LI>Kicking and banning participants.
</UL>
Options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>conference.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

<DT><B><TT>access</TT></B><DD> You can specify who is allowed to use
 the Multi-User Chat service (by default, everyone is allowed to use it).
<DT><B><TT>access_create</TT></B><DD> To configure who is
 allowed to create new rooms at the Multi-User Chat service, this option
 can be used (by default, everybody is allowed to create rooms).
<DT><B><TT>access_admin</TT></B><DD> This option specifies
 who is allowed to administrate the Multi-User Chat service (the default
 value is <TT>none</TT>, which means that only the room creator can
 administer his room). By sending a message to the service JID,
 administrators can send service messages that will be displayed in every
 active room.<BR>
<BR>
<DT><B><TT>history_size</TT></B><DD> a small history of the
 current discussion is send to users when they enter the room. This option make
 it possible to define the number of history messages to keep and send to the
 user joining the room. The value is a integer. Setting the value to <TT>0</TT>
 disable the history feature and nothing is kept in memory. The default value
 is <TT>20</TT>. This value is global and affects all MUC rooms on the server.
</DL>
Examples:
<UL><LI>
In the first example everyone is allowed to use the Multi-User Chat
 service. Everyone will also be able to create new rooms but only the user
 <TT>admin@example.org</TT> is allowed to administrate any room. In this
 example he is also a global administrator. When <TT>admin@example.org</TT>
 sends a message such as ``Tomorrow, the Jabber server will be moved
 to new hardware. This will involve service breakdowns around 23:00 UMT.
 We apologise for this inconvenience.'' to <TT>conference.example.org</TT>,
 it will be displayed in all active rooms. In this example the history
 feature is disabled.
 <PRE>
  {acl, admins, {user, "admin", "example.org"}}.
  ...
  {access, muc_admins, [{allow, admins}]}.
  ...
  {modules,
   [
    ...
    {mod_muc, [{access, all},
               {access_create, all},
               {access_admin, muc_admins},
               {history_size, 0}]},
    ...
   ]}.
</PRE><LI>In the second example the Multi-User Chat service is only accessible by
 paying customers registered on our domains and on other servers. Of course
 the administrator is also allowed to access rooms. In addition, he is the
 only authority able to create and administer rooms. When
 <TT>admin@example.org</TT> sends a message such as ``Tomorrow, the Jabber
 server will be moved to new hardware. This will involve service breakdowns
 around 23:00 UMT. We apologise for this inconvenience.'' to
 <TT>conference.example.org</TT>, it will be displayed in all active rooms. No
 <TT>history_size</TT> option is used, this means that the feature is enabled
 and the default value of 20 history messages will be send to the users.
 <PRE>
  {acl, paying_customers, {user, "customer1", "example.net"}}.
  {acl, paying_customers, {user, "customer2", "example.com"}}.
  {acl, paying_customers, {user, "customer3", "example.org"}}.
  {acl, admins, {user, "admin", "example.org"}}.
  ...
  {access, muc_admins, [{allow, admins},
                        {deny, all}]}.
  {access, muc_access, [{allow, paying_customers},
                        {allow, admins},
                        {deny, all}]}.
  ...
  {modules,
   [
    ...
    {mod_muc, [{access, muc_access},
               {access_create, muc_admins},
               {access_admin, muc_admins}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_muc_log</TT>-->

<H3><A NAME="htoc52">A.9</A>&nbsp;&nbsp;<TT>mod_muc_log</TT></H3><!--SEC END -->

<A NAME="sec:modmuclog"></A>

This module enables optional logging of Multi-User Chat conversations to HTML.
Once you enable this module, join a chatroom with enought privileges using a MUC capable Jabber client,
request the configuration form and there you will have an option to enable chatroom logging.<BR>
<BR>
Some of the features of generated logs:
<UL><LI>
A lot of information about chatroom is added on top of the page: Room title, JID, subject author, subject and configuration.
<LI>Room title and JID are links to join the chatroom (using XMPP-IRI).
<LI>Subject and chatroom configuration changes are tracked and displayed.
<LI>Joins, leaves, nick changes, kicks, bans and /me are tracked and displayed, including the reason when available.
<LI>Generated HTML files are XHTML 1.0 Transitional and CSS compliant.
<LI>Timestamps are self-referencing links.
<LI>Links on top for quicker navigation: Previous day, Next day, Up.
<LI>CSS is used for style definition, and a custom CSS file can be used.
<LI>URLs on messages and subjects are converted to hyperlinks.
<LI>Timezone used on timestamps is shown on the log files.
<LI>A custom link can be added on top of page.
</UL>
Options:
<DL COMPACT=compact><DT>
<B><TT>access_log</TT></B><DD>
 Restricts which users are allowed to enable or disable chatroom logging using ACL and ACCESS.
 Default: <TT>muc_admin</TT>.
 If you want to allow any chatroom owner put: <TT>muc</TT>.
<DT><B><TT>cssfile</TT></B><DD>
 If HTMLs will use a custom CSS file or the embedded one.
 Allowed values:
 <TT>false</TT>: HTMLs will include the standard CSS code;
 <TT>"CSS-URL"</TT>: the URL of the CSS file (for example: "http://example.com/my.css").
 Default: <TT>false</TT>.
<DT><B><TT>dirtype</TT></B><DD>
 Type of directory that will be created.
	Allowed values: 
		<TT>subdirs</TT>: creates subdirectories for year and month; 
 <TT>plain</TT>: the filename contains the full date, no subdirs.
 Default: <TT>subdirs</TT>.
<DT><B><TT>outdir</TT></B><DD>
 Full path to the directory where html will be generated.
 Make sure the system user has write access on that directory. 
 Default: <TT>"www/muc"</TT>.
<DT><B><TT>timezone</TT></B><DD>
 What timezone should be used.
 Allowed values:
		<TT>local</TT>: use local time, as reported to Erlang by the operating system;
 <TT>universal</TT>: use GMT/UTC time.
 Default: <TT>local</TT>.
<DT><B><TT>top_link</TT></B><DD>
 Customizable link on top right corner. Syntax of this option: <TT>{"URL", "Text"}</TT>.
 Default: <TT>{"/", "Home"}</TT>.
</DL>
Example configuration:
<PRE>
  {modules,
   [
    ...
    {mod_muc_log, [
               {access_log, muc},
               {cssfile, "http://example.com/my.css"},
               {dirtype, plain},
               {outdir, "/var/www/muclogs"},
               {timezone, universal},
               {top_link, {"http://www.jabber.ru", "Jabber.ru"}}
    ]},
    ...
   ]}.
</PRE>
<!--TOC subsection <TT>mod_offline</TT>-->

<H3><A NAME="htoc53">A.10</A>&nbsp;&nbsp;<TT>mod_offline</TT></H3><!--SEC END -->

<A NAME="sec:modoffline"></A>

This module implements offline message storage. This means that all messages
sent to an offline user will be stored on the server until that user comes
online again. Thus it is very similar to how email works. Note that
<TT>ejabberdctl</TT> has a command to delete expired messages
(see section&nbsp;<A HREF="#sec:ejabberdctl">3.4.2</A>).<BR>
<BR>
<!--TOC subsection <TT>mod_privacy</TT>-->

<H3><A NAME="htoc54">A.11</A>&nbsp;&nbsp;<TT>mod_privacy</TT></H3><!--SEC END -->

<A NAME="sec:modprivacy"></A>

This module implements Blocking Communication (also known as Privacy Rules)
as defined in section 10 from XMPP IM. If end users have support for it in
their Jabber client, they will be able to:
<BLOCKQUOTE>
<UL><LI>
Retrieving one's privacy lists. 
<LI>Adding, removing, and editing one's privacy lists. 
<LI>Setting, changing, or declining active lists. 
<LI>Setting, changing, or declining the default list (i.e., the list that
 is active by default). 
<LI>Allowing or blocking messages based on JID, group, or subscription type
 (or globally). 
<LI>Allowing or blocking inbound presence notifications based on JID, group,
 or subscription type (or globally). 
<LI>Allowing or blocking outbound presence notifications based on JID, group,
 or subscription type (or globally). 
<LI>Allowing or blocking IQ stanzas based on JID, group, or subscription type
 (or globally). 
<LI>Allowing or blocking all communications based on JID, group, or
 subscription type (or globally).
</UL>
(from <A HREF="http://www.xmpp.org/specs/rfc3921.html#privacy"><TT>http://www.xmpp.org/specs/rfc3921.html#privacy</TT></A>)
</BLOCKQUOTE>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Blocking Communication (<TT>jabber:iq:privacy</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC subsection <TT>mod_private</TT>-->

<H3><A NAME="htoc55">A.12</A>&nbsp;&nbsp;<TT>mod_private</TT></H3><!--SEC END -->

<A NAME="sec:modprivate"></A>

This module adds support for Private XML Storage (<A HREF="http://www.jabber.org/jeps/jep-0049.html">JEP-0049</A>):
<BLOCKQUOTE>
Using this method, Jabber entities can store private data on the server and
retrieve it whenever necessary. The data stored might be anything, as long as
it is valid XML. One typical usage for this namespace is the server-side storage
of client-specific preferences; another is Bookmark Storage (<A HREF="http://www.jabber.org/jeps/jep-0048.html">JEP-0048</A>).
</BLOCKQUOTE>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Private XML Storage (<TT>jabber:iq:private</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC subsection <TT>mod_pubsub</TT>-->

<H3><A NAME="htoc56">A.13</A>&nbsp;&nbsp;<TT>mod_pubsub</TT></H3><!--SEC END -->

<A NAME="sec:modpubsub"></A>

This module offers a Publish-Subscribe Service (<A HREF="http://www.jabber.org/jeps/jep-0060.html">JEP-0060</A>).
Publish-Subscribe can be used to develop (examples are taken from the JEP):
<BLOCKQUOTE>
<UL><LI>
news feeds and content syndacation,
<LI>avatar management,
<LI>shared bookmarks,
<LI>auction and trading systems,
<LI>online catalogs,
<LI>workflow systems,
<LI>network management systems,
<LI>NNTP gateways,
<LI>vCard/profile management,
<LI>and weblogs.
</UL>
</BLOCKQUOTE> 

Another example is <A HREF="http://www.process-one.net/en/projects/j-eai/">J-EAI</A>.
This is an XMPP-based Enterprise Application Integration (EAI) platform (also
known as ESB, the Enterprise Service Bus). The J-EAI project builts upon
<TT>ejabberd</TT>'s codebase and has contributed several features to <TT>mod_pubsub</TT>.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>pubsub.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

<DT><B><TT>served_hosts</TT></B><DD> To specify which hosts needs to
 be served, you can use this option. If absent, only the main <TT>ejabberd</TT>
 host is served. <DT><B><TT>access_createnode</TT></B><DD> 
 Restricts which users are allowed to create pubsub nodes using ACL and ACCESS.
 Default: <TT>pubsub_createnode</TT>.
</DL>
Example:
<PRE>
  {modules,
   [
    ...
    {mod_pubsub, [{served_hosts, ["example.com",
                                  "example.org"]},
                  {access_createnode, pubsub_createnode}]}
    ...
   ]}.
</PRE>
<!--TOC subsection <TT>mod_register</TT>-->

<H3><A NAME="htoc57">A.14</A>&nbsp;&nbsp;<TT>mod_register</TT></H3><!--SEC END -->

<A NAME="sec:modregister"></A>

This module adds support for In-Band Registration (<A HREF="http://www.jabber.org/jeps/jep-0077.html">JEP-0077</A>). This protocol
enables end users to use a Jabber client to:
<UL><LI>
Register a new account on the server.
<LI>Change the password from an existing account on the server.
<LI>Delete an existing account on the server.
</UL>
Options:
<DL COMPACT=compact><DT>
<B><TT>access</TT></B><DD> This option can be configured to specify
 rules to restrict registration. If a rule returns ``deny'' on the requested
 user name, registration for that user name is dennied. (there are no
 restrictions by default).
<DT><B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for In-Band Registration (<TT>jabber:iq:register</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
Examples:
<UL><LI>
Next example prohibits the registration of too short account names:
<PRE>
  {acl, shortname, {user_glob, "?"}}.
  {acl, shortname, {user_glob, "??"}}.
  % The same using regexp:
  %{acl, shortname, {user_regexp, "^..?$"}}.
  ...
  {access, register, [{deny, shortname},
                      {allow, all}]}.
  ...
  {modules,
   [
    ...
    {mod_register, [{access, register}]},
    ...
   ]}.
</PRE><LI>The in-band registration of new accounts can be prohibited by changing the
 <TT>access</TT> option. If you really want to disable all In-Band Registration
 functionality, that is changing passwords in-band and deleting accounts
 in-band, you have to remove <TT>mod_register</TT> from the modules list. In this
 example all In-Band Registration functionality is disabled:
 <PRE>
  {access, register, [{deny, all}]}.

  {modules,
   [
    ...
%    {mod_register, [{access, register}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_roster</TT>-->

<H3><A NAME="htoc58">A.15</A>&nbsp;&nbsp;<TT>mod_roster</TT></H3><!--SEC END -->

<A NAME="sec:modroster"></A>

This module implements roster management as defined in <A HREF="http://www.xmpp.org/specs/rfc3921.html#roster">RFC 3921: XMPP IM</A>.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Roster Management (<TT>jabber:iq:roster</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC subsection <TT>mod_service_log</TT>-->

<H3><A NAME="htoc59">A.16</A>&nbsp;&nbsp;<TT>mod_service_log</TT></H3><!--SEC END -->

<A NAME="sec:modservicelog"></A>

This module adds support for logging end user packets via a Jabber message
auditing service such as
<A HREF="http://www.funkypenguin.co.za/bandersnatch/">Bandersnatch</A>. All user
packets are encapsulated in a <CODE>&lt;route/&gt;</CODE> element and sent to the specified
service(s).<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>loggers</TT></B><DD> With this option a (list of) service(s)
 that will receive the packets can be specified.
</DL>
Examples:
<UL><LI>
To log all end user packets to the Bandersnatch service running on
 <TT>bandersnatch.example.com</TT>:
 <PRE>
  {modules,
   [
    ...
    {mod_service_log, [{loggers, ["bandersnatch.example.com"]}]},
    ...
   ]}.
</PRE><LI>To log all end user packets to the Bandersnatch service running on
 <TT>bandersnatch.example.com</TT> and the backup service on 
 <TT>bandersnatch.example.org</TT>:
 <PRE>
  {modules,
   [
    ...
    {mod_service_log, [{loggers, ["bandersnatch.example.com",
                                  "bandersnatch.example.org"]}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection <TT>mod_shared_roster</TT>-->

<H3><A NAME="htoc60">A.17</A>&nbsp;&nbsp;<TT>mod_shared_roster</TT></H3><!--SEC END -->

<A NAME="sec:modsharedroster"></A>

This module enables you to create shared roster groups. This means that you can
create groups of people that can see members from (other) groups in their
rosters. The big advantages of this feature are that end users do not need to
manually add all users to their rosters, and that they cannot permanently delete
users from the shared roster groups.<BR>
<BR>
Shared roster groups can be edited <EM>only</EM> via the web interface. Each group
has a unique identification and the following parameters:
<DL COMPACT=compact><DT>
<B>Name</B><DD> The name of the group, which will be displayed in the roster.
<DT><B>Description</B><DD> The description of the group. This parameter doesn't affect
 anything.
<DT><B>Members</B><DD> A list of full JIDs of group members, entered one per line in
 the web interface.
<DT><B>Displayed groups</B><DD> A list of groups that will be in the rosters of this
 group's members.
</DL>
Examples:
<UL><LI>
Take the case of a computer club that wants all its members seeing each
 other in their rosters. To achieve this, they need to create a shared roster
 group similar to next table:
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD ALIGN=left NOWRAP>Identification</TD>
<TD ALIGN=left NOWRAP>Group `<TT>club_members</TT>'</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Name</TD>
<TD ALIGN=left NOWRAP>Club Members</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Description</TD>
<TD ALIGN=left NOWRAP>Members from the computer club</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Members</TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>member1@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>member2@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>member3@example.org</TT></TD>
</TR></TABLE></TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Displayed groups</TD>
<TD ALIGN=left NOWRAP><TT>club_members</TT></TD>
</TR></TABLE>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
<LI>In another case we have a company which has three divisions: Management,
 Marketing and Sales. All group members should see all other members in their
 rosters. Additonally, all managers should have all marketing and sales people
 in their roster. Simultaneously, all marketeers and the whole sales team
 should see all managers. This scenario can be achieved by creating shared
 roster groups as shown in the following table:
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD ALIGN=left NOWRAP>Identification</TD>
<TD ALIGN=left NOWRAP>Group `<TT>management</TT>'</TD>
<TD ALIGN=left NOWRAP>Group `<TT>marketing</TT>'</TD>
<TD ALIGN=left NOWRAP>Group `<TT>sales</TT>'</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Name</TD>
<TD ALIGN=left NOWRAP>Management</TD>
<TD ALIGN=left NOWRAP>Marketing</TD>
<TD ALIGN=left NOWRAP>Sales</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Description</TD>
<TD ALIGN=left NOWRAP>&nbsp;</TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Members</TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>manager1@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>manager2@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>manager3@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>manager4@example.org</TT></TD>
</TR></TABLE>
 </TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>marketeer1@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>marketeer2@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>marketeer3@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>marketeer4@example.org</TT></TD>
</TR></TABLE>
 </TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>saleswoman1@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>salesman1@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>saleswoman2@example.org</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>salesman2@example.org</TT></TD>
</TR></TABLE></TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Displayed groups</TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>management</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>marketing</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>sales</TT></TD>
</TR></TABLE>
 </TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>management</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>marketing</TT></TD>
</TR></TABLE>
 </TD>
<TD ALIGN=left NOWRAP><TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP><TT>management</TT></TD>
</TR>
<TR><TD ALIGN=left NOWRAP><TT>sales</TT></TD>
</TR></TABLE></TD>
</TR></TABLE>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
</UL>
<!--TOC subsection <TT>mod_stats</TT>-->

<H3><A NAME="htoc61">A.18</A>&nbsp;&nbsp;<TT>mod_stats</TT></H3><!--SEC END -->

<A NAME="sec:modstats"></A>

This module adds support for Statistics Gathering (<A HREF="http://www.jabber.org/jeps/jep-0039.html">JEP-0039</A>). This protocol
allows you to retrieve next statistics from your <TT>ejabberd</TT> deployment:
<UL><LI>
Total number of registered users on the current virtual host (users/total).
<LI>Total number of registered users on all virtual hosts (users/all-hosts/total).
<LI>Total number of online users on the current virtual host (users/online).
<LI>Total number of online users on all virtual hosts (users/all-hosts/online).
</UL>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Statistics Gathering (<TT>http://jabber.org/protocol/stats</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
As there are only a small amount of clients (for example
<A HREF="http://tkabber.jabber.ru/">Tkabber</A>) and software libraries with
support for this JEP, a few examples are given of the XML you need to send
in order to get the statistics. Here they are:
<UL><LI>
You can request the number of online users on the current virtual host
 (<TT>example.org</TT>) by sending:
 <PRE>
&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/online'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</PRE><LI>You can request the total number of registered users on all virtual hosts
 by sending:
 <PRE>
&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/all-hosts/total'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</PRE></UL>
<!--TOC subsection <TT>mod_time</TT>-->

<H3><A NAME="htoc62">A.19</A>&nbsp;&nbsp;<TT>mod_time</TT></H3><!--SEC END -->

<A NAME="sec:modtime"></A>

This module features support for Entity Time (<A HREF="http://www.jabber.org/jeps/jep-0090.html">JEP-0090</A>). By using this JEP,
you are able to discover the time at another entity's location.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Entity Time (<TT>jabber:iq:time</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC subsection <TT>mod_vcard</TT>-->

<H3><A NAME="htoc63">A.20</A>&nbsp;&nbsp;<TT>mod_vcard</TT></H3><!--SEC END -->

<A NAME="sec:modvcard"></A>

This module allows end users to store and retrieve their vCard, and to retrieve
other users vCards, as defined in vcard-temp (<A HREF="http://www.jabber.org/jeps/jep-0054.html">JEP-0054</A>). The module also
implements an uncomplicated Jabber User Directory based on the vCards of
these users. Moreover, it enables the server to send its vCard when queried.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>vjud.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

<DT><B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for <TT>vcard-temp</TT> IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
<DT><B><TT>search</TT></B><DD> This option specifies whether the search
 functionality is enabled (value: <TT>true</TT>) or disabled
 (value: <TT>false</TT>). If disabled, the option <TT>hosts</TT> will be
 ignored and the Jabber User Directory service will not appear in the
 Service Discovery item list. The default value is <TT>true</TT>.
<DT><B><TT>matches</TT></B><DD> With this option, the number of reported
 search results can be limited. If the option's value is set to <TT>infinity</TT>,
 all search results are reported. The default value is <TT>30</TT>.
<DT><B><TT>allow_return_all</TT></B><DD> This option enables
 you to specify if search operations with empty input fields should return
 all users who added some information to their vCard. The default value is
 <TT>false</TT>.
<DT><B><TT>search_all_hosts</TT></B><DD> If this option is
 set to <TT>true</TT>, search operations will apply to all virtual hosts.
 Otherwise only the current host will be searched. The default value is
 <TT>true</TT>.
</DL>
Examples:
<UL><LI>
In this first situation, search results are limited to twenty items,
 every user who added information to their vCard will be listed when people
 do an empty search, and only users from the current host will be returned:
 <PRE>
  {modules,
   [
    ...
    {mod_vcard, [{search, true},
                 {matches, 20},
                 {allow_return_all, true},
                 {search_all_hosts, false}]},
    ...
   ]}.
</PRE><LI>The second situation differs in a way that search results are not limited,
 and that all virtual hosts will be searched instead of only the current one:
 <PRE>
  {modules,
   [
    ...
    {mod_vcard, [{search, true},
                 {matches, infinity},
                 {allow_return_all, true}]},
    ...
   ]}.
</PRE></UL>
<!--TOC subsection LDAP and <TT>mod_vcard_ldap</TT>-->

<H3><A NAME="htoc64">A.21</A>&nbsp;&nbsp;LDAP and <TT>mod_vcard_ldap</TT></H3><!--SEC END -->

<A NAME="sec:ldap"></A>

<!--TOC subsubsection Features-->

<H4><A NAME="htoc65">A.21.1</A>&nbsp;&nbsp;Features</H4><!--SEC END -->

<A NAME="sec:ldapfeatures"></A>
<TT>ejabberd</TT> has built-in LDAP support. You can authenticate users against LDAP
server and use LDAP directory as vCard storage. Shared rosters are not
supported yet.<BR>
<BR>
<!--TOC subsubsection Connection-->

<H4><A NAME="htoc66">A.21.2</A>&nbsp;&nbsp;Connection</H4><!--SEC END -->

<A NAME="sec:ldapconnection"></A>
Parameters:
<DL COMPACT=compact><DT>
<B><TT>ldap_server</TT></B><DD> IP address or dns name of your
LDAP server. This option is required.
<DT><B><TT>ldap_port</TT></B><DD> Port to connect to LDAP server.
Default is&nbsp;389.
<DT><B><TT>ldap_rootdn</TT></B><DD> Bind DN. Default is&nbsp;<TT>""</TT>
which means anonymous connection.
<DT><B><TT>ldap_password</TT></B><DD> Bind password. Default
is&nbsp;<TT>""</TT>.
</DL>
Example:
<PRE>
  {auth_method, ldap}.
  {ldap_servers, ["ldap.mydomain.org"]}.
  {ldap_port, 389}.
  {ldap_rootdn, "cn=Manager,dc=domain,dc=org"}.
  {ldap_password, "secret"}.
</PRE>
Note that current LDAP implementation doesn't support SSL connection and SASL
authentication.<BR>
<BR>
<!--TOC subsubsection Authentication-->

<H4><A NAME="htoc67">A.21.3</A>&nbsp;&nbsp;Authentication</H4><!--SEC END -->

<A NAME="sec:ldapauthentication"></A>
You can authenticate users against LDAP directory. Available parameters are
listed below:
<DL COMPACT=compact><DT>
<B><TT>ldap_base</TT></B><DD> LDAP base directory which stores users
accounts. This option is required.
<DT><B><TT>ldap_uidattr</TT></B><DD> LDAP attribute which holds
user's part of JID. Default is <TT>"uid"</TT>.
<DT><B><TT>ldap_uidattr_format</TT></B><DD> Format of the
<TT>ldap_uidattr</TT> variable. Format MUST contain one and only one pattern
variable <TT>"%u"</TT> which will be replaced by user's part of JID. For example,
<TT>"%u@mydomain.org"</TT>. Default value is <TT>"%u"</TT>.
<DT><B><TT>ldap_filter</TT></B><DD> RFC 2254 LDAP filter. Default is
<TT>none</TT>. Example: <TT>"(&amp;(objectClass=shadowAccount)(memberOf=Jabber
 Users))"</TT>. Please, don't forget closing brackets and don't use superfluous
whitespaces. Also you MUST NOT use <TT>ldap_uidattr</TT> attribute in filter
because this attribute will be substituted in LDAP filter automatically.
</DL>
<!--TOC subsubsection vCards and Search-->

<H4><A NAME="htoc68">A.21.4</A>&nbsp;&nbsp;vCards and Search</H4><!--SEC END -->

<A NAME="sec:modvcardldap"></A>
<TT>ejabberd</TT> can map LDAP attributes to vCard fields. This behaviour is
implemented in <TT>mod_vcard_ldap</TT> module. This module doesn't depend on
authentication method. <TT>mod_vcard_ldap</TT> module has it's own optional
parameters. The first group of parameters has the same meaning as top-level
LDAP parameters: <TT>ldap_servers</TT>, <TT>ldap_port</TT>,
<TT>ldap_rootdn</TT>, <TT>ldap_password</TT>, <TT>ldap_base</TT>,
<TT>ldap_uidattr</TT>, <TT>ldap_uidattr_format</TT> and
<TT>ldap_filter</TT>. If one of this option is not set <TT>ejabberd</TT> will look
for top-level option with the same name. The second group of parameters
consists of the following options:
<DL COMPACT=compact><DT>

 <B><TT>hosts</TT></B><DD>  This option defines the hostnames of the
 service (see section&nbsp;<A HREF="#sec:modhostsoption">A.2.2</A>). If neither <TT>hosts</TT> nor
 the old <TT>host</TT> is present, the prefix ``<TT>vjud.</TT>'' is added to all
 <TT>ejabberd</TT> hostnames.

<DT><B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for <TT>vcard-temp</TT> IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
<DT><B><TT>search</TT></B><DD> This option specifies whether the search
 functionality is enabled (value: <TT>true</TT>) or disabled
 (value: <TT>false</TT>). If disabled, the option <TT>hosts</TT> will be
 ignored and the Jabber User Directory service will not appear in the
 Service Discovery item list. The default value is <TT>true</TT>.
<DT><B><TT>ldap_vcard_map</TT></B><DD> the table which defines
reflection of LDAP attributes to vCard fields.
	Format is:
		<TT>[Name_of_vcard_field, Pattern, List_of_LDAP_attributes, ...]</TT>
	where
		<TT>Name_of_vcard_field</TT> is the type name of vCard as defined
 in RFC 2426,
		Pattern is a string which contains pattern variables <TT>"%u"</TT>, <TT>"%d"</TT> or <TT>"%s"</TT>,
		<TT>List_of_LDAP_attributes</TT> is the list which contains of LDAP attributes.
	Pattern variables <TT>"%s"</TT> will be sequentially replaced with the values of
	LDAP attributes from <TT>List_of_LDAP_attributes</TT>; <TT>"%u"</TT> will be replaced with
	user's part of JID and <TT>"%d"</TT> will be replaced with domain part of JID.
	Example:
<PRE>
  {ldap_vcard_map,
   [{"NICKNAME", "%u", []},
    {"FN", "%s", ["displayName"]},
    {"CTRY", "Russia", []},
    {"EMAIL", "%u@%d", []},
    {"DESC", "%s\n%s", ["title", "description"]}
   ]},
</PRE>
Default is:
<PRE>
  [{"NICKNAME", "%u", []},
   {"FN", "%s", ["displayName"]},
   {"FAMILY", "%s", ["sn"]},
   {"GIVEN", "%s", ["givenName"]},
   {"MIDDLE", "%s", ["initials"]},
   {"ORGNAME", "%s", ["o"]},
   {"ORGUNIT", "%s", ["ou"]},
   {"CTRY", "%s", ["c"]},
   {"LOCALITY", "%s", ["l"]},
   {"STREET", "%s", ["street"]},
   {"REGION", "%s", ["st"]},
   {"PCODE", "%s", ["postalCode"]},
   {"TITLE", "%s", ["title"]},
   {"URL", "%s", ["labeleduri"]},
   {"DESC", "%s", ["description"]},
   {"TEL", "%s", ["telephoneNumber"]},
   {"EMAIL", "%s", ["mail"]},
   {"BDAY", "%s", ["birthDay"]},
   {"ROLE", "%s", ["employeeType"]},
   {"PHOTO", "%s", ["jpegPhoto"]}]
</PRE><DT><B><TT>ldap_search_fields</TT></B><DD> This option defines
search form and LDAP attributes to search.
	Format:
		<TT>[Name, Attribute, ...]</TT>
	where
		<TT>Name</TT> is the name of field in the search form. Will be automatically
			translated according to definitions in translation files (see
			<TT>msgs/*.msg</TT> for available words).
		Attribute is the LDAP attribute or the pattern <TT>"%u"</TT>
 Example:
<PRE>
  {ldap_search_fields,
   [{"User", "uid"},
    {"Full Name", "displayName"},
    {"Email", "mail"}
   ]},
</PRE>
Default is:
<PRE>
  [{"User", "%u"},
   {"Full Name", "displayName"},
   {"Given Name", "givenName"},
   {"Middle Name", "initials"},
   {"Family Name", "sn"},
   {"Nickname", "%u"},
   {"Birthday", "birthDay"},
   {"Country", "c"},
   {"City", "l"},
   {"Email", "mail"},
   {"Organization Name", "o"},
   {"Organization Unit", "ou"}]
</PRE><DT><B><TT>ldap_search_reported</TT></B><DD> This option defines search fields to be reported.
	Format:
		<TT>[Name, VCard_Name, ...]</TT>
	where
		<TT>Name</TT> is the name of field in the search form. Will be automatically
			translated according to definitions in translation files (see
			<TT>msgs/*.msg</TT> for available words).
		<TT>VCard_Name</TT> is the name of vCard field defined in <TT>ldap_vcard_map</TT> option.
 Example:
<PRE>
  {ldap_search_reported,
   [{"Full Name", "FN"},
    {"Email", "EMAIL"},
    {"Birthday", "BDAY"},
    {"Nickname", "NICKNAME"}
   ]},
</PRE>
Default is:
<PRE>
  [{"Full Name", "FN"},
   {"Given Name", "GIVEN"},
   {"Middle Name", "MIDDLE"},
   {"Family Name", "FAMILY"},
   {"Nickname", "NICKNAME"},
   {"Birthday", "BDAY"},
   {"Country", "CTRY"},
   {"City", "LOCALITY"},
   {"Email", "EMAIL"},
   {"Organization Name", "ORGNAME"},
   {"Organization Unit", "ORGUNIT"}]
</PRE></DL>
<!--TOC subsubsection Examples-->

<H4><A NAME="htoc69">A.21.5</A>&nbsp;&nbsp;Examples</H4><!--SEC END -->

<A NAME="sec:ldapexamples"></A>
<!--TOC paragraph Common example-->

<H5>Common example</H5><!--SEC END -->

Let's say <TT>ldap.mydomain.org</TT> is the name of our LDAP server. We have
users with their passwords in <TT>"ou=Users,dc=mydomain,dc=org"</TT> directory.
Also we have addressbook, which contains users emails and their additional
infos in <TT>"ou=AddressBook,dc=mydomain,dc=org"</TT> directory. Corresponding
authentication section should looks like this:
<PRE>
  %% authentication method
  {auth_method, ldap}.
  %% DNS name of our LDAP server
  {ldap_servers, ["ldap.mydomain.org"]}.
  %% Bind to LDAP server as "cn=Manager,dc=mydomain,dc=org" with password "secret"
  {ldap_rootdn, "cn=Manager,dc=mydomain,dc=org"}.
  {ldap_password, "secret"}.
  %% define the user's base
  {ldap_base, "ou=Users,dc=mydomain,dc=org"}.
  %% We want to authorize users from 'shadowAccount' object class only
  {ldap_filter, "(objectClass=shadowAccount)"}.
</PRE>
Now we want to use users LDAP-info as their vCards. We have four attributes
defined in our LDAP schema: <TT>"mail"</TT> --- email address, <TT>"givenName"</TT>
--- first name, <TT>"sn"</TT> --- second name, <TT>"birthDay"</TT> --- birthday.
Also we want users to search each other. Let's see how we can set it up:
<PRE>
  {modules,
    ...
    {mod_vcard_ldap,
     [
      %% We use the same server and port, but want to bind anonymously because
      %% our LDAP server accepts anonymous requests to
      %% "ou=AddressBook,dc=mydomain,dc=org" subtree.
      {ldap_rootdn, ""},
      {ldap_password, ""},
      %% define the addressbook's base
      {ldap_base, "ou=AddressBook,dc=mydomain,dc=org"},
      %% user's part of JID is located in the "mail" attribute
      {ldap_uidattr, "mail"},
      %% common format for our emails
      {ldap_uidattr_format, "%u@mail.mydomain.org"},
      %% We have to define empty filter here, because entries in addressbook doesn't
      %% belong to shadowAccount object class
      {ldap_filter, ""},
      %% Now we want to define vCard pattern
      {ldap_vcard_map,
       [{"NICKNAME", "%u", []}, % just use user's part of JID as his nickname
        {"GIVEN", "%s", ["givenName"]},
        {"FAMILY", "%s", ["sn"]},
        {"FN", "%s, %s", ["sn", "givenName"]}, % example: "Smith, John"
        {"EMAIL", "%s", ["mail"]},
        {"BDAY", "%s", ["birthDay"]}]},
      %% Search form
      {ldap_search_fields,
       [{"User", "%u"},
        {"Name", "givenName"},
        {"Family Name", "sn"},
        {"Email", "mail"},
        {"Birthday", "birthDay"}]},
      %% vCard fields to be reported
      %% Note that JID is always returned with search results
      {ldap_search_reported,
       [{"Full Name", "FN"},
        {"Nickname", "NICKNAME"},
        {"Birthday", "BDAY"}]}
    ]}
    ...
  }.
</PRE>
Note that <TT>mod_vcard_ldap</TT> module checks an existence of the user before
searching his info in LDAP.<BR>
<BR>
<!--TOC paragraph Active Directory-->

<H5>Active Directory</H5><!--SEC END -->

Active Directory is just an LDAP-server with predefined attributes. Sample
config file is listed below:
<PRE>
  {auth_method, ldap}.
  {ldap_servers, ["office.org"]}.    % List of LDAP servers
  {ldap_base, "DC=office,DC=org"}. % Search base of LDAP directory
  {ldap_rootdn, "CN=Administrator,CN=Users,DC=office,DC=org"}. % LDAP manager
  {ldap_password, "*******"}. % Password to LDAP manager
  {ldap_uidattr, "sAMAccountName"}.
  {ldap_filter, "(memberOf=*)"}.
  
  {mod_vcard_ldap,
   [{ldap_vcard_map,
     [{"NICKNAME", "%u", []},
      {"GIVEN", "%s", ["givenName"]},
      {"MIDDLE", "%s", ["initials"]},
      {"FAMILY", "%s", ["sn"]},
      {"FN", "%s", ["displayName"]},
      {"EMAIL", "%s", ["mail"]},
      {"ORGNAME", "%s", ["company"]},
      {"ORGUNIT", "%s", ["department"]},
      {"CTRY", "%s", ["c"]},
      {"LOCALITY", "%s", ["l"]},
      {"STREET", "%s", ["streetAddress"]},
      {"REGION", "%s", ["st"]},
      {"PCODE", "%s", ["postalCode"]},
      {"TITLE", "%s", ["title"]},
      {"URL", "%s", ["wWWHomePage"]},
      {"DESC", "%s", ["description"]},
      {"TEL", "%s", ["telephoneNumber"]}]},
    {ldap_search_fields,
     [{"User", "%u"},
      {"Name", "givenName"},
      {"Family Name", "sn"},
      {"Email", "mail"},
      {"Company", "company"},
      {"Department", "department"},
      {"Role", "title"},
      {"Description", "description"},
      {"Phone", "telephoneNumber"}]},
    {ldap_search_reported,
     [{"Full Name", "FN"},
      {"Nickname", "NICKNAME"},
      {"Email", "EMAIL"}]}
   ]
  }.
</PRE>
<!--TOC subsection <TT>mod_version</TT>-->

<H3><A NAME="htoc70">A.22</A>&nbsp;&nbsp;<TT>mod_version</TT></H3><!--SEC END -->

<A NAME="sec:modversion"></A>

This module implements Software Version (<A HREF="http://www.jabber.org/jeps/jep-0092.html">JEP-0092</A>). Consequently, it
answers <TT>ejabberd</TT>'s version when queried.<BR>
<BR>
Options:
<DL COMPACT=compact><DT>
<B><TT>iqdisc</TT></B><DD> This specifies 
the processing discipline for Software Version (<TT>jabber:iq:version</TT>) IQ queries
(see section&nbsp;<A HREF="#sec:modiqdiscoption">A.2.1</A>).
</DL>
<!--TOC section Internationalization and Localization-->

<H2><A NAME="htoc71">B</A>&nbsp;&nbsp;Internationalization and Localization</H2><!--SEC END -->

<A NAME="sec:i18nl10n"></A>

All built-in modules support the <TT>xml:lang</TT> attribute inside IQ queries.
Figure&nbsp;<A HREF="#fig:discorus">2</A>, for example, shows the reply to the following query:
<PRE>
  &lt;iq id='5'
      to='example.org'
      type='get'
      xml:lang='ru'&gt;
    &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
  &lt;/iq&gt;
</PRE>
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 
 <IMG SRC="discorus.png">
 

 <BR>
<DIV ALIGN=center>Figure 2: Service Discovery when <TT>xml:lang='ru'</TT></DIV><BR>

 <A NAME="fig:discorus"></A>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
The web interface also supports the <CODE>Accept-Language</CODE> HTTP header (compare
figure&nbsp;<A HREF="#fig:webadmmainru">3</A> with figure&nbsp;<A HREF="#fig:webadmmain">1</A>)
<BLOCKQUOTE><DIV ALIGN=center><DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV>
 
 <IMG SRC="webadmmainru.png">
 

 <BR>
<DIV ALIGN=center>Figure 3: Top page from the web interface with HTTP header
 ``Accept-Language: ru''</DIV><BR>

 <A NAME="fig:webadmmainru"></A>
<DIV ALIGN=center><HR WIDTH="80%" SIZE=2></DIV></DIV></BLOCKQUOTE>
<!--TOC section Release Notes-->

<H2><A NAME="htoc72">C</A>&nbsp;&nbsp;Release Notes</H2><!--SEC END -->

<A NAME="sec:releasenotes"></A>

<!--TOC subsection ejabberd 0.9-->

<H3><A NAME="htoc73">C.1</A>&nbsp;&nbsp;ejabberd 0.9</H3><!--SEC END -->

<PRE>
       Release notes
        ejabberd 0.9

    This document describes the major new features of and changes to
    ejabberd 0.9, compared to latest public release ejabber 0.7.5.

    For more detailed information, please refer to ejabberd User
    Guide.


Virtual Hosting

    ejabberd now can host several domain on the same instance.
    This option is enabled by using:

      {hosts, ["erlang-projects.org", "erlang-fr.org"]}.

    instead of the previous host directive.

    Note that you are now using a list of hosts. The main one should
    be the first listed. See migration section further in this release
    note for details.
      

Shared Roster

    Shared roster is a new feature that allow the ejabberd
    administrator to add jabber user that will be present in the
    roster of every users on the server.
    Shared roster are enabled by adding:

            {mod_shared_roster, []}

    at the end of your module list in your ejabberd.cfg file.


PostgreSQL (ODBC) support

    This feature is experimental and not yet properly documented. This
    feature is released for testing purpose.

    You need to have Erlang/OTP R10 to compile with ODBC on various
    flavour of *nix. You should use Erlang/OTP R10B-4, as this task
    has became easier with this release. It comes already build in
    Erlang/OTP Microsoft Windows binary.

    PostgreSQL support is enabled by using the following module in
    ejabberd.cfg instead of their standard counterpart:

     mod_last_odbc.erl
     mod_offline_odbc.erl
     mod_roster_odbc.erl

    The database schema is located in the src/odbc/pq.sql file.

    Look at the src/ejabberd.cfg.example file for more information on
    how to configure ejabberd with odbc support. You can get support
    on how to configure ejabberd with a relational database.


Migration from ejabberd 0.7.5

    Migration is pretty straightforward as Mnesia database schema
    conversions is handled automatically. Remember however that you
    must backup your ejabberd database before migration.

    Here are the following steps to proceed:

    1. Stop your instance of ejabberd.

    2. In ejabberd.cfg, define the host lists. Change the host
    directive to the hosts one:
    Before:
      {host, "erlang-projects.org"}.
    After:
      {hosts, ["erlang-projects.org", "erlang-fr.org"]}.
    Note that when you restart the server the existing users will be
    affected to the first virtual host, so the order is important. You
    should keep the previous hostname as the first virtual host.

    3. Restart ejabberd.


Bugfixes

    This release contains several bugfixes and architectural changes.
    Please refer to the Changelog file supplied with this release for
    details of all improvements in the ejabberd code.
</PRE>
<!--TOC subsection ejabberd 0.9.1-->

<H3><A NAME="htoc74">C.2</A>&nbsp;&nbsp;ejabberd 0.9.1</H3><!--SEC END -->

<PRE>
       Release notes
       ejabberd 0.9.1

   This document describes the main changes from [25]ejabberd 0.9.

   The code can be downloaded from the [26]download page.

   For more detailed information, please refer to ejabberd [27]User Guide.


Groupchat (Multi-user chat and IRC) improvements

   The multi-user chat code has been improved to comply with the latest version
   of Jabber Enhancement Proposal 0045.

   The IRC (Internet Relay Chat) features now support WHOIS and USERINFO
   requests.


Web interface

   ejabberd modules management features have been added to the web interface.
   They now allow to start or stop extension module without restarting the
   ejabberd server.


Publish and subscribe

   It is now possible to a subscribe node with a JabberID that includes a
   resource.


Translations

   A new script has been included to help translate ejabberd into new languages
   and maintain existing translations.

   As a result, ejabberd is now translating into 10 languages:
     * Dutch
     * English
     * French
     * German
     * Polish
     * Portuguese
     * Russian
     * Spanish
     * Swedish
     * Ukrainian


Migration

   No changes have been made to the database. No particular conversion steps
   are needed. However, you should backup your database before upgrading to a
   new ejabberd version.


Bugfixes

   This release contains several bugfixes and architectural changes. Please
   refer to the Changelog file supplied with this release for details of all
   improvements in the ejabberd code.
</PRE>
<!--TOC subsection ejabberd 0.9.8-->

<H3><A NAME="htoc75">C.3</A>&nbsp;&nbsp;ejabberd 0.9.8</H3><!--SEC END -->

<PRE>
       Release notes
       ejabberd 0.9.8
         2005-08-01

   This document describes the main changes in ejabberd 0.9.8. This
   version prepares the way for the release of ejabberd 1.0, which 
   is due later this year.

   The code can be downloaded from the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/

   For more detailed information, please refer to ejabberd User Guide
   on the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/docs.html


   Recent changes include....


Enhanced virtual hosting

   Virtual hosting applies to many more setting options and
   features and is transparent. Virtual hosting accepts different
   parameters for different virtual hosts regarding the following
   features: authentication method, access control lists and access
   rules, users management, statistics, and shared roster. The web
   interface gives access to each virtual host's parameters.


Enhanced Publish-Subscribe module

   ejabberd's Publish-Subscribe module integrates enhancements
   coming from J-EAI, an XMPP-based integration server built on
   ejabberd. ejabberd thus supports Publish-Subscribe node
   configuration. It is possible to define nodes that should be
   persistent, and the number of items to persist. Besides that, it
   is also possible to define various notification parameters, such
   as the delivery of the payload with the notifications, and the
   notification of subscribers when some changes occur on items.
   Other examples are: the maximum size of the items payload, the
   subscription approvers, the limitation of the notification to
   online users only, etc.


Code reorganisation and update

   - The mod_register module has been cleaned up.
   - ODBC support has been updated and several bugs have been fixed.


Development API

   To ease the work of Jabber/XMPP developers, a filter_packet hook
   has been added. As a result it is possible to develop plugins to
   filter or modify packets flowing through ejabberd.


Translations

   - Translations have been updated to support the new Publish-Subscribe features.
   - A new Brazilian Portuguese translation has been contributed.


Web interface

   - The CSS stylesheet from the web interface is W3C compliant.


Installers

   Installers are provided for Microsoft Windows and Linux/x86. The
   Linux installer includes Erlang ASN.1 modules for LDAP
   authentication support.


Bugfixes

   - This release contains several bugfixes and architectural
     changes. Among other bugfixes include improvements in LDAP
     authentication. Please refer to the ChangeLog file supplied 
     with this release regarding all improvements in ejabberd.


References

   The ejabberd feature sheet helps comparing with other Jabber/XMPP 
   servers:
   http://www.process-one.net/en/projects/ejabberd/docs/features.pdf

   Contributed tutorials of interest are:
   - Migration from Jabberd1.4 to ejabberd:
     http://ejabberd.jabber.ru/jabberd1-to-ejabberd
   - Migration from Jabberd2 to ejabberd:
     http://ejabberd.jabber.ru/jabberd2-to-ejabberd
   - Transport configuration for connecting to other networks:
     http://ejabberd.jabber.ru/tutorials-transports

END

</PRE>
<!--TOC subsection ejabberd 1.0.0-->

<H3><A NAME="htoc76">C.4</A>&nbsp;&nbsp;ejabberd 1.0.0</H3><!--SEC END -->

<PRE>
       Release Notes
       ejabberd 1.0.0
       14 December 2005

   This document describes the main changes in ejabberd 1.0.0. Unique in this
   version is the compliancy with the XMPP (eXtensible Messaging and Presence
   Protocol) standard. ejabberd is the first Open Source Jabber server claiming
   to fully comply to the XMPP standard.

   ejabberd can be downloaded from the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/

   Detailed information can be found in the ejabberd Feature Sheet and User
   Guide which are available on the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/docs.html


   Recent changes include:


Server-to-server Encryption for Enhanced Security

  - Support for STARTTLS and SASL EXTERNAL to secure server-to-server traffic
    has been added.
  - Also, STARTTLS and Dialback has been implemented for server-to-server (s2s)
    connections. Detailed information about these new features can be found on
    http://ejabberd.jabber.ru/s2s-encryption
  - commonName and dNSName fields matching were introduced to ease the process
    of retrieving certificates.
  - Different certificates can be defined for each virtual host.

ODBC Support

  - ODBC support has been improved to allow production use of ejabberd with
    relational databases.
  - Support for vCard storage in ODBC has been added.
  - ejd2odbc.erl is a tool to convert an installation from Erlang's database
    Mnesia to an ODBC compatible relational database.

Native PostgreSQL Support

  - Native PostgreSQL support gives you a better performance when you use
    PostgreSQL.

Shared Roster groups

  - Shared Roster groups support has been enhanced. New is the ability to add
    all registered users to everyone's roster. Detailed information about this
    new feature can be found on http://ejabberd.jabber.ru/shared-roster-all

Web Interface

   - The web interface internal code has been modified for better integration
     and compliancy with J-EAI, an ejabberd-based Enterprise Application
     Integration platform.
   - More XHTML 1.0 Transitional compliancy work was done.

Transports

   - A transport workaround can be enabled during compilation. To do this, you
     can pass the "--enable-roster-gateway-workaround" option to the configure
     script. (./configure --enable-roster-gateway-workaround)
     This option allows transports to add items with subscription "to" in the
     roster by sending &lt;presence type='subscribed'/&gt; stanza to user. This option
     is only needed for JIT ICQ transport.
     Warning: by enabling this option, ejabberd will not be fully XMPP compliant
              anymore.

Documentation and Internationalization

   - Documentation has been extended to cover more topics.
   - Translations have been updated.

Bugfixes

   - This release contains several bugfixes.
   - Among other bugfixes include improvements to the client-to-server (c2s)
     connection management module.
   - Please refer to the ChangeLog file supplied
     with this release regarding all improvements in ejabberd.


   Installation Notes


Supported Erlang Version

   - You need at least Erlang/OTP R9C to run ejabberd 1.0.0.

Installation

   Installers are provided for Microsoft Windows and Linux/x86.
   Installers can be retrieved from:
   http://www.process-one.net/en/projects/ejabberd/download.html

Migration Notes

   - Before any migration, ejabberd system and database must be properly
     backed up.
   - When upgrading an ODBC-based installation, you will need to change the
     relational database schema. The following SQL commands must be run on the
     database:
       CREATE SEQUENCE spool_seq_seq;
       ALTER TABLE spool ADD COLUMN seq integer;
       ALTER TABLE spool ALTER COLUMN seq SET DEFAULT nextval('spool_seq_seq');
       UPDATE spool SET seq = DEFAULT;
       ALTER TABLE spool ALTER COLUMN seq SET NOT NULL;

References

   Contributed tutorials of interest are:
   - Migration from Jabberd1.4 to ejabberd:
     http://ejabberd.jabber.ru/jabberd1-to-ejabberd
   - Migration from Jabberd2 to ejabberd:
     http://ejabberd.jabber.ru/jabberd2-to-ejabberd
   - Transport configuration for connecting to other networks:
     http://ejabberd.jabber.ru/tutorials-transports

END

</PRE>
<!--TOC subsection ejabberd 1.1.0-->

<H3><A NAME="htoc77">C.5</A>&nbsp;&nbsp;ejabberd 1.1.0</H3><!--SEC END -->

<PRE>
    Release Notes
    ejabberd 1.1.0
    24 April 2006

   This document describes the main changes in ejabberd 1.1.0. This version
   introduce new features including support for new Jabber Enhancement
   Proposals and several performance improvements enabling deployments on an
   even larger scale than already possible.

   ejabberd can be downloaded from the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/

   Detailed information can be found in the ejabberd Feature Sheet and User
   Guide which are available on the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/docs.html

   A complete list of changes is available from:
   http://support.process-one.net/secure/ReleaseNote.jspa?projectId=10011&amp;styleName=Html&amp;version=10025


   Recent changes include:


New Jabber Enhancement Proposal support:

  - JEP-0050: Ad-Hoc Commands.
  - JEP-0138: Stream Compression.
  - JEP-0175: SASL anonymous.

Anonymous login

  - SASL anonymous.
  - Anonymous login for clients that do not yet support SASL Anonymous.
  
Relational database Support

  - MySQL is now fully supported through ODBC and in native mode.
  - Various improvements to the native database interfaces.
  - The migration tool can use relational databases.

Multi-User Chat improvements

  - Logging of room discussion to text file is now supported.
  - Better reconfiguration support.
  - Security oriented fixes.
  - Several improvements and updates to latest JEP-0045.

Performance scalability improvements for large clusters

  - Improved session synchronisation management between cluster nodes.
  - Internal architecture has been reworked to use generalize Erlang/OTP
    framework usage.
  - Speed improvement on logger.
  - TCP/IP packet reception change for better network throttling and
    regulation.
  As a result, these improvements will reduce load on large scale deployments.

XMPP Protocol related improvements

  - XML stanza size can be limited.
  - Messages are send to all resources with the same highest priority.

Documentation and Internationalization

   - Documentation has been extended to cover more topics.
   - Translations have been updated.

Web interface

   - XHTML 1.0 compliance.

Bugfixes

   - This release contains many bugfixes on various areas such as Publish-Subscribe, build
     chain, installers, IRC gateway, ejabberdctl, amongst others.
   - Please refer to the ChangeLog file supplied with this release regarding
     all improvements in ejabberd.



   Installation Notes

Supported Erlang Version

   - You need at least Erlang/OTP R9C-2 to run ejabberd 1.1.0.

Installation

   Installers are provided for Microsoft Windows, Linux/x86 and MacOSX/PPC.
   Installers can be retrieved from:
   http://www.process-one.net/en/projects/ejabberd/download.html

Migration Notes

   - Before any migration, ejabberd system and database must be properly
     backed up.
   - The database schema has not been changed comparing to version 1.0.0 and
     consequently it does not require any migration.


References

   Contributed tutorials and documents of interest are:
   - Migration from Jabberd1.4, Jabberd2 and WPJabber to ejabberd:
     http://ejabberd.jabber.ru/migrate-to-ejabberd     
   - Transport configuration for connecting to other networks:
     http://ejabberd.jabber.ru/tutorials-transports
   - Using ejabberd with MySQL native driver:
     http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver
   - Anonymous User Support:
     http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support
   - Frequently Asked Questions:
     http://ejabberd.jabber.ru/faq

END
</PRE>
<!--TOC subsection ejabberd 1.1.1-->

<H3><A NAME="htoc78">C.6</A>&nbsp;&nbsp;ejabberd 1.1.1</H3><!--SEC END -->

<PRE>
    Release Notes
    ejabberd 1.1.1 
    28 April 2006

   This document describes the main changes in ejabberd 1.1.x. This version
   introduce new features including support for new Jabber Enhancement
   Proposals and several performance improvements enabling deployments on an
   even larger scale than already possible.

   This release fix a security issue introduced in ejabberd 1.1.0. In SASL
   mode, anonymous login was enabled as a default. Upgrading ejabberd 1.1.0 to
   ejabberd 1.1.1 is highly recommended.

   ejabberd can be downloaded from the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/

   Detailed information can be found in the ejabberd Feature Sheet and User
   Guide which are available on the Process-one website:
   http://www.process-one.net/en/projects/ejabberd/docs.html

   A complete list of changes is available from:
   http://support.process-one.net/secure/ReleaseNote.jspa?projectId=10011&amp;styleName=Html&amp;version=10025


   Recent changes include:


New Jabber Enhancement Proposal support:

  - JEP-0050: Ad-Hoc Commands.
  - JEP-0138: Stream Compression.
  - JEP-0175: SASL anonymous.

Anonymous login

  - SASL anonymous.
  - Anonymous login for clients that do not yet support SASL Anonymous.
  
Relational database Support

  - MySQL is now fully supported through ODBC and in native mode.
  - Various improvements to the native database interfaces.
  - The migration tool can use relational databases.

Multi-User Chat improvements

  - Logging of room discussion to text file is now supported.
  - Better reconfiguration support.
  - Security oriented fixes.
  - Several improvements and updates to latest JEP-0045.

Performance scalability improvements for large clusters

  - Improved session synchronisation management between cluster nodes.
  - Internal architecture has been reworked to use generalize Erlang/OTP
    framework usage.
  - Speed improvement on logger.
  - TCP/IP packet reception change for better network throttling and
    regulation.
  As a result, these improvements will reduce load on large scale deployments.

XMPP Protocol related improvements

  - XML stanza size can be limited.
  - Messages are send to all resources with the same highest priority.

Documentation and Internationalization

   - Documentation has been extended to cover more topics.
   - Translations have been updated.

Web interface

   - XHTML 1.0 compliance.

Bugfixes

   - This release contains many bugfixes on various areas such as Publish-Subscribe, build
     chain, installers, IRC gateway, ejabberdctl, amongst others.
   - Please refer to the ChangeLog file supplied with this release regarding
     all improvements in ejabberd.



   Installation Notes

Supported Erlang Version

   - You need at least Erlang/OTP R9C-2 to run ejabberd 1.1.0.

Installation

   Installers are provided for Microsoft Windows, Linux/x86 and MacOSX/PPC.
   Installers can be retrieved from:
   http://www.process-one.net/en/projects/ejabberd/download.html

Migration Notes

   - Before any migration, ejabberd system and database must be properly
     backed up.
   - The database schema has not been changed comparing to version 1.0.0 and
     consequently it does not require any migration.


References

   Contributed tutorials and documents of interest are:
   - Migration from Jabberd1.4, Jabberd2 and WPJabber to ejabberd:
     http://ejabberd.jabber.ru/migrate-to-ejabberd     
   - Transport configuration for connecting to other networks:
     http://ejabberd.jabber.ru/tutorials-transports
   - Using ejabberd with MySQL native driver:
     http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver
   - Anonymous User Support:
     http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support
   - Frequently Asked Questions:
     http://ejabberd.jabber.ru/faq

END
</PRE>
<!--TOC section Acknowledgements-->

<H2><A NAME="htoc79">D</A>&nbsp;&nbsp;Acknowledgements</H2><!--SEC END -->

<A NAME="sec:acknowledgements"></A>

Thanks to all people who contributed to this guide:
<UL><LI>
Alexey Shchepin (<A HREF="xmpp:aleksey@jabber.ru"><TT>xmpp:aleksey@jabber.ru</TT></A>)
<LI>Florian Zumbiehl (<A HREF="xmpp:florz@florz.de"><TT>xmpp:florz@florz.de</TT></A>)
<LI>Michael Grigutsch (<A HREF="xmpp:migri@jabber.i-pobox.net"><TT>xmpp:migri@jabber.i-pobox.net</TT></A>)
<LI>Mickael Remond (<A HREF="xmpp:mremond@erlang-projects.org"><TT>xmpp:mremond@erlang-projects.org</TT></A>)
<LI>Sander Devrieze (<A HREF="xmpp:sander@devrieze.dyndns.org"><TT>xmpp:sander@devrieze.dyndns.org</TT></A>)
<LI>Sergei Golovan (<A HREF="xmpp:sgolovan@nes.ru"><TT>xmpp:sgolovan@nes.ru</TT></A>)
<LI>Vsevolod Pelipas (<A HREF="xmpp:vsevoload@jabber.ru"><TT>xmpp:vsevoload@jabber.ru</TT></A>)
</UL>
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2>
<BLOCKQUOTE><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://pauillac.inria.fr/~maranget/hevea/index.html"><EM>H<FONT SIZE=2><sup>E</sup></FONT>V<FONT SIZE=2><sup>E</sup></FONT>A</EM></A><EM>.
</EM></BLOCKQUOTE>
</BODY>
</HTML>
